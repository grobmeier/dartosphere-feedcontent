---
title: 'Testing JavaScript Polymers… With Dart'
layout: post
published: '2014-06-20T00:00:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/Z2FmwHfwEMw/testing-javascript-polymers-with-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - css
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />Look, this isn't that hard. In order to test my <code>&lt;apply-author-styles></code> <a href="http://www.polymer-project.org/">Polymer</a> element, I need a test page that:<br /><ol><li>holds a test Polymer element that uses <code>&lt;apply-author-styles></code></li><li>Can run in a server so that XHR request can be made</li><li>Has custom styles that can be pulled from the page into the test custom element</li></ol>Try as I might with grunt-contrib-jasmine and <a href="http://karma-runner.github.io">Karma</a>, I cannot do this. grunt-contrib-jasmine and Polymer <a href="http://japhr.blogspot.com/2014/02/yak-boxed-development.html">do not get along</a>. Karma refuses to allow me to add custom CSS to the test context—at least not statically.<br /><br />So you know what? I give up. I'm testing with <a href="http://dartlang.org">Dart</a>.<br /><br />I already have Grunt setup in this project, so I stick with it here. In this case, I want a simple static server against which to run my tests (there is a simple Ajax component). I already have that in the form of <code>grunt-contrib-connect</code>. Now I need a way to run Dart tests against this JavaScript element (yes, I serious). <br /><br />Since there is no grunt-contrib-dart yet (why not?!), I install <code>grunt-shell</code>:<pre class=prettyprint>$ npm install --save-dev grunt-shell</pre>The I add this to the imported tasks in my <code>Gruntfile.js</code> and define my test_runner.sh shell task that will run my Dart tests:<pre class=prettyprint>module.exports = function(grunt) {<br />  // Project configuration.<br />  grunt.initConfig({<br />    pkg: grunt.file.readJSON('package.json'),<br />    // ...<br />    connect: {<br />      server: {<br />        options: {<br />          port: 8100,<br />          keepalive: false<br />        }<br />      }<br />    },<br /><b>    shell: {<br />      test: {<br />        command: 'test/test_runner.sh'<br />      }<br />    }</b><br />  });<br /><br />  grunt.loadNpmTasks('grunt-contrib-watch');<br /><b>  grunt.loadNpmTasks('grunt-shell');</b><br />  grunt.loadNpmTasks('grunt-contrib-connect');<br /><br />  grunt.registerTask('default', ['connect', 'shell:test']);<br />};<br /></pre>The <code>test_runner.sh</code> script is a simple fork of <code>content_shell</code> that comes bundled with Dart for headless testing—but real headless testing with an actual browser. The <code>test_runner.sh</code> script looks like:<pre class=prettyprint>#!/bin/bash<br /><br /># Run a set of Dart Unit tests<br />results=$(content_shell --dump-render-tree http://localhost:8100/test/ 2>&1)<br />echo -e "$results"<br /><br /># check to see if DumpRenderTree tests<br /># fails, since it always returns 0<br />if [[ "$results" == *"Some tests failed"* ]]<br />then<br />    exit 1<br />fi<br /><br />echo<br />echo "Looks good!"<br /></pre>OK with that, I have my runner in place. Grunt will start <code>grunt-contrib-connect</code> as part of the default task and <code>content_shell</code> will run my test at http://localhost:8100/test/. Now I just need to define the test.<br /><br />I start with a test context page that *I* can write:<pre class=prettyprint>&lt;head><br />  &lt;!-- Load Polymer --><br />  &lt;script src="/bower_components/platform/platform.js">&lt;/script><br /><br />  &lt;!-- Load component(s) --><br />  &lt;link rel="import" href="x-foo.html"><br /><br /><b>  &lt;!-- Style that will apply to both page and Polymer elements --><br />  &lt;style><br />    button { border: 5px solid orange; }<br />  &lt;/style></b><br />&lt;/head><br />&lt;body><br /><b>  &lt;div id=test>&lt;!-- Test element --><br />    &lt;x-foo>&lt;/x-foo><br />  &lt;/div></b><br />  &lt;div id=page>&lt;!-- Page element --><br />    &lt;button type=button>Test in Main Page&lt;/button><br />  &lt;/div><br />&lt;/body><br /></pre><br /><pre class=prettyprint>library main_test;<br /><br />import 'package:scheduled_test/scheduled_test.dart';<br />import 'dart:html';<br /><br />main(){<br />  group("[styles]", (){<br />    test('the app returns OK', (){<br />      var xFoo = query('x-foo');<br />      expect(xFoo.text, contains('orange'));<br />    });<br />  });<br />}</pre>Which does the trick.<br /><br /><span style="color: #ccc">Day #98</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/06/getting-started-on-grunt-contrib.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/Z2FmwHfwEMw" height="1" width="1"/>
