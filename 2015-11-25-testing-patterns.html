---
title: 'Testing Patterns'
layout: post
published: '2015-11-25T23:50:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/rZ0jil62wCM/testing-patterns.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - flyweight
    - testing

---

<div class=top-chain-links></div><br />Tonight, I start testing the code in <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>. I expect my testing approach will evolve as the book is written. For now, I plan to test code used directly in the book (for obvious reasons) and some of the experimental code that I use to explore patterns before writing.<br /><br />To start, I will write some tests for the <a href="https://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight pattern</a> coffee shop example with which I have been playing. I start by adding the <a href="https://www.dartdocs.org/documentation/test">test</a> packages to the list of development dependencies in my <code>pubspec.yaml</code>:<pre class=prettyprint>name: flyweight_code<br />dependencies:<br />  reflectable: any<br />dev_dependencies:<br />  test: any<br />transformers:<br />- reflectable:<br />    entry_points:<br />      - bin/coffee_orders.dart<br />    formatted: true</pre>After a <code>pub get</code>, I start a <code>test/coffee_shop_test.dart</code> file:<pre class=prettyprint>library coffee_shop_test;<br /><br />import 'package:test/test.dart';<br /><br />import 'package:flyweight_code/coffee_shop.dart';<br /><br />main(){<br />  // Tests will go here...<br />}</pre>With that, I can define some test <code>setUp()</code> to create my flyweight-based coffee shop and place some coffee orders:<pre class=prettyprint><code>  var shop;<br />  setUp((){<br />    shop = new CoffeeShop()<br />      ..order('Cappuccino', 'large', who: 'Fred', fooFoo: 'Extra Shot')<br />      ..order('Espresso',   'small', who: 'Bob')<br />      ..order('Cappuccino',     'large', who: 'Alice');<br />  });</code></pre>I can test some of the properties of this coffee shop:<pre class=prettyprint><code>  test('it can calculate profit', (){<br />    expect(shop.profit, 15.2);<br />  });<br />  test('it flyweights', (){<br />    expect(CoffeeFlavor.totalCount, 2);<br />  });</code></pre>The profit is based on the cost per ounce of the different coffees. The total count of coffee flavors is determined from the number of flyweight objects in use. Those are both fairly easy tests and do not take much effort to get working. Testing in <a href="http://dartlang.org">Dart</a> is still quite pleasant.<br /><br />I am curious about testing <code>print()</code> statements. I have not had an excuse to do so in any of my Dart code to date, but I happen to use print statements in the <code>serve()</code> method of the coffee shop:<pre class=prettyprint><code>  void serve() {<br />    _orders.forEach((o) { print("Served ${o.service}.");});<br />  }</code></pre>The <code>service</code> property for the orders is something like "Espresso to Bob", so I want to verify that serving drinks prints out the phrase "Served Espresso to Bob". Since there are a number of <code>print()</code> statements throughout the code, I need to verify that all prints contain this phrase. In <code>test</code> parlance, this is expressed as:<pre class=prettyprint><code>  test('prints when serving', (){<br />    expect(shop.serve, prints(contains('Served Espresso to Bob.')));<br />  });</code></pre>So that turns out to be pretty easy! More importantly, the tests all pass:<pre class=prettyprint>$ pub run test -r expanded<br />00:00 +0: test/coffee_shop_test.dart: it can calculate profit<br />00:00 +1: test/coffee_shop_test.dart: it flyweights<br />00:00 +2: test/coffee_shop_test.dart: prints when serving<br />00:00 +3: All tests passed!</pre>So I can test an individual patterns. Now I need to test all of them in the repository. As far as I know, this is the purview of Bash scripts. Fortunately, I have done this before:<pre class=prettyprint>#!/bin/bash -e<br /><br />shopt -s extglob<br /><br />for X in !(LICENSE|README.md|bin|packages)<br />do<br />    # Change the current working directory to pattern directory<br />    cd $X<br />    echo "[TEST] $X "<br /><br />    # Update pub<br />    echo -n "pub update"<br />    pub get >/dev/null<br />    echo " (done)"<br /><br />    # Run the actual tests<br />    pub run test<br />    echo<br /><br />    # Back to the top-level directory<br />    cd - >/dev/null<br />done</pre>This iterates over all files and directories in the repository, except for <code>LICENSE</code>, <code>README.md</code>, <code>bin</code>, and <code>packages</code>. In each code directory, it runs the tests. With that, I have a build script for my book code:<pre class=prettyprint>$ ./bin/test.sh<br />[TEST] flyweight <br />pub update (done)<br />00:00 +3: All tests passed!</pre>I <i>think</i> that I am done now with the Flyweight pattern. I may make a quick check of things tomorrow, but I am likely on to a new pattern.<br /><br /><span style="color: #ccc">Day #14</span>  <br /><br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/11/reflectable-subtypes-and-flyweights.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/rZ0jil62wCM" height="1" width="1" alt=""/>
