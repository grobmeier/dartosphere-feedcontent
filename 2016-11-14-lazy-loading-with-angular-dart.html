---
title: 'Lazy loading with Angular Dart'
layout: post
published: '2016-11-14T03:09:01+00:00'
feed: 'Stories by Matan Lurey on Medium'
link: 'https://medium.com/@matanlurey/lazy-loading-with-angular-dart-14f58004f988?source=rss-abdbfcd4679f------2'
author:
    name: 'Matan Lurey'
    email: null
    url: null
tags:
    - dart
    - web-performance
    - angular2
    - javascript
    - browsers

---

<p>A little known fact: Angular Dart has supported <em>lazy loading</em> since 1.0.</p><p>What does <em>lazy loading</em> (called <a href="http://news.dartlang.org/2014/08/dart-16-adds-support-for-deferred.html"><em>deferred loading</em></a> in Dart) do for you?</p><ul><li>You can break up your application into small, dependent parts</li><li>It works on every browser — automatically without polyfills</li><li>Use fully typed Dart code — even your deferred libraries are typed</li></ul><p>Don’t worry — you don’t need any extra plugins, loaders, build steps, or dependencies of any kind. It’s completely built in (albeit, I admit relatively undocumented — we’re working on that).</p><p>This tutorial expects you to already be familiar with <a href="https://webdev.dartlang.org/guides/get-started">Dart</a> and <a href="https://angular.io/dart">Angular Dart</a>.</p><h3>Getting started</h3><p>I use a mix of both <a href="https://www.dartlang.org/tools/jetbrains-plugin">IntelliJ</a> and <a href="https://marketplace.visualstudio.com/items?itemName=DanTup.dart-code">Visual Studio code</a> with the Dart plugin. Both are fine for following this tutorial — they use the Dart analysis server to provide static warnings, auto-complete, and more — or you can use your favorite text editor.</p><h4>Creating a new project</h4><p>I could start from a totally empty folder, but I’m lazy — let’s use <a href="https://pub.dartlang.org/packages/stagehand">stagehand</a> to auto-generate the scaffolding for a new Dart project. We’ll get a nice file structure setup in seconds:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/574/1*LDlkeZ4TuIHXuxIwJ7Qz9g.gif" /><figcaption>Creating a new Angular Dart application in about 5 seconds</figcaption></figure><p>If you want to copy-paste the commands I used:</p><blockquote>$ pub global activate stagehand<br>$ mkdir angular2_lazy_example<br>$ cd angular2_lazy_example<br>$ stagehand web-angular</blockquote><p>Let’s get all our dependencies too:</p><blockquote>$ pub get</blockquote><p>I then opened angular2_lazy_example in IntelliJ:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*v8TVKPdXNVl_8IYRe-PwTQ.png" /><figcaption>My newly created Angular Dart application. Isn’t it great?</figcaption></figure><p>And to preview my application, I run pub serve:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*uerzpom2ygawgTN3KAjchg.png" /><figcaption>I preview my code using <a href="https://webdev.dartlang.org/tools/dartium">Dartium</a> while developing</figcaption></figure><h3>OK, but this is supposed to about deferred loading…</h3><p>Yes, yes it is. And it’s just as easy as the steps above. Let’s add a new component, ReleaseListComponent — it’s going to download a list of the most recent Angular Dart releases, and display them for us.</p><h4>Creating our new component</h4><p>Let’s write release_list_component.dart in our lib/ folder:</p><pre><strong>import </strong>&#39;dart:html&#39;;<br><strong>import </strong>&#39;dart:convert&#39;;<br><br><strong>import </strong>&#39;package:angular2/angular2.dart&#39;;<br><br>@Component(<br>  selector: &#39;release-list&#39;,<br>  templateUrl: &#39;release_list_component.html&#39;,<br>  styleUrls: <strong>const </strong>[&#39;release_list_component.css&#39;],<br>)<br><strong>class </strong>ReleaseListComponent <strong>implements </strong>OnInit {<br>  <strong>static const </strong><em>_apiUrl </em>= <br>      &#39;https://api.github.com/repos/dart-lang/angular2/tags&#39;;<br><br>  List&lt;GithubTag&gt; releases = <strong>const </strong>[];<br><br>  @override<br>  ngOnInit() <strong>async </strong>{<br>    <strong>final </strong>tags = JSON.decode(<strong>await </strong>HttpRequest.<em>getString</em>(<em>_apiUrl</em>));<br>    releases = (tags <strong>as </strong>List&lt;Map&gt;)<br>        .map((t) =&gt; <strong>new </strong>GithubTag(t[&#39;name&#39;], t[&#39;commit&#39;][&#39;url&#39;]))<br>        .toList();<br>  }<br>}<br><br><strong>class </strong>GithubTag {<br>  <strong>final </strong>String name;<br>  <strong>final </strong>String url;<br><br>  GithubTag(<strong>this</strong>.name, <strong>this</strong>.url);<br>}</pre><p>And let’s add a release_list_component.html:</p><pre>&lt;ul&gt;<br>  &lt;li *ngFor=&quot;let release of releases&quot;&gt;<br>    &lt;a [href]=&quot;release.url&quot;&gt;{{release.name}}&lt;/a&gt;<br>  &lt;/li&gt;<br>&lt;/ul&gt;</pre><p>And a release_list_component.css:</p><pre>ul {<br>    margin: 0;<br>    padding: 0;<br>}<br><br>ul li {<br>    color: #1e90ff;<br>}</pre><p>Finally, let’s display the component. Modify app_component.dart:</p><pre><strong>import </strong>&#39;package:angular2/core.dart&#39;;<br><br><strong>import </strong>&#39;release_list_component.dart&#39;;<br><br>@Component(<br>  selector: &#39;my-app&#39;,<br>  styleUrls: <strong>const </strong>[&#39;app_component.css&#39;],<br>  templateUrl: &#39;app_component.html&#39;,<br>  directives: <strong>const </strong>[ReleaseListComponent],<br>)<br><strong>class </strong>AppComponent {}</pre><p>And app_component.html:</p><pre>&lt;h1&gt;My First Angular 2 App&lt;/h1&gt;<br>&lt;release-list&gt;&lt;/release-list&gt;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/1000/1*0iq98ntvtrJeXyUq7HcwCQ.png" /><figcaption>We’ve added our <strong>ReleaseListComponent</strong> but it’s not defer loaded yet</figcaption></figure><p>Nothing is deferred loaded — yet. Let’s look at our Chrome timeline:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*52Zo-gDdcapBsnrxRCKiZA.png" /><figcaption>Using <a href="https://webdev.dartlang.org/tools/dart2js">dart2js</a> we’ve built and run our application in Chrome.</figcaption></figure><h4>Splitting out release list</h4><p>What if we only wanted to load release list <em>after</em> our initial page load? Easy!</p><p>Let’s modify our app_component.dart to use <a href="https://angular.io/docs/dart/latest/api/angular2.core/DynamicComponentLoader-class.html">DynamicComponentLoader</a> — which allows us to asynchronously load a component by it’s class type.</p><pre><strong>import </strong>&#39;package:angular2/core.dart&#39;;<br><br><strong>import </strong>&#39;release_list_component.dart&#39;;<br><br>@Component(<br>  selector: &#39;my-app&#39;,<br>  styleUrls: <strong>const </strong>[&#39;app_component.css&#39;],<br>  templateUrl: &#39;app_component.html&#39;,<br>)<br><strong>class </strong>AppComponent <strong>implements </strong>OnInit {<br>  <strong>final </strong>DynamicComponentLoader _loader;<br>  <strong>final </strong>ViewContainerRef _location;<br><br>  AppComponent(<strong>this</strong>._loader, <strong>this</strong>._location);<br><br>  @override<br>  ngOnInit() <strong>async </strong>{<br>    _loader.loadNextToLocation(ReleaseListComponent, _location);<br>  }<br>}</pre><p>(I’ve also removed &lt;releases-list&gt; from app_component.html)</p><p>Finally, let’s make it <em>actually</em> defer loaded. This is the fun part!</p><pre><strong>import </strong>&#39;release_list_component.dart&#39; <strong>deferred as </strong>release_list;</pre><pre>@override<br>ngOnInit() <strong>async </strong>{<br>  <strong>await </strong>release_list.loadLibrary();<br>  _loader.loadNextToLocation(<br>    release_list.ReleaseListComponent, _location);<br>}</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*3gM3SP4r8g-dgt8oR_kg0Q.png" /><figcaption>A very small code split, but this is just an example.</figcaption></figure><p>In just a few minutes, we’ve <em>deferred/lazy loaded </em>our Dart code, HTML template (pre-compiled to Dart code), and related CSS — everything, with a couple lines of code.</p><h3>Going from here</h3><p>You’ve seen the most <em>basic</em> example of <em>deferred/lazy loading</em> in Dart. Of course, this also works without Angular Dart, for your own frameworks and projects.</p><p>Let me know in the comments or elsewhere if you’d like more information.</p><p>Edit: Final code at <a href="https://github.com/matanlurey/angular2_lazy_example">https://github.com/matanlurey/angular2_lazy_example</a></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=14f58004f988" width="1" height="1">
