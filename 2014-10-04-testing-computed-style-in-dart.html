---
title: 'Testing Computed Style in Dart'
layout: post
published: '2014-10-04T16:34:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/cDjwrw0HOxs/testing-computed-style-in-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - css
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />I was able to test CSS styling last night, making <code>getComputedStyle()</code> my new best friend. Seriously, I have wanted to do just this kind of testing before, but never knew it was possible. Which begs the question, is it possible in <a href="http://dartlang.org">Dart</a>?<br /><br />Presumably, it is. Especially since <code>getComputedStyle()</code> is <a href="https://api.dartlang.org/apidocs/channels/stable/dartdoc-viewer/dart-dom-html.Element#id_getComputedStyle">part of core dart:html</a>. Even better, <code>getComputedStyle()</code> in Dart is available on any Element, so no need to run it through the top-level <code>window</code> version.<br /><br />As yesterday, I am testing some <a href="http://getbootstrap.com">Bootstrap</a> styles applied to a custom <a href="http://www.polymer-project.org/">Polymer</a> element for a chapter in <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>. More precisely, I am using <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> for the Dart version of this chapter.<br /><br />The setup for testing this creates the <code>&lt;pricing-plan></code> elements that should use Bootstrap styles:<pre class=prettyprint><code>  var _el;<br />  group("styles", (){<br />    setUp((){<br /><b>      _el = createElement('''<br />        &lt;pricing-plans><br />          &lt;pricing-plan type="primary">plan content&lt;/pricing-plan><br />        &lt;/pricing-plans><br />      ''');<br />      document.body.append(_el);</b><br />    });<br />    // Test goes here...<br />  });</code></pre>The <code>type="primary"</code> attribute will generate a Bootstrap panel-primary class that results in a panel with a blue heading like the one on the right:<br /><br /><a href="http://4.bp.blogspot.com/-kE2OCkUMLCk/VDBWdOAss1I/AAAAAAAAf18/lxRBAjG9GRU/s1600/01-dart_primary_pricing_plan.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-kE2OCkUMLCk/VDBWdOAss1I/AAAAAAAAf18/lxRBAjG9GRU/s320/01-dart_primary_pricing_plan.png" /></a><br /><br />To test this, I need the same computed style as from last night's JavaScript test. I need grab the <code>&lt;pricing-plan></code> element, then query for the panel heading, and finally ask for the computed style:<pre class=prettyprint><code>    test("come from external sources", (){<br />      var primary_el = _el.query('pricing-plan'),<br />          heading_el = primary_el.shadowRoot.query('.panel-heading'),<br />          style = heading_el.getComputedStyle();<br /><br />      expect(style.backgroundColor, 'rgb(66, 139, 202)');<br />    });</code></pre>The expectation is then that the panel's background color will be default Bootstrap primary blue. But this turns out not to work:<pre class=prettyprint>CONSOLE MESSAGE: FAIL: styles come from external sources<br />  Expected: 'rgb(66, 139, 202)'<br />    Actual: 'rgba(0, 0, 0, 0)'<br />     Which: is different.</pre>Interesting, I note that the smoke test web page is making XHR requests for Bootstrap:<pre class=prettyprint>XHR finished loading: GET "http://localhost:8080/packages/bootstrap_example/assets/bootstrap.min.css".</pre>This occurs even though Bootstrap is being imported with <code>@import</code> in the Polymer definition:<pre class=prettyprint>&lt;link rel="import" href="../../../packages/polymer/polymer.html"><br />&lt;polymer-element name="pricing-plan"><br />  &lt;template><br />    &lt;div class="col-md-{{size}}">&lt;!-- ... -->&lt;/div><br /><b>    &lt;style><br />      @import '/packages/bootstrap_example/assets/bootstrap.min.css';<br />    &lt;/style></b><br />  &lt;/template><br />  &lt;script type="application/dart" src="pricing_plan.dart">&lt;/script><br />&lt;/polymer-element></pre>I presume this is the Polymer transformer doing this. Since I cannot change it, I need a workaround. Like running <code>pub serve</code>:<pre class=prettyprint>$ pub serve<br />Loading source assets... <br />Loading polymer transformers... <br />Serving bootstrap_example web  on http://localhost:8080<br /><b>Serving bootstrap_example test on http://localhost:8081</b></pre>The tests are kindly served up from 8081, so I point <code>content_shell</code> there:<pre class=prettyprint>$ content_shell --dump-render-tree http://localhost:8081                         <br />CONSOLE MESSAGE: unittest-suite-wait-for-done<br /><b>CONSOLE MESSAGE: PASS: styles come from external sources</b><br />CONSOLE MESSAGE: PASS: [defaults] name is "Plan"<br />CONSOLE MESSAGE: PASS: [defaults] can embed code<br />CONSOLE MESSAGE: <br />CONSOLE MESSAGE: All 3 tests passed.<br />CONSOLE MESSAGE: unittest-suite-success<br />CONSOLE WARNING: line 213: PASS</pre>So yay! Aside from the tiny XHR curveball with the <code>@import</code> CSS, it is just as easy to test styles in Polymer.dart as in the JavaScript version.<br /><br /><br /><span style="color: #ccc">Day #203</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/10/testing-css-colors-in-polymer.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/10/command-line-polymerdart-generators.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/cDjwrw0HOxs" height="1" width="1" alt=""/>
