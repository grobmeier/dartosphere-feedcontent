---
title: 'Ugly Google Maps API from Polymer.dart'
layout: post
published: '2015-03-25T01:35:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/LzyBZXksrjU/ugly-google-maps-api-from-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - google-maps
    - google-maps-api
    - polymer

---

<div class=top-chain-links></div><br />Up tonight, I would like to mess about with the Google Maps API a little.<br /><br />While I await the final copy edits on <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>, I need to keep my mind engaged with <a href="http://www.polymer-project.org/">Polymer</a>. I will have to run through changes at least one more time and would like this stuff as fresh as possible. In other words, this seems an opportune time to work through topics about which folks inquired but did not seem an obvious fit in the book. I will code in the language in which the question was originally asked.<br /><br />So, to explore the Google Maps API, I will be coding in <a href="http://dartlang.org">Dart</a>. The question is a little old -- I think I got it late last year. Today, I believe the answer for how to approach this begins and ends with the <a href="http://googlewebcomponents.github.io/google-map">google-map</a> web component. The question then becomes, how easy is it to install with Polymer.dart?<br /><br />It has at least been <a href="http://terrageek.blogspot.com/2014/08/integrating-dart-googlemaps-package.html">done once</a> by the esteemed James Hurford. James' approach hardly seems easy and it has been a while, so it may no longer work. There is one way to find out...<br /><br />I start not with Dart, but with a <a href="http://bower.io">Bower</a> install to obtain the <code>&lt;google-map></code> Polymer element. First, I specify that Bower should install in my application's <code>lib/elements/bower_components</code> directory so that my Dart code can access it. I do this by creating a <code>.bowerrc</code> with:<pre class=prettyprint>{<br />  "directory": "lib/elements/bower_components"<br />}</pre>Now I can <code>bower install</code>:<pre class=prettyprint>$ bower install GoogleWebComponents/google-map --save<br />...<br />google-map#0.4.2 lib/elements/bower_components/google-map<br />└── google-apis#0.4.4<br /><br />google-apis#0.4.4 lib/elements/bower_components/google-apis<br />└── core-shared-lib#0.5.5<br /><br />core-shared-lib#0.5.5 lib/elements/bower_components/core-shared-lib<br />└── polymer#0.5.5<br /><br />polymer#0.5.5 lib/elements/bower_components/polymer<br />├── core-component-page#0.5.5<br />└── webcomponentsjs#0.5.5<br /><br />core-component-page#0.5.5 lib/elements/bower_components/core-component-page<br />├── polymer#0.5.5<br />└── webcomponentsjs#0.5.5<br /><br />webcomponentsjs#0.5.5 lib/elements/bower_components/webcomponentsjs</pre>Before creating an element that use <code>&lt;google-map></code>, let's see if I can simply use it from an application page:<pre class=prettyprint>&lt;!doctype html><br />&lt;html lang="en"><br />  &lt;head><br />    &lt;title>My Maps&lt;/title><br /><b>    &lt;link<br />       rel="import"<br />       href="packages/my_maps/elements/bower_components/google-map/google-map.html"></b><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script><br />  &lt;/head><br />  &lt;body unresolved><br /><b>    &lt;google-map<br />       latitude="37.779"<br />       longitude="-122.3892"<br />       minZoom="9"<br />       maxZoom="11"<br />       fit>&lt;/google-map></b><br />  &lt;/body><br />&lt;/html></pre>After a <code>pub install</code> to grab Polymer.dart, I find that this most obvious approach will not work. I get errors in the console along the lines of:<pre class=prettyprint>Uncaught HierarchyRequestError: Failed to execute 'appendChild' on 'Node': Nodes of type 'HTML' may not be inserted inside nodes of type '#document'.<br /><br />Uncaught TypeError: Cannot read property 'resolveDom' of undefined<br /><br />Exception: Uncaught Error: NoSuchMethodError: method not found: 'whenPolymerReady'<br />Receiver: Instance of 'JsObject'<br />Arguments: [Closure: () => dynamic]<br />Stack Trace:<br />#0      JsObject.callMethod (dart:js:230)<br />#1      _hookJsPolymer (package:polymer/src/loader.dart:82:23)<br />#2      startPolymer.&lt;anonymous closure> (package:polymer/src/loader.dart:44:19)<br />...</pre>These errors would seem to be coming from duplicate <code>polymer.js</code> definitions—one from the Polymer.dart application and one that is pulled in from the <code>&lt;google-map></code> dependencies.<br /><br />As James found, If I work through each of the following:<ul><li><code>core-shared-lib/core-shared-lib.html</code></li><li><code>google-apis/google-maps-api.html</code></li><li><code>google-map/google-map-directions.html</code></li><li><code>google-map/google-map-search.html</code></li><li><code>google-map/google-map.html</code></li></ul>And I <i>hand-edit</i> the <code>&lt;link></code> import of Polymer, changing from the JavaScript version to the one supplied by Dart:<pre class=prettyprint>&lt;link rel="import" href="../../../../../packages/polymer/polymer.html"></pre>Then I get my map:<br /><br /><a href="http://3.bp.blogspot.com/-1J-f3vY5Es8/VRJGzR9XDWI/AAAAAAAAn-M/0ioIAdsyK_M/s1600/01-my_maps.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-1J-f3vY5Es8/VRJGzR9XDWI/AAAAAAAAn-M/0ioIAdsyK_M/s400/01-my_maps.png" /></a><br /><br />That is pretty ugly. There is no way that anyone should be hand-editing web component definitions like that in order to get them to work. I need to find another approach if I am going to recommend using this element. <br /><br />I do try to lock the JavaScript versions to to the same version used by Polymer.dart via my <code>bower.json</code> file:<pre class=prettyprint>{<br />  "name": "my-maps",<br /><b>  "dependencies": {<br />    "google-map": "GoogleWebComponents/google-map#0.4.1",<br />    "polymer": "Polymer/polymer#0.5.1",<br />    "webcomponentsjs": "Polymer/webcomponentsjs#0.5.1"<br />  }</b><br />}</pre>But that is of no avail. I still have to hand-edit the files in the list to prevent the error from the duplicate Polymer definitions. Looks like I need to try a different approach tomorrow.<br /><br /><br /><span style="color: #ccc">Day #8</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/new-and-old-style-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/custom-element-api-generation-for.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/LzyBZXksrjU" height="1" width="1" alt=""/>
