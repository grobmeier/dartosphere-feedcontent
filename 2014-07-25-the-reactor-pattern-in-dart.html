---
title: 'The Reactor Pattern in Dart'
layout: post
published: '2014-07-25T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/67wIba7sFJg/the-reactor-pattern-in-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - 'reactor pattern'

---

<div class=top-chain-links></div><br />I purposefully did not include the phrase “object oriented” in the title of <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>. The reason, of course, was that I hope to explore others software design patterns in the book. Some of the patterns that most interest me have to do with concurrency—not because that is where the action is in <a href="http://dartlang.org">Dart</a>, but because I am so weak with them. <br /><br />Let me start by stating that I do not <i>really</i> understand the difference between the actor model, the reactor pattern, regular old events, or the observer pattern. It is not that I have no idea, but rather that I know that I lack the understanding to be able to teach them or their differences. This is why I hope to include them in the book.<br /><br />Part of the challenge before me is that Dart is built on many of these patterns. Normal operations under Dart occur in an event loop that (I believe) is the reactor pattern. Isolates are built on the actor model. Streams support publish and subscribe. And so forth. So how do I discuss these patterns when they are the building blocks of the language? I really have no good answer to that question, but I have an idea how I can start thinking about them.<br /><br />So tonight, I implement the Reactor Pattern as described by Douglas C. Schmidt in his <a href="http://www.cs.wustl.edu/~schmidt/PDF/reactor-siemens.pdf">Reactor</a> paper. Since the reactor pattern is running underneath in Dart itself, this may be a little weird, but I'm going to try it anyhow.<br /><br />I start with the main dispatcher as:<pre class=prettyprint>class InitiationDispatcher {<br />  var events = {};<br /><br />  static final InitiationDispatcher _dispatcher =<br />    new InitiationDispatcher._internal();<br /><br />  factory InitiationDispatcher() {<br />    return _dispatcher;<br />  }<br /><br />  InitiationDispatcher._internal();<br /><br />  registerHandler(eventHandler, eventType) {<br />    events.putIfAbsent(eventType, ()=> []);<br />    events[eventType].push(eventHandler);<br />  }<br /><br />  removeHandler(eventHandler, eventType) {<br /><br />  }<br /><br />  handleEvents([int timeout=0]) {<br /><br />  }<br />}</pre>Then then handle event class is a simple keyboard reader:<pre class=prettyprint>class HandleKey {<br />  HandleKey(){<br />    new InitiationDispatcher().registerHandler(this, 'key');<br />  }<br /><br />  handle_event(eventType) {<br />    if (eventType == 'key') {<br />      print(handle);<br />    }<br />  }<br /><br />  get handle {<br /><br />  }<br />}</pre>As in the paper, I exploit the singleton nature of <code>InitiationDispatcher</code> to get the one instance and register this new keyboard handler.<br /><br />Finally main:<pre class=prettyprint>#!/usr/bin/env dart<br /><br />import 'package:reactor_code/InitiationDispatcher.dart';<br />import 'package:reactor_code/HandleKey.dart';<br /><br />main() {<br /><br />  new HandleKey();<br /><br /><br />  for(;;) {<br />    new InitiationDispatcher().handleEvents();<br />  }<br /><br />}<br /></pre>For my simple example, I stick with reading from STDIN. This is probably a mistake because there is not really a <code>select()</code> equivalent that I can find in <code>dart:io</code>'s <code>Stdin</code> class.<br /><br /><br /><span style="color: #ccc">Day #133</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/07/logarithmic-scales-for-when-winner-is.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/67wIba7sFJg" height="1" width="1"/>
