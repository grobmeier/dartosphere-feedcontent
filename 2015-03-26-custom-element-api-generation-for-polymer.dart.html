---
title: 'Custom Element API Generation for Polymer.dart'
layout: post
published: '2015-03-26T00:03:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/MQJnnBBCkoY/custom-element-api-generation-for.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - google-maps
    - google-maps-api
    - js-interop
    - polymer

---

<div class=top-chain-links></div><br />You could say that I've forgotten more about <a href="http://www.polymer-project.org/">Polymer</a> than most programmers will ever know. I would probably agree, but that's just because I have a crap memory. <br /><br />I was able to get the <code>&lt;google-map></code> JavaScript Polymer element to work in a <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> context yesterday, but only by hand-editing the JavaScript source files that I had installed via <a href="http://bower.io">Bower</a>—not at all cool. Happily, <a href="https://www.google.com/+JamesHurford">James Hurford</a> reminded me that I should be using <a href="https://pub.dartlang.org/packages/custom_element_apigen">custom_element_apigen</a> to wrap JavaScript Polymer elements in <a href="http://dartlang.org">Dart</a>. <br /><br />I have looked at it in the past, but in my defense, it <a href="http://japhr.blogspot.com/2014/10/customelementapigen-and-using.html">caused me grief</a>. So maybe it was repression instead of a failing memory. Let's stick with that story, shall we?<br /><br />I give custom_element_apigen another try tonight by first adding it to the list of development dependencies in my sample application:<pre class=prettyprint>name: my_maps<br />dependencies:<br />  polymer: any<br /><b>dev_dependencies:<br />  custom_element_apigen: any</b><br />transformers:<br />- polymer:<br />    entry_points:<br />    - web/index.html</pre>I have to update the location in which <a href="http://bower.io">Bower</a> installs its packages so that custom_element_apigen can find the elements that I want to use in my Dart application. So I modify the <code>.bowerrc</code> configuration file to install everything in <code>lib/src</code>:<pre class=prettyprint>{<br />  "directory": "lib/src"<br />}</pre>Installing now places these dependencies in <code>lib/src</code> as desired:<pre class=prettyprint>$ bower install<br />...<br />polymer#0.5.1 <b>lib/src</b>/polymer<br />├── core-component-page#0.5.5<br />└── webcomponentsjs#0.5.1<br /><br />google-map#0.4.1 <b>lib/src</b>/google-map<br />└── google-apis#0.4.4  <br /><br />webcomponentsjs#0.5.1 lib/src/webcomponentsjs<br /><br />core-component-page#0.5.5 lib/src/core-component-page<br />├── polymer#0.5.1<br />└── webcomponentsjs#0.5.1<br /><br />google-apis#0.4.4 lib/src/google-apis<br />└── core-shared-lib#0.5.5<br /><br />core-shared-lib#0.5.5 lib/src/core-shared-lib<br />└── polymer#0.5.1</pre>With that, I am ready to create a configuration file for custom_element_apigen. The project is still woefully (and self-admittedly) under-documented. Thankfully, I still have my old configuration file from the last time, so I adapt it for <code>&lt;google-map></code>. I save the following in <code>apigen.yaml</code>:<pre class=prettyprint>files_to_generate:<br />  - google-map/google-map.html</pre>I then run the generate command. In addition to lack of documentation, it also lacks output. Even so, it does not take too much work to find the generated files:<pre class=prettyprint>$ <b>pub run custom_element_apigen:update apigen.yaml </b><br />Done                                      <br /><br />$ ls -ltr lib<br />total 32<br />drwxr-xr-x 2 chris chris 4096 Mar 24 23:57 assets<br />drwxr-xr-x 2 chris chris 4096 Mar 25 23:04 elements<br />drwxr-xr-x 8 chris chris 4096 Mar 25 23:04 src<br /><b>-rw-r--r-- 1 chris chris  114 Mar 25 23:07 google_map_nodart.html<br />-rw-r--r-- 1 chris chris  164 Mar 25 23:07 google_map.html<br />-rw-r--r-- 1 chris chris 9065 Mar 25 23:07 google_map.dart</b></pre>Based on the <code>nodart</code> file, it seems that custom_element_apigen supports both the <a href="http://japhr.blogspot.com/2015/03/new-and-old-style-polymerdart.html">new and old style</a> importing approaches. In my sample application page, I opt for the new, code-import style:<br /><pre class=prettyprint>&lt;!doctype html><br />&lt;html lang="en"><br />  &lt;head><br /><b>    &lt;script type="application/dart"><br />      import 'package:my_maps/google_map.dart';<br />      export 'package:polymer/init.dart';<br />    &lt;/script></b><br />  &lt;/head><br />  &lt;body unresolved><br />    &lt;google-map<br />       latitude="37.779"<br />       longitude="-122.3892"<br />       minZoom="9"<br />       maxZoom="11"<br />       fit>&lt;/google-map><br />  &lt;/body><br />&lt;/html><br /></pre>When I try to run my simple application, <code>pub serve</code> reports:<pre class=prettyprint>[Error from polymer (PolymerBootstrapTransformer) on my_maps|web/index.html]:<br />Could not load asset my_maps|lib/google_maps_api.dart<br />[Warning from polymer (PolymerBootstrapTransformer) on my_maps|web/index.html]:<br />line 2, column 1 of lib/google_map_nodart.html: Failed to inline HTML import: Could not find asset my_maps|lib/google_maps_api_nodart.html.<br />null. See http://goo.gl/5HPeuP#web_components_4 for details.<br />&lt;link rel="import" href="google_maps_api_nodart.html"><br />^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</pre>So I update my <code>apigen.yaml</code> file to include this element from the Bower-installed JavaScript dependency:<pre class=prettyprint>files_to_generate:<br />  - google-map/google-map.html<br /><b>  - google-apis/google-maps-api.html</b></pre>I re-run <code>pub run custom_element_apigen:update apigen.yaml</code>, restart <code>pub serve</code>, and it fails again. This time with a different element. I repeat this process until my <code>agigen.yaml</code> file contains:<pre class=prettyprint>files_to_generate:<br />  - google-map/google-map.html<br />  - google-apis/google-maps-api.html<br />  - core-shared-lib/core-shared-lib.html</pre>I again re-run <code>pub run custom_element_apigen:update apigen.yaml</code>, again restart <code>pub serve</code>, and finally, I have a working <code>&lt;google-map></code> in a Polymer.dart application:<br /><br /><a href="http://3.bp.blogspot.com/-vmiDoVBrUD0/VRN8s05TPhI/AAAAAAAAn_A/P7EBOE79Xbw/s1600/01-api_gen_google_map.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-vmiDoVBrUD0/VRN8s05TPhI/AAAAAAAAn_A/P7EBOE79Xbw/s400/01-api_gen_google_map.png" /></a><br /><br />Nice. <br /><br />I had used explicit Bower dependencies last night in a attempt to eliminate <code>webcomponentjs.js</code> incompatibilities between my Polymer.dart code and my Polymer.js elements:<pre class=prettyprint>{<br />  "name": "my-maps",<br /><b>  "dependencies": {<br />    "google-map": "GoogleWebComponents/google-map#0.4.1",<br />    "polymer": "Polymer/polymer#0.5.1",<br />    "webcomponentsjs": "Polymer/webcomponentsjs#0.5.1"<br />  }</b><br />}</pre>I relax those dependencies now:<pre class=prettyprint>{<br />  "name": "my-maps",<br />  "dependencies": {<br />    "google-map": "GoogleWebComponents/google-map#<b>~0.4.2</b>",<br />    "polymer": "Polymer/polymer#<b>~0.5.5</b>",<br />    "webcomponentsjs": "Polymer/webcomponentsjs#<b>~0.5.5</b>"<br />  }<br />}</pre>After a re-install of the Bower dependencies, I have:<pre class=prettyprint>$ bower install<br />...<br /><b>webcomponentsjs#0.5.5</b> lib/src/webcomponentsjs<br /><br />google-map#0.4.2 lib/src/google-map<br /><br />polymer#0.5.5 lib/src/polymer<br />...<br /></pre>Polymer.dart bundles version 0.5.1 of <code>webcomponentsjs</code> so this could cause problems. <i>Without</i> re-running the apigen command, I try to load my application. Pub generates it OK, but it does not work in the browser and I see similar error messages in the console as I saw last night:<pre class=prettyprint>Uncaught HierarchyRequestError: Failed to execute 'appendChild' on 'Node': Nodes of type 'HTML' may not be inserted inside nodes of type '#document'.</pre>Hopefully custom_element_apigen is smart enough to resolve this. I re-run the generate command:<pre class=prettyprint>$ pub run custom_element_apigen:update apigen.yaml<br />Done</pre>After restarting <code>pub serve</code> I find that the application is working again. Yay! <br /><br />Forcing <code>webcomponentsjs</code> dependencies would have been a significant pain had that not worked—especially if it prevented the use of newer JavaScript custom elements in Polymer.dart. Thankfully the custom_element_apigen package has me covered.<br /><br />Happily, this worked out much better for me than my last attempt at working with custom_element_apigen. I still need to experiment with using the generated elements in other elements (material for tomorrow). But this is promising. It would be nice if the generator were a little more helpful about the files that need to be generated, but this was not <i>too</i> bad. <br /><br />There is an outside chance that I may even remember custom_element_apigen in 6 months!<br /><br /><br /><span style="color: #ccc">Day #9</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/ugly-google-maps-api-from-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/using-google-map-polymer-in-polymerdart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/MQJnnBBCkoY" height="1" width="1" alt=""/>
