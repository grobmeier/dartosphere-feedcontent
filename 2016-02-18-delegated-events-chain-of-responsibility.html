---
title: 'Delegated Events Chain of Responsibility'
layout: post
published: '2016-02-18T23:31:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/4go33hm1wNY/delegated-events-chain-of-responsibility.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'chain of responsibility pattern'
    - dart
    - dartlang
    - 'design patterns'

---

<div class=top-chain-links></div><br />I came up with a simple DOM-based example of the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility pattern</a> last night. That might serve as an simple introduction to the pattern on the modern web, but I would prefer something with a little more heft to support subsequent discussions. So tonight, I attempt to apply the pattern to cell formatting object.<br /><br />Given a bunch of cells in a table, I would like a series of objects to format input values correctly. Numbers should have 2 decimal places and be right-aligned. Dates should be iso8601 formatted and left aligned. Everything else should be treated as plain text and left aligned:<br /><br /><a href="https://1.bp.blogspot.com/-VyGmsnPbJa8/Vsa9zuSWWZI/AAAAAAABEKs/XudgDFtqzY0/s1600/01-format_chain.png" imageanchor="1" ><img border="0" src="https://1.bp.blogspot.com/-VyGmsnPbJa8/Vsa9zuSWWZI/AAAAAAABEKs/XudgDFtqzY0/s640/01-format_chain.png" width=570 /></a><br /><br />The handler in this chain of responsibility implementation is going to be a listener for change events on the container:<pre class=prettyprint><code>  container.onChange.listen(handler.processRequest);</code></pre>I do not want a separate listener for each cellâ€”that could wind up being a very large number of cells and listeners. Instead, I use a <a href="http://api.jquery.com/on/#direct-and-delegated-events">delegated events</a> approach, listening on the container and filtering events based on the target.<br /><br />The handler in this example will be the <code>CellFormatter</code>. As with any chain of responsibility implementation, the first thing that it needs is a way to specify the next link in the chain. In this case, the next handler:<pre class=prettyprint>abstract class CellFormatter {<br />  CellFormatter nextHandler;<br />  // ...<br />}</pre>Next, I need to process events:<pre class=prettyprint>abstract class CellFormatter {<br />  // ...<br />  void processRequest(Event e) {<br />    if (!isCell(e)) return;<br />    if (handleRequest(e)) return;<br />    if (nextHandler == null) return;<br /><br />    nextHandler.processRequest(e);<br />  }<br /><br />  bool handleRequest(Event e) => false;<br />  // ...<br />}</pre>First, I filter on cells (text input fields). Then I try to handle the current request. The default implementation here is for <code>handleRequest</code> to not handle the request, which it signals by returning false. It will be the job of the concrete subclasses to properly handle requests. If the request is not handled, then the request sent to the next object in the chain, if defined.<br /><br />With that, I am ready to process different formatting, like <code>NumberFormatter</code>:<pre class=prettyprint>class NumberFormatter extends CellFormatter {<br />  bool handleRequest(Event e) {<br />    var input = e.target;<br />    RegExp exp = new RegExp(r"^\s*[\d\.]+\s*$");<br />    if (!exp.hasMatch(input.value)) return false;<br /><br />    var val = double.parse(input.value);<br />    input.value = val.toStringAsFixed(2);<br />    input.style.textAlign = 'right';<br />    return true;<br />  }<br />}</pre>If the current change event targets an input that does not match the numeric regular expression, <code>handleRequest()</code> returns <code>false</code> and the event is sent along to the next formatter object in the chain. If it does point to a numeric input element, the value is parsed and formatted with two digits after the decimal point. The text alignment of the input element is set appropriately for a numeric field. And that's it.<br /><br />Other formatters follow similar approaches until the last item in the chain, the default text formatter. This formatter applies no formatting to the value, but ensures the left alignment of the field:<pre class=prettyprint>class TextFormatter extends CellFormatter {<br />  bool handleRequest(Event e) {<br />    var input = e.target;<br />    input.style.textAlign = 'left';<br />    return true;<br />  }<br />}</pre>Armed with my formatters, I can create them in client code:<pre class=prettyprint><code>  var number = new NumberFormatter();<br />  var date = new DateFormatter();<br />  var text = new TextFormatter();</code></pre>Then, I establish the successor chain:<pre class=prettyprint><code>  number.nextHandler = date;<br />  date.nextHandler = text;</code></pre>That is all there is to it. Now when the event listener sends a request to the first item in the chain:<pre class=prettyprint><code>  container.onChange.listen(number.processRequest);</code></pre>I know that one of the handlers will receive and process the event. I think that will be a reasonably accessible example for most readers. I may fiddle a bit more with the example tomorrow to be sure.<br /><br /><i>Play with the code on DartPad: <a href="https://dartpad.dartlang.org/21f67a92a0269a2aed6b">https://dartpad.dartlang.org/21f67a92a0269a2aed6b</a>.</i><br /><br /><br /><span style="color: #ccc">Day #99</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2016/02/a-dom-chain-of-responsibility.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2016/02/consequences-of-chain-of-responsibility.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/4go33hm1wNY" height="1" width="1" alt=""/>
