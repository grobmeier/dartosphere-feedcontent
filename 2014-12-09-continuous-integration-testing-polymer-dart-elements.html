---
title: 'Continuous Integration Testing Polymer (Dart) Elements'
layout: post
published: '2014-12-09T23:59:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/HHnzZ13dgEM/continuous-integration-testing-polymer.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'continuous integration'
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />Tonight, I place a <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> project under continuous integration. I have done similar work with some of the tests in the <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> book, but that is running on a custom install Jenkins server. This time, I am going to install on a standard CI service—<a href="http://drone.io">Drone.io</a>.<br /><br />Last night I got a command-line build script ready for the <code>AFormInput</code> class/mixin. I hope that getting that test running on the  service will be similar to "regular" <a href="http://dartlang.org">Dart</a> projects, but there is only one way to be sure. The only difference between these tests and regular Dart CI that I can foresee causing trouble is the need to fire up a <a href="http://pub.dartlang.org/">Dart Pub</a> server during the tests. The test script from last night <i>should</i> take care of this—it is more a question of if the CI service will allow it.<br /><br />I start by publishing the project to GitHub at: <a href="https://github.com/eee-c/a-form-input-dart">https://github.com/eee-c/a-form-input-dart</a>. With that, I am ready to create a new project in Drone, which is done by selecting a project from the list of GitHub projects associated with my account:<br /><br /><a href="http://4.bp.blogspot.com/-3_1iBzNwWzc/VIfKf8nC6SI/AAAAAAAAh8o/rKCaBC7BDaU/s1600/01-select-repo.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-3_1iBzNwWzc/VIfKf8nC6SI/AAAAAAAAh8o/rKCaBC7BDaU/s400/01-select-repo.png" /></a><br /><br />The choice of project template is easy:<br /><br /><a href="http://3.bp.blogspot.com/-7kLpV85PFRs/VIfKfeKnJaI/AAAAAAAAh8c/WRYXjYTlvj4/s1600/02-dart_ci.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-7kLpV85PFRs/VIfKfeKnJaI/AAAAAAAAh8c/WRYXjYTlvj4/s400/02-dart_ci.png" /></a><br /><br />And the initial test setup looks great (I created test/run.sh last night):<br /><br /><a href="http://4.bp.blogspot.com/-m6iy4ltD2ew/VIfKfJYuiWI/AAAAAAAAh8Y/SUT2nivmxhg/s1600/03-default_build_command.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-m6iy4ltD2ew/VIfKfJYuiWI/AAAAAAAAh8Y/SUT2nivmxhg/s400/03-default_build_command.png" /></a><br /><br />With that, I think I'm ready to test:<br /><br /><a href="http://4.bp.blogspot.com/-4xtuSz9Kh1U/VIfKfm-yufI/AAAAAAAAh8g/BIhFHtEOYJg/s1600/04-ready_to_build.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-4xtuSz9Kh1U/VIfKfm-yufI/AAAAAAAAh8g/BIhFHtEOYJg/s400/04-ready_to_build.png" /></a><br /><br />Or not. The first build fails with:<pre class=prettyprint>$ test/run.sh<br />Analyzing [lib/a_form_input.dart]...<br />No issues found<br />Looks good!<br /><br />Loading source assets...<br />Loading polymer transformers...<br />Serving a-form-input test on http://localhost:8080<br />Build completed successfully<br /><b>test/run.sh: line 20: content_shell: command not found</b></pre>That's a <a href="http://japhr.blogspot.com/2013/11/auto-install-contentshell-from-ci-like.html">solved problem</a>, so I solve it again by adding a step in <code>test/run.sh</code> to install content_shell:<pre class=prettyprint>#!/bin/bash<br /><br /># Static type analysis...<br /><br /><b># Install content_shell if not already present<br />which content_shell<br />if [[ $? -ne 0 ]]; then<br />  $DART_SDK/../chromium/download_contentshell.sh<br />  unzip content_shell-linux-x64-release.zip<br /><br />  cs_path=$(ls -d drt-*)<br />  PATH=$cs_path:$PATH<br />fi</b><br /><br /># Run tests...<br /></pre>With that... the build still fails. I was not sure it would be necessary, but indeed, I do need to start xvfb to provide the X windowing environment for content_shell:<pre class=prettyprint><b>sudo start xvfb</b><br />pub install<br />test/test_runner.sh</pre>And with <i>that</i>, I have a passing build—pub server and all:<pre class=prettyprint>Loading source assets...<br />Loading polymer transformers...<br />Serving a-form-input test on http://localhost:8080<br />Build completed successfully<br />....<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> has a shadowRoot<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - value property is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - form value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - containing form includes input with supplied name attribute<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - setting the name property updates the name attribute<br />CONSOLE MESSAGE: <br />CONSOLE MESSAGE: All 6 tests passed.</pre>With the build passing:<br /><br /><a href="http://3.bp.blogspot.com/-ZPnxYkSgTVE/VIfKf7GbRPI/AAAAAAAAh8k/ltX_VEmTtsk/s1600/05-success.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-ZPnxYkSgTVE/VIfKf7GbRPI/AAAAAAAAh8k/ltX_VEmTtsk/s400/05-success.png" /></a><br /><br />All that is left is to copy the badge code:<br /><br /><a href="http://3.bp.blogspot.com/-cmxi9-tV2HY/VIfKf6GC2yI/AAAAAAAAh8s/bb0l7IBJJS8/s1600/06-copy_badge.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-cmxi9-tV2HY/VIfKf6GC2yI/AAAAAAAAh8s/bb0l7IBJJS8/s400/06-copy_badge.png" /></a><br /><br />Into the project README:<br /><br /><a href="http://3.bp.blogspot.com/-VlPXh-GIKkA/VIfKgXUW54I/AAAAAAAAh8w/3_2eLOPgO5Y/s1600/07-badge_on_readme.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-VlPXh-GIKkA/VIfKgXUW54I/AAAAAAAAh8w/3_2eLOPgO5Y/s400/07-badge_on_readme.png" /></a><br /><br />And that is all there is to it! So my worries were unfounded—Drone.io makes it just as easy to test a Polymer.dart project as it does to test any other Dart project. That is great news. Up tomorrow, I will push my luck by attempting to do the same with a JavaScript <a href="http://www.polymer-project.org/">Polymer</a> project.<br /><br /><br /><span style="color: #ccc">Day #19</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/testing-polymer-dart-mixins.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/HHnzZ13dgEM" height="1" width="1" alt=""/>
