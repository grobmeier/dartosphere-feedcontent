---
title: 'Reflecting on Class, Reflecting on Object'
layout: post
published: '2014-05-10T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/cbG6W6faF60/reflecting-on-class-reflecting-on-object.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - annotations
    - chain
    - dart
    - dartlang
    - reflection

---

<div class=top-chain-links></div><br />I don't want to classify reflection in <a href="http://dartlang.org">Dart</a> as bewildering, but I confess to being a bit befuddled, at the least.<br /><br />Let me be clear: I am not criticizing <code>dart:mirrors</code>. I know very little about reflection in static languages, but the little that I do know seems similar to what I see in Dart. In other words, this is probably just the nature of the beast that is reflection. Given that, I seek tonight to better understand reflection of classes—in particular the means to obtaining code information vs. obtaining a reference to the running code.<br /><br />To obtain a reference to a runtime function, I <code>reflect()</code> on the function by name. To obtain an object that encapsulates the code as it was defined / declared, I can use a property of that reflected function (that property being the <code>function</code> property of a <code>ClosureMirror</code>). <br /><br />As I found last night, things seem different with classes than functions. Instead of reflecting on a class to obtain a runtime mirror which has a property that points to the class's declaration mirror, there is the <code>reflectClass()</code>, which gives direct access to the code declaration. I am curious why this is the case—why doesn't <code>reflect()</code> on a class return an object reference that has a code declaration property?<br /><br />To answer, I explore the <code>InstanceMirror</code> that <i>is</i> returned when <code>reflect()</code> is called on a class. If <code>main()</code> is a function and <code>Foo</code> is a class, then the following:<pre class=prettyprint>main() {<br />  print(reflect(main));<br />  print(reflect(Foo));<br />}</pre>Will place the following on command output:<pre class=prettyprint>ClosureMirror on 'Closure: () => dynamic from Function 'main': static.'<br />InstanceMirror on Type: class 'Foo'</pre>So what good is an instance mirror on class <code>Foo</code>?<br /><br />There does not seem to be a way to create a new object from the class instance mirror:<pre class=prettyprint>main(){<br />  var fooMirror = reflect(Foo);<br />  var foo2 = new (fooMirror.reflectee)();<br />}</pre>Produces:<pre class=prettyprint>$ dartanalyzer main.dart && dart main.dart<br />Analyzing main.dart...<br />[error] Expected a type name (/home/chris/repos/gists/reflecting_annotations/main.dart, line 22, col 18)<br />[warning] Undefined class '' (/home/chris/repos/gists/reflecting_annotations/main.dart, line 22, col 18)<br />1 error and 1 warning found.<br /></pre>I am unable to find any particular use for <code>reflect(Foo)</code>. The <code>Type</code> that the instance mirror is reflecting seems to have no useful properties. I am unable to even access the <code>Foo</code> class from it. The only thing I can do is grab the actual class from the <code>reflectee</code> property so that I can then do useful work with the <code>reflectClass()</code> function:<pre class=prettyprint>main() {<br />  print(reflect(main));<br />  print(reflect(Foo));<br /><b>  print(reflectClass(reflect(Foo).reflectee).metadata[0].reflectee);</b><br />}</pre>Which produces:<pre class=prettyprint>ClosureMirror on 'Closure: () => dynamic from Function 'main': static.'<br />InstanceMirror on Type: class 'Foo'<br />[meta] Foo should not be used in real life</pre>Ah, so perhaps that is the use case for reflecting on a class. When the class is not known as runtime (e.g. it is passed into a function), one could reflect on the supplied class, grab the reflectee property, and then use <code>reflectClass()</code>. Or is there some other use that I am missing?<br /><br /><br /><span style="color: #ccc">Day #59</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/reflecting-on-dart-classes-and-variables.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/webgl-in-chrome-36-linux-is-not-working.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/cbG6W6faF60" height="1" width="1"/>
