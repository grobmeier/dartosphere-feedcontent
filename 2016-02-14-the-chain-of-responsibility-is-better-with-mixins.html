---
title: 'The Chain of Responsibility is Better with Mixins'
layout: post
published: '2016-02-14T21:21:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/KBOKXskwMxU/the-chain-of-responsibility-with-mixins.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'chain of responsibility pattern'
    - dart
    - dartlang
    - 'design patterns'
    - mixins

---

<div class=top-chain-links></div><br />Having spent the entirety of last night's post lamenting the practice of using pattern-specific naming conventions, tonight Iâ€¦ use some pattern specific naming conventions. Well, maybe.<br /><br />Tonight, I try out mixins as a possible implementation for the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility pattern</a>. I am unsure how it will work, but before trying it, it seems as though I will need to use patterns names in the mixin class. <br /><br />Something that I hope to explore in <a href="http://designpatternsindart.com/">Design Patterns in Dart</a> are <a href="http://dartlang.org">Dart</a> twists on design patterns. On classic OO patterns, that should involve mixins. That said, the main reason that I think mixins might be appropriate in this case is that the example that I adapted from the Wikipedia pages bothers me:<pre class=prettyprint><code>  var manager = new ManagerPurchasePower();<br />  var director = new DirectorPurchasePower();<br />  var vp = new VicePresidentPurchasePower();<br />  var president = new PresidentPurchasePower();</code></pre>I realize that this is example code, but I am hard-pressed to think that I would ever code up objects named "purchasing power." It seem much more likely that I would create <code>Manager</code>, <code>Director</code>, etc. classes with purchasing power traits. Hence, the thinking that mixins might be a good solution.<br /><br />A more real-world example, I think, would be an <code>Employee</code> class:<pre class=prettyprint>class Employee {<br />  String firstName, lastName;<br />  Employee reportsTo;<br />}</pre>The <code>Manager</code>, <code>Director</code> classes would then extend this class:<pre class=prettyprint>class Manager extends Employee {<br />  // Manager specializations here...<br />}<br />class Director extends Employee {<br />  // Director specializations here..<br />}<br />// ...</pre>In this scenario, a purchasing power chain of responsibility can be described with:<pre class=prettyprint>abstract class _PurchasePower {<br />  get successor => reportsTo;<br /><br />  void processRequest(PurchaseRequest request) {<br />    if (_processRequest(request)) return;<br />    if (successor == null) return;<br /><br />    successor.processRequest(request);<br />  }<br /><br />  bool _processRequest(_) => false;<br />}</pre>The successor in this chain is delegated to the <code>reportsTo</code> property of <code>Employee</code>. I could also have replaced subsequent references to <code>successor</code> with <code>reportsTo</code> and the code would have remained equally readable. I opt to stick with the pattern participant name (successor) as a default starting point. The domain naming convention from last night may very well prove more maintainable. Then again, since this mixin class exists solely to implement the chain of responsibility pattern, perhaps its domain is really the pattern itself. Unsure, I opt for the pattern name for now.<br /><br />In handle-request method, I first try to process the request with a subclass overrideable <code>_processRequest()</code> method. If the subclass' <code>_processRequest()</code> handles the request, it returns <code>true</code>, breaking the chain. If the subclass' implementation returns <code>false</code> (or the default implementation is invoked), then the next item in the chain is asked to handle the request.<br /><br />Armed with this <code>_PurchasePower</code> class, I can mix it into the subclasses of <code>Employee</code> with the <code>with</code> keyword:<pre class=prettyprint>class Manager extends Employee with _PurchasePower {<br />  final double _allowable = 10 * 1000.0;<br /><br />  bool _processRequest(PurchaseRequest request) {<br />    if (request.amount > _allowable) return false;<br /><br />    print("Manager will approve $request.");<br />    return true;<br />  }<br />}</pre>For the <code>Manager</code> class, the purchasing power traits are expressed by the overridden <code>_processRequest()</code> method. If the purchase request amount is more than $10,000, then the manager is unable to approve the request. The chain of responsibility is then passed back to the <code>processRequest()</code> method in the <code>_PurchasePower</code> mixin. In that case the <code>successor</code> / <code>reportsTo</code> is then asked to handle the request.<br /><br />The successor chain is expressed in the <code>Employee</code> class, though technically it is only in the <code>_PurchasePower</code> mixin that this relationship recognized as a chain. The actual relationship is established in client code (alternatively, last night's solution can establish the relationship in the classes):<pre class=prettyprint><code>  var manager = new Manager();<br />  var director = new Director();<br /><br />  manager.reportsTo = director;</code></pre>Although I remain unsure of some of the specifics like naming, I very much appreciate this mixins approach. In hindsight, the original class names (e.g. <code>ManagerPurchasingPower</code>) were probably screaming at me that a mixin was trying to escape from my code. Regardless, encapsulating the pattern entirely in a mixin class while limiting <code>Employee</code> subclasses to employee-specific responsibilities feels like clean, maintainable code. So this feels very much like a win.<br /><br /><i>Play with the code on DartPad: <a href="https://dartpad.dartlang.org/752e601e8768cb2f26e5">https://dartpad.dartlang.org/752e601e8768cb2f26e5</a>.</i><br /><br /><br /><span style="color: #ccc">Day #95</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2016/02/wacky-successor-chain-of-responsibility.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2016/02/how-much-mixin-chain-of-responsibility.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/KBOKXskwMxU" height="1" width="1" alt=""/>
