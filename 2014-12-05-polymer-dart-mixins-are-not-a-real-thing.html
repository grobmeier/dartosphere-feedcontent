---
title: 'Polymer (Dart) Mixins Are Not a Real Thing'
layout: post
published: '2014-12-05T23:15:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/Qg0exMZ9mPk/polymer-dart-mixins-are-not-real-thing.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - mixins
    - polymer

---

<div class=top-chain-links></div><br />I don't know how it happened, but I realized today that I rather appreciate the expressiveness of <a href="http://dartlang.org">Dart</a> mixins. At first they seemed little more than a curiosity, but I find myself wanting to use them more and more. I am at the point that they are something of a <a href="http://c2.com/cgi/wiki?GoldenHammer">Golden Hammer</a> in my thinking. In other words, what I am trying tonight will almost certainly not work.<br /><br />But it might.<br /><br />I have my Polymer baseclass for converting other Polymer elements into native HTML form elements in decent shape. After last night, it even works as a package. So I ought to write some tests, publish it to <a href="http://pub.dartlang.org/">Dart Pub</a> and move onto other territory. <br /><br />But what if I could use mixins to replace this syntax for using <code>AFormInput</code>:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'package:a-form-input/a_form_input.dart';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends AFormInput {<br />  // Polymer code here...<br />}</pre>A mixin version might look something like:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'package:a-form-input/a_form_input.dart';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement <b>with AFormInput</b> {<br />  // Polymer code here...<br />}</pre>I can appreciate that because it makes it more clear that my <code>&lt;x-pizza></code> element is a polymer element with form input traits mixed into the fun. In other words, <code>&lt;x-pizza></code> <a href="http://en.wikipedia.org/wiki/Is-a">is-a</a> <code>PolymerElement</code> with <code>AFormInput</code> mixed-in.<br /><br />Maybe it is a small difference, but in my current form, there is no way of know what <code>AFormInput</code> is. Presumably, it is some kind of <code>PolymerElement</code> based on the <code>@CustomTag</code> annotation, but what kind of Polymer element it is remains a mystery (does it directly subclass <code>PolymerElement</code>? Extend another class that subclasses <code>PolymerElement</code>?). I also appreciate the abstract nature of mixins—they make it much harder to add cruft that belongs elsewhere. <br /><br />This probably will not work because lifecycle methods like <code>attached()</code>, <code>created()</code>, and <code>ready()</code> all expect some kind of traditional inheritance. Still, it is worth a try.<br /><br />So I define <code>AFormInputMixin</code> as:<pre class=prettyprint>library a_form_input;<br /><br />import 'package:polymer/polymer.dart';<br />import 'dart:html';<br /><br />abstract class AFormInputMixin {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br />}<br /></pre>As I mentioned, mixin classes need to be abstract. I will need to add other functionality, but these properties are the absolute minimum needed to start. <br /><br />In the concrete <code>&lt;x-pizza></code> element, I now mix this class in:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />// import 'a_form_input.dart';<br />// import 'package:a-form-input/a_form_input.dart';<br />import 'package:a-form-input/a_form_input_mixin.dart';<br /><br />@CustomTag('x-pizza')<br />// class XPizza extends AFormInput {<br /><b>class XPizza extends PolymerElement with AFormInputMixin {</b><br />  // ...<br />}</pre>But, when I <code>pub serve</code> or build the code, I get:<pre class=prettyprint>[Warning from Observable on form_example|../../../../a-form-input-dart/lib/a_form_input_mixin.dart]:<br />line 7, column 3 of ../../../../a-form-input-dart/lib/a_form_input_mixin.dart: Observable fields must be in observable objects. Change this class to extend, mix in, or implement Observable. See http://goo.gl/5HPeuP#observe_5 for details.<br />@PublishedProperty(reflect: true)<br />^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br />[Warning from Observable on form_example|../../../../a-form-input-dart/lib/a_form_input_mixin.dart]:<br />line 10, column 3 of ../../../../a-form-input-dart/lib/a_form_input_mixin.dart: Observable fields must be in observable objects. Change this class to extend, mix in, or implement Observable. See http://goo.gl/5HPeuP#observe_5 for details.<br />@PublishedProperty(reflect: true)<br />^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</pre>All right, that is fair enough. In order for the annotations to have an effect, I need for the class to be some kind of observable object. So I make the <code>&lt;a-form-input></code> a direct subclass of <code>Observable</code>:<pre class=prettyprint>abstract class AFormInputMixin extends Observable {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br />}</pre>I can now build the <code>&lt;x-pizza></code> element that mixes this in without warnings or errors, but when I try to access the element in <a href="http://www.dartlang.org/dartium/">Dartium</a> , I get:<pre class=prettyprint>Internal error: 'package:form_example/elements/x_pizza.dart': error: line 13 pos 42: mixin class 'AFormInputMixin' must extend class 'Object'<br />class XPizza extends PolymerElement with AFormInputMixin, ChangeNotifier {<br />                                         ^</pre>Bother.<br /><br />Well, I know that <code>Observable</code> works as a mixin as well, so I should be able to extend <code>Object</code> (as the runtime wants) and mixin <code>Observable</code> (as compile time wants):<pre class=prettyprint>abstract class AFormInputMixin extends Object with Observable {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br />}</pre>Extending <code>Object</code> like that is something of a cheat (OK it's entirely a cheat) because I am not mixing behavior into anything at this point—just the top-level object. I would definitely avoid that in concrete classes, but I can live with it inside another mixin.<br /><br />Except it does not work. Even though I am explicitly extending <code>Object</code>, runtime still reports:<pre class=prettyprint>Internal error: 'package:form_example/elements/x_pizza.dart': error: line 13 pos 42: mixin class 'AFormInputMixin' must extend class 'Object'<br />class XPizza extends PolymerElement with AFormInputMixin, ChangeNotifier {<br />                                         ^</pre>Gosh. Darn. It.<br /><br />After some fiddling, I determine that this error has nothing to do with my explicit class declaration of the mixin. If I remove the <code>@PublishedProperty</code> annotations, then everything compiles and runs just fine. Well, just fine until my concrete Polymer element tries to use the no longer published <code>value</code> property:<pre class=prettyprint>Exception: Class 'XPizza' has no instance setter 'value='.<br /><br />NoSuchMethodError: method not found: 'value='<br />Receiver: Instance of 'XPizza'<br />Arguments: ["First Half: []\nSecond Half: []\nWhole: []"]</pre>Unfortunately, I cannot think of anything else to try at this point. At the risk of casting these grapes as sour, I still doubt that the lifecycle methods would have worked without some kind of mixin convention. All the same, this would have been fun. Maybe in a future version of <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>.<br /><br /><br /><span style="color: #ccc">Day #15</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/one-weird-trick-to-getting-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/12/i-may-have-given-up-prematurely-on-dart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/Qg0exMZ9mPk" height="1" width="1" alt=""/>
