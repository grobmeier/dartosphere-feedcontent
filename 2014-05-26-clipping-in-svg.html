---
title: 'Clipping in SVG'
layout: post
published: '2014-05-26T23:58:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/GVrBH-YqcIA/clipping-in-svg.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg

---

<div class=top-chain-links></div><br />I cannot help but think I still have several, fundamental gaps in my SVG knowledge. This is OK. Well… mostly OK.<br /><br />My primary focus nowadays is <a href="http://www.polymer-project.org/">Polymer</a>, not SVG. As I ready to produce the screencasts for the “Extras” edition of <a href="http://patternsinpolymer.com">Patterns in Polymer</a> I am trying to gain some understanding of SVG so that I can produce an <code>&lt;x-pizza></code> custom element that enables hungry folks to build their own pizzas:<br /><br /><a href="http://2.bp.blogspot.com/-l6t_Nm_4kCo/U4PfrxqmhRI/AAAAAAAAZzk/ae21cwpSYZE/s1600/03-x_pizza_with_svg_images.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-l6t_Nm_4kCo/U4PfrxqmhRI/AAAAAAAAZzk/ae21cwpSYZE/s400/03-x_pizza_with_svg_images.png" /></a><br /><br />I am almost certainly over-thinking the SVG component of this, but I hate to recommend an approach that proves difficult or impossible to maintain. All the more so if the recommendation is going into video. I am going to have a hard enough time producing videos that will withstand 6 months of Polymer development without worrying about messing up something as old as SVG.<br /><br />So tonight, I take one more try at getting the individual toppings to popup and generate a drop shadow without getting clipped:<br /><br /><a href="http://1.bp.blogspot.com/-6fmNCDtz_-Q/U4Pj23B4p8I/AAAAAAAAZz4/T-JnBdGeiBw/s1600/01-a_new_drop_shadow.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-6fmNCDtz_-Q/U4Pj23B4p8I/AAAAAAAAZz4/T-JnBdGeiBw/s640/01-a_new_drop_shadow.png" /></a><br /><br />Those toppings are loaded from SVG assets and inserted directly into the base pizza SVG, <code>&lt;svg></code> tag and all. This seems to work just fine save for the clipping when I translate the topping SVG inside the base SVG. My first fix try is to set <code>overflow=visible</code>. I start with the generic Dart method that takes the previously loaded asset to create a new topping:<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br /><br /><b>    svg.setAttribute('overflow', 'visible');<br />    svg.query('svg').setAttribute('overflow', 'visible');</b><br /><br />    var path = svg.query('path');<br /><b>    path.setAttribute('overflow', 'visible');</b><br />    var style = path.getAttribute('style');<br /><br />    return svg<br />      ..onMouseOver.listen((e){ /* ... */ })<br />      ..onMouseLeave.listen((e){ /* ... */ });<br />  }</code></pre>And, although that attribute is seen in the resulting DOM, it has no effect on the clipping of my topping elements:<br /><br /><a href="http://4.bp.blogspot.com/-rViln0zTRZc/U4PfsE9ht1I/AAAAAAAAZzo/HsdWP3J_86E/s1600/01-overflow_still_clipped.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-rViln0zTRZc/U4PfsE9ht1I/AAAAAAAAZzo/HsdWP3J_86E/s400/01-overflow_still_clipped.png" /></a><br /><br />And, unfortunately, I find similar results when I try to set the clipping area:<pre class=prettyprint"><code>    // ...<br />    svg<br />      ..setAttribute('overflow', 'visible')<br /><b>      ..setAttribute('clip', 'rect(-50px, 50px, 50px, -50px)');</b><br /><br />    svg.query('svg')<br />      ..setAttribute('overflow', 'visible')<br /><b>      ..setAttribute('clip', 'rect(-50px, 50px, 50px, -50px)');</b><br /><br />    var path = svg.query('path')<br />      ..setAttribute('overflow', 'visible')<br /><b>      ..setAttribute('clip', 'rect(-50px, 50px, 50px, -50px)');</b><br />    // ...</code></pre>For what it is worth, setting the <code>clip</code> property on the SVG asset does have an effect. If I make it small (20 pixels on a 32 square pixel image):<pre class=prettyprint><code><br />    // ...<br />    svg.query('svg')<br />      ..setAttribute('overflow', 'visible')<br /><b>      ..setAttribute('clip', 'rect(-50px, 20px, 20px, -50px)');</b><br />    // ...<br /></code></pre>Then the clipping area is noticeably decreased:<br /><br /><a href="http://2.bp.blogspot.com/-DavWKwNlRoA/U4QKZ1eeczI/AAAAAAAAZ0E/C2jQMuyBgGA/s1600/02-clipped_on_purpose.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-DavWKwNlRoA/U4QKZ1eeczI/AAAAAAAAZ0E/C2jQMuyBgGA/s400/02-clipped_on_purpose.png" /></a><br /><br />But there does not seem to be a way to set the clipping area to negative values so that it expands outside the original image. Bother.<br /><br />In the end, I give up. Well, I get it working, but in a completely unsatisfactory manner. I create the SVG images with the drawings shifted slightly to the top-left corner. Then, in the <code>_svgImage()</code> method, I make the rest position of the toppings shifted down and to the right (i.e. more toward the center of the image):<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br /><br />    svg.query('svg')<br />      ..setAttribute('overflow', 'visible')<br />      ..setAttribute('clip', 'rect(-50px, 50px, 50px, -50px)');<br /><br /><b>    var path = svg.query('path')<br />      ..setAttribute('transform', 'translate(2.8577037,1.6074583)');</b><br />    var style = path.getAttribute('style');<br /><br />    return svg<br />      ..onMouseOver.listen((e){<br />          path<br />            ..setAttribute('style', '$style;filter:url(#topping-drop-shadow)')<br /><b>            ..setAttribute('transform', 'translate(0,0)');</b><br />        })<br />      ..onMouseLeave.listen((e){<br />          path<br />            ..setAttribute('style', style)<br /><b>            ..setAttribute('transform', 'translate(2.8577037,1.6074583)');</b><br />      });<br />  }</code></pre>The mouse-enter and mouse-leave stream listeners now have to adjust accordingly.<br /><br />Which does the trick:<br /><br /><a href="http://2.bp.blogspot.com/-M0azAug3GQc/U4QNc3eURlI/AAAAAAAAZ0Q/HG6zjUSY7ec/s1600/03-drop_shadow_sausage.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-M0azAug3GQc/U4QNc3eURlI/AAAAAAAAZ0Q/HG6zjUSY7ec/s640/03-drop_shadow_sausage.png" /></a><br /><br />Not wanting to turn this into an SVG chain, I will probably call a halt to clipping investigation there. The solution is not at all satisfactory, but it works. And if any viewers know how to do it right, they ought to be able to mentally correct this approach without much effort.<br /><br /><br /><span style="color: #ccc">Day #75</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/one-svg-filter-to-rule-them-all.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/mouse-events-and-svg-paths.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/GVrBH-YqcIA" height="1" width="1"/>
