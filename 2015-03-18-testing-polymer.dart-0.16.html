---
title: 'Testing Polymer.dart 0.16'
layout: post
published: '2015-03-18T01:31:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/hF6mPGV2KWE/testing-polymerdart-016.html'
author:
    name: Anonymous
    email: noreply@blogger.com
    url: 'http://www.blogger.com/profile/00135361916531185929'
tags:
    - chain
    - dart
    - polymer
    - testing

---

<div class=top-chain-links></div><br />The latest edition of <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> is done save for copy edits. So of course, there is a major new release of <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>.<br /><br />While I await the remaining edits from my copy editor, I am poking around the edges of the book's source code. Kicking the tires on Polymer.dart 0.16 seems a good place to start. Polymer.dart 0.16 is so new that it only works with <a href="http://dartlang.org">Dart</a> 1.9, which is only in <a href="https://www.dartlang.org/tools/download-archive/#dev-channel">development release</a>. So I start by downloading it and <code>content_shell</code> for testing (using the <code>chromium/download_contentshell.sh</code> script that comes with the Dart SDK). <br /><br />In the book, I have been using unconstrained dependencies so that I can always test with the latest versions:<pre class=prettyprint>name: polymer_intro<br />dependencies:<br /><b>  polymer: any</b><br />dev_dependencies:<br />  unittest: any<br />transformers:<br />- polymer:<br />    entry_points:<br />      - web/index.html<br />      - test/index.html</pre>Now that I have Dart 1.9 installed, I can pub upgrade to get the Polymer 0.16 that requires it:<pre class=prettyprint>➜  polymer git:(master) ✗ pub upgrade<br />Resolving dependencies... (4.2s)<br />...<br />> <b>polymer 0.16.0+3 (was 0.15.5+3)</b><br />  polymer_expressions 0.13.1<br />...<br />> web_components 0.10.5+3 (was 0.10.1)<br />...<br />Changed 11 dependencies! </pre>A quick <code>pub serve</code> to fire up the web server built into the <a href="http://pub.dartlang.org/">Dart Pub</a> package manager and I find...<br /><br />My Polymer elements still work just fine:<br /><br /><a href="http://3.bp.blogspot.com/-h4nkixZCtmw/VQkJ1g3SEpI/AAAAAAAAnns/OwNomzqGZoE/s1600/01-polymer_dart_0_16.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-h4nkixZCtmw/VQkJ1g3SEpI/AAAAAAAAnns/OwNomzqGZoE/s400/01-polymer_dart_0_16.png" /></a><br /><br />Well, at least this very simple one from the first chapter of the book still works. No doubt there will be some adventure, but this is encouraging.<br /><br />All is not well, however, as my tests are failing. Adding insult to injury is that I am not really testing this element. I have a very basic test that asserts nothing more than the element has a shadow root:<pre class=prettyprint><code>  group("&lt;hello-you>", (){<br />    test('has a shadowRoot', (){<br />      expect(<br />        query('hello-you').shadowRoot,<br />        isNotNull<br />      );<br />    });<br />  });</code></pre>Unfortunately, I no longer see that shadow root:<pre class=prettyprint><code>CONSOLE MESSAGE: FAIL: &lt;hello-you> has a shadowRoot<br />  Expected: not null<br />    Actual: &lt;null></code></pre>Happily, the fix is relatively easy. I find that I can get the tests to pass if I wrap them in a <code>Polymer.onReady()</code> block:<pre class=prettyprint>library hello_you_test;<br /><br />import 'package:unittest/unittest.dart';<br />import 'package:unittest/html_config.dart';<br />import 'dart:html';<br />import 'package:polymer/polymer.dart';<br /><br />main() {<br />  useHtmlConfiguration();<br /><br />  initPolymer();<br /><b>  Polymer.onReady.then((_) {</b><br />    var _el;<br />    setUp((){<br />      _el = createElement('&lt;hello-you>&lt;/hello-you>');<br />      document.body.append(_el);<br />    });<br />    group("&lt;hello-you>", (){ /* ... */ });<br />  });<br />}<br /></pre>With that, I have my test passing in Polymer.dart 0.16:<br /><br /><a href="http://3.bp.blogspot.com/-972-QKl7aoE/VQkM8aqkyfI/AAAAAAAAnn4/7LyJB4_uZfM/s1600/01-polymer_dart_test_0_16.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-972-QKl7aoE/VQkM8aqkyfI/AAAAAAAAnn4/7LyJB4_uZfM/s400/01-polymer_dart_test_0_16.png" /></a><br /><br />It seems that this test is not passing in <code>content_shell</code>, but I will worry about that tomorrow. For now, the upgrade to 0.16 seems to be relatively smooth.<br /><br /><span style="color: #ccc">Day #1</span>  <p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/a-solution-for-karma-testing-polymer-on.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/proper-async-testing-of-polymerdart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/hF6mPGV2KWE" height="1" width="1" alt=""/>
