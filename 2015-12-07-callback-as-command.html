---
title: 'Callback as Command'
layout: post
published: '2015-12-07T22:52:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/_BmJRqMlm5A/callback-as-command.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - command
    - dart
    - dartlang
    - 'design patterns'

---

<div class=top-chain-links></div><br />Per the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four book</a>, the <a href="https://en.wikipedia.org/wiki/Command_pattern">command pattern</a> parameterizes objects by an object to perform. Also from the same book, commands are an object-oriented replacement for callback functions. I spent some time getting the object-oriented version working last night in <a href="http://dartlang.org">Dart</a>, tonight I replace it with the callback version.<br /><br />In the client code, I am still using the same invoker and receiver from last night:<pre class=prettyprint><code>  // Invoker<br />  var s = new Switch();<br /><br />  // Receiver<br />  var lamp = new Light();</code></pre>Previously, I had stored the on/off actions on the lamp as commands:<pre class=prettyprint><code>  var switchUp = new OnCommand(lamp),<br />    switchDown = new OffCommand(lamp);</code></pre>Those commands bind the receiver and an action as they are supposed to in this pattern:<pre class=prettyprint>class OnCommand implements Command {<br />  Light light;<br />  OnCommand(this.light);<br />  void execute() { light.turn('ON'); }<br />}</pre>To replace this (and the <code>OffCommand</code>) with callbacks, I need to similarly bind receiver and action. That is a fairly easy task:<pre class=prettyprint><code>  // Commands<br />  var switchUp = (){ lamp.turn('ON'); },<br />    switchDown = (){ lamp.turn('OFF'); };</code></pre>At the risk of saying something nice about callbacks and the spaghetti that they so often beget, I must admit that the callbacks are far more concise than the equivalent command objects. This is Dart, so the commands were not <i>that</i> much trouble. Still both callback-commands are one-liners. That is a definite improvement. <br /><br />I am not quite done converting to callbacks. The command objects supported an <code>execute()</code> method. Dart functions all support a <code>call()</code> method to invoke the function. So the invoker code for executed the store command needs to invoke <code>call()</code> now:<pre class=prettyprint>class Switch {<br />  List&lt;Function> _history = [];<br /><br />  void storeAndExecute(Function c) {<br />    c.call();<br />    _history.add(c);<br />  }<br />  // ...<br />}</pre>Similarly, the simple undo method also needs to use <code>call()</code>:<pre class=prettyprint><code>  void undo() {<br />    _history.<br />      reversed.<br />      forEach((c) { c.call(); });<br />  }</code></pre>With that, the code that invokes the invoker should work:<pre class=prettyprint><code>    switch (command) {<br />      case 'on':<br />        s.storeAndExecute(switchUp);<br />        break;<br />      case 'off':<br />        s.storeAndExecute(switchDown);<br />        break;<br />      // ...<br />    }</code></pre>And work it does. I can turn the lamp on and off and reverse the order as desired:<pre class=prettyprint>$ ./bin/press_switch.dart on off on on                     <br />Light ON<br />Light OFF<br />Light ON<br />Light ON<br />--<br />Light ON<br />Light ON<br />Light OFF<br />Light ON</pre>That is exactly how the command object behaved last night. <br /><br />Is one way better than the other? The callback version tonight is a definite step up in clarity and lesser amount of code. I imagine that command objects still have their place. I will see if I can find themâ€¦ starting tomorrow.<br /><br /><br /><i>Play with this code on DartPad: <a href="https://dartpad.dartlang.org/719748d72bafeeefaab1">https://dartpad.dartlang.org/719748d72bafeeefaab1</a>.</i><br /><br /><span style="color: #ccc">Day #26</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/12/command-in-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/12/limited-command-callbacks.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/_BmJRqMlm5A" height="1" width="1" alt=""/>
