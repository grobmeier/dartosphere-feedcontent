---
title: 'One Weird Trick to Getting Polymer.dart Packages Working'
layout: post
published: '2014-12-04T23:36:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/n1xyFik5D6U/one-weird-trick-to-getting-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - 'dart pub'
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />Yeah, sorry about the title… I couldn't resist.<br /><br />I wound up with the strangest little bug in some  <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> code yesterday that I just could not figure out. I had originally started investigating the "is" attribute in <a href="http://www.polymer-project.org/">Polymer</a>, but quickly realized that I could not use it the way I wanted. <br /><br />In the end, the best way to implement inheritance in Polymer seems to be with the facilities built into the language. In the case of <a href="http://dartlang.org">Dart</a>, that mean regular inheritance with the class <code>extends</code> modifier or via mixins. Both work pretty darn well, unless…<br /><br />Unless you are trying to extend one Polymer class with another through a <a href="http://pub.dartlang.org/">Dart Pub</a> package. Consider last night's code:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />// import 'a_form_input.dart';<br />import 'package:a-form-input/a_form_input.dart';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends AFormInput {<br />  // ...<br />}</pre>The <code>a_form_input.dart</code> files in the local directory and in the package are identical:<pre class=prettyprint>$ diff -s a_form_input.dart \<br />  ~/repos/a-form-input-dart/lib/a_form_input.dart<br />Files a_form_input.dart and <br />  /home/chris/repos/a-form-input-dart/lib/a_form_input.dart<br />  are identical</pre>But when I use the local version, the <code>attributeChanged()</code> in from <code>a_form_input.dart</code> gets invoked:<pre class=prettyprint>library a_form_input;<br /><br />import 'package:polymer/polymer.dart';<br /><br />@CustomTag('a-form-input')<br />class AFormInput extends PolymerElement {<br />  @PublishedProperty(reflect: true)<br />  String name;<br />  @PublishedProperty(reflect: true)<br />  String value;<br />  AFormInput.created(): super.created();<br />  // ...<br />  void attributeChanged(String name, String oldValue, String newValue) {<br /><b>    print('$name: $oldValue → $newValue');</b><br />    if (name == 'name') lightInput.name = newValue;<br />    if (name == 'value') lightInput.value = newValue;<br />  }<br />}<br /></pre>When I add toppings to the <code>&lt;x-pizza></code> element, it sets the <code>value</code> property internally, which triggers the callback (including the <code>print</code> statement):<pre class=prettyprint>value: First Half: []<br />Second Half: []<br />Whole: [] → First Half: [pepperoni]<br />Second Half: []<br />Whole: []</pre>Making no other change to the <code>&lt;x-pizza></code> element other that importing the package version of <code>a_form_input.dart</code> results in… nothing. There are no errors, there is no <code>print</code> statement to be seen in the console and the element is certainly not behaving like "a-form-element", which is the whole point of moving this out into a package.<br /><br />The answer to this little puzzle turns out to be <code>pubspec.yaml</code>. If I add a Polymer transformer to the a-form-element <i>package</i>, then everything magically works:<pre class=prettyprint>name: a-form-input<br />author: "Chris Strom <github@eeecomputes.com>"<br />description: "Polymer element that mimics a native &lt;form> input."<br />dependencies:<br />  polymer: any<br /><b>transformers:<br />- polymer</b><br /></pre>Being somewhat familiar with the idiosyncrasies of Polymer.dart, it did not take long for me to try this. Even so, this fix seems far from obvious. Even now that I know the solution, I cannot rationalize an argument for why this is necessary. I would expect the transformer that is already in my application's <code>pubspec.yaml</code> would apply to any elements that are imported:<pre class=prettyprint>name: form_example<br />dependencies:<br />  polymer: any<br />  a-form-input:<br />    path: /home/chris/repos/a-form-input-dart<br /><b>transformers:<br />- polymer:<br />    entry_points:<br />      - web/index.html<br />      - test/index.html</b></pre>Even if that did not apply to vanilla elements, surely it would apply to elements that only serve as the base class for an element that is being defined in the application, right? I already know the answer, but the "why" of the no answer remains something of a mystery.<br /><br />One mystery solved (how to make it work) is enough for today. Tomorrow, I may poke through the transformer again to solve the mystery of why it works.<br /><br /><br /><span style="color: #ccc">Day #14</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/is-form-input-extending-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/12/polymer-dart-mixins-are-not-real-thing.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/n1xyFik5D6U" height="1" width="1" alt=""/>
