---
title: 'Crazy Theming Polymer.dart with Core-Style'
layout: post
published: '2014-08-24T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/qtVULBvsv-4/crazy-theming-polymerdart-with-core.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - core-elements
    - css
    - dart
    - dartlang
    - javascript
    - paper-elements
    - polymer

---

<div class=top-chain-links></div><br />I am resigned.<br /><br />Resigned that the <a href="http://www.polymer-project.org/docs/elements/core-elements.html#core-style">core-style</a> element and I disagree on how it should support theming. I have no illusions that I am in the right on this one, but I will attempt to make my case anyway. <br /><br />When I think of custom themes, I think of setting a few colors and maybe a few other atomic values that can be used by a widget to look more or less like it fits in with the rest of the web page. In core-style, parlance, this looks like:<pre class=prettyprint><code>      &lt;script><br />        CoreStyle.g.primaryColor = 'orange';<br />        CoreStyle.g.secondaryColor = 'green';<br />      &lt;/script></code></pre>Or, alternatively, as:<pre class=prettyprint><code>        CoreStyle.g = {<br />          primaryColor: 'orange',<br />          secondaryColor = 'green'<br />        };</code></pre>I would think that web page trying to use a widget would set these values and the widget would then honor the values. As best I can tell, this is not how core-style works.<br /><br />Instead, core-style wants these global settings defined by the containing page <i>and</i> it wants the containing page to define styles that will apply to the internals of the widgets being used. That is, if I know that my <code>&lt;lorem-dialog></code> custom <a href="http://www.polymer-project.org/">Polymer</a> element contains <a href="http://www.polymer-project.org/docs/elements/paper-elements.html#paper-button">paper-button</a> elements, then core-style would have me define the global property setting and the detailed widget styling on the containing page:<pre class=prettyprint><code>  &lt;body><br />    &lt;h1>Play Paper&lt;/h1><br />    &lt;lorem-dialog>&lt;/lorem-dialog><br /><b>    &lt;core-style id="theme"><br />      :host paper-button {<br />        border: 5px solid {{g.primaryColor}};<br />        padding: 2px 5px;<br />      }<br />    &lt;/core-style><br />    &lt;script><br />      CoreStyle.g.primaryColor = 'orange';<br />    &lt;/script></b><br />  &lt;/body></code></pre>I cannot help but think this requires the containing page to know too much about the internal implementation of the widget (the Polymer element). <br /><br />I realize that I am almost certainly making a dumb assumption here. I am probably abusing this. Or not thinking right. Knowing this does not help me. Making the problem worse usually does. If I push this further—feel more pain in coding the wrong way—then I usually figure out how to do it right.<br /><br />Last night, I was able to get core-style to work like I want by making the core-style's <code>g</code> property available in the backing Polymer element class:<pre class=prettyprint>Polymer('lorem-dialog', {<br />  created: function() {<br /><b>    this.g = CoreStyle.g;</b><br />  },<br />  // ...<br />}</pre>I could then use this reference inside the Polymer template:<pre class=prettyprint>&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br />    &lt;!-- ... --><br /><b>    &lt;core-style id="theme"><br />      :host paper-button {<br />        border: 5px solid {{g.primaryColor}};<br />        padding: 2px 5px;<br />      }<br />    &lt;/core-style><br />    &lt;core-style ref="theme">&lt;/core-style><br />  &lt;/template></b><br />  &lt;script><br />    Polymer('lorem-dialog', { /* ... */ });<br />  &lt;/script><br />&lt;/polymer-element></pre>Unfortunately, that does not work in Polymer.dart. Try as I might, there is no <code>g</code> property on the core-style object in Dart. But…<br /><br />I know that the Dart versions of the core and paper elements are just thin wrappers around the JavaScript versions. Since I know how to get the global core-style values from JavaScript, perhaps I can use Dart's awesome JavaScript interoperability to resolve this dilemma.<br /><br />So, I import the <code>dart:js</code> packages and define a <code>g</code> getter to return the value of <code>CoreStyle.g</code> from JavaScript:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'dart:html';<br />import 'dart:js';<br /><br />@CustomTag('lorem-dialog')<br />class LoremDialog extends PolymerElement {<br />  LoremDialog.created(): super.created();<br /><br /><b>  get g => context['CoreStyle']['g'];</b><br />  // ...<br />}</pre>And that actually works. In the template, I can define and reference a “theme” style that makes use of the global values from the web page using my Polymer element:<pre class=prettyprint>&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br />    &lt;!-- ... --><br /><b>    &lt;core-style ref="theme">&lt;/core-style><br />    &lt;core-style id="theme"><br />      paper-button {<br />        border: 5px solid {{g['secondaryColor']}};<br />        color: {{g['primaryColor']}};<br />        font-weight: bold;<br />        padding: 2px 5px;<br />      }<br />    &lt;/core-style></b><br />  &lt;/template><br />  &lt;script type="application/dart" src="lorem_dialog.dart">&lt;/script><br />&lt;/polymer-element></pre><br />I strongly doubt that I will offer this up as a solution in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>, but it does work in both JavaScript and Dart. Even so, the amount of resistance that I get from the library is strongly suggesting to me that I am doing something wrong. But even pushing this hard against core-style is not suggesting to me the right way to tackle this problem. Hopefully something will come to me (or someone can point me in the right direction) over the course of the next few days...<br /><br /><br /><span style="color: #ccc">Day #162</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/08/where-core-style-global-properties-can.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/qtVULBvsv-4" height="1" width="1"/>
