---
title: 'New Dart SDK eliminates symlinks'
layout: post
published: '2015-08-11T09:47:00-07:00'
feed: 'Seth Ladd''s Blog'
link: 'http://feedproxy.google.com/~r/SethLaddsBlog/~3/oikus-my6J0/new-dart-sdk-eliminates-symlinks.html'
author:
    name: 'Seth Ladd'
    email: noreply@blogger.com
    url: 'https://plus.google.com/118397406534237711570'
tags:
    - dart
    - dartlang
    - packages

---

<i>In which we retell the story of Dart and symlinks, investigate the new .packages file, and create a simpler world for Dart developers everywhere.</i><br /><div><br /></div>tldr: Starting with Dart 1.12, symlinks are no longer required because of the new .packages file. Try it today!<h2>Why a new solution for locating packages?</h2>In the long long ago, during the before times (aka 2011), <a href="https://www.dartlang.org/">Dart</a> could only run monolithic scripts and apps. In those early days, Dart didn't have support for packages/shared libraries. Then came <i>package:</i> URIs, which opened the door for sharing code. However, the platform didn't specify where to find those package: URIs, and thus began Dart's reliance on <i>symlinks</i>&nbsp;as a way of connecting your script to third-party libraries. Those symlinks and the package: scheme helped ushered in a boom of third-party libraries, the pub package manager, <a href="http://pub.dartlang.org/">pub.dartlang.org</a>, and more.<br /><br />However, turns out that a reliance on symlinks leads to numerous issues, especially for our Windows developers. Putting symlinks into each subdirectory makes for a cluttered project. A directory full of symlinks is very hard to simply zip up and send to another developer, because when unzipped those symlinks are broken. The Windows operating system doesn't support symlinks (though, through some heroics, the pub authors did come up with a solution for modern Windows installs with something calls <i>junction points</i>).&nbsp;It became clear that the Dart platform needed a more robust and formal way to connect your script to your dependencies and third-party libraries.<br /><br />The search began for a solution, and <a href="https://github.com/dart-lang/dart_enhancement_proposals/issues/5">DEP5</a> (formally known as package spec) was born. The proposal specifies a new <i>.packages</i>&nbsp;file and a discovery workflow, and eliminates the need for symlinks everywhere. I am very happy to report that Dart SDK 1.12 will be the first version of Dart that doesn't require symlinks.<br /><h2>What is .packages?</h2>The new .packages file is a simple map between a package name and a URI to the package's lib directory. Here is an example:<br /><br /><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6000003814697px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6000003814697px; line-height: inherit; margin: 0px; max-width: initial; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;"># This file has been generated by the Dart tool pub on Apr 14 09:14:14 2015.<br /># It contains a map from Dart package names to Dart package locations.<br /># Dart tools, including Dart VM and and Dart analyzer, rely on the content.<br /># AUTO GENERATED - DO NOT EDIT<br />unittest:/home/somebody/.pub/cache/unittest-0.9.9/lib/<br />async:/home/somebody/.pub/cache/async-1.1.0/lib/<br />quiver:/home/somebody/.pub/cache/quiver-1.2.1/lib/</code></pre><br />The .packages file is auto-generated by pub, version 1.12-dev or greater.<br /><h2>Where does .packages live?</h2>The .packages usually lives at the root of your package/app. For example:<br /><br /><span style="font-family: Courier New, Courier, monospace;">my_app/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; README.md</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; CHANGELOG.md</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; .packages</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; pubspec.yaml</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; lib/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; my_lib.dart</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; bin/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; my_app.dart</span><br /><br />The Dart runtimes, such as the VM, dartjs, and analyzer, will traverse up directories, from the entry point script, to find a .packages. Thus, you do not need a .packages next to each script that you need to run or compile.<br /><h2>Do I check in .packages?</h2>Do not check in .packages, because it contains paths that are local to your system. You can safely tell your source control system to ignore this file.<br /><h2>How do I use the file?</h2>Under normal circumstances, you do not need to do anything special to use the file. The Dart runtimes and compilers will automatically find the .packages file and use it to locate package libraries.<br /><br />You can optionally specify a .packages as a command-line argument. For example:<br /><br /><span style="font-family: Courier New, Courier, monospace;">dart --packages=path/to/a/.packages main.dart</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span>The Dart VM, dart2js, and the dartanalyzer all know how to find, read, and use the .packages file. The Analysis Server also uses .packages, so IDE/editor users (e.g. Atom, WebStorm, etc) should be able to work in a project without symlinks.<br /><h2>Do I still need a packages/ directory in my project?</h2>No. With .packages, there is no longer a need for symlinks or a packages/ directory in your project. Check out the next question for how to get to this beautiful new world.<br /><h2>Great! So, how can I eliminate symlinks?</h2>Starting with Dart SDK 1.12-dev, you can use the <span style="font-family: Courier New, Courier, monospace;">--no-package-symlinks</span> command-line argument to instruct pub <i>not</i>&nbsp;to generate symlinks. For example:<br /><br /><span style="font-family: Courier New, Courier, monospace;">pub get --no-package-symlinks</span><br /><br />The above command will generate a .packages file in the root of your project, and will not generate any symlinks or a packages/ directory.<br /><br />I recommend that all Dart developers start to use --no-package-symlinks and send us <a href="http://dartbug.com/">feedback</a>. A future version of the Dart SDK will stop generating symlinks.<br /><h2>Caveats</h2>As of Aug 11 2015, the <span style="font-family: Courier New, Courier, monospace;">pub global activate</span> command does not write a .packages file. This probably only affects your app if you are using the new <i>Resource</i>&nbsp;class.<br /><h2>Next steps</h2>Please <a href="https://www.dartlang.org/downloads/archive/">install a 1.12-dev or later of the Dart SDK</a>, and start using --no-package-symlinks with pub. We eagerly await your <a href="http://dartbug.com/">feedback</a>, especially from developers using Windows. You can also follow the <a href="https://github.com/dart-lang/sdk/issues/23372">meta-issue</a> as we complete our implementation. Thanks!<img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/oikus-my6J0" height="1" width="1" alt=""/>
