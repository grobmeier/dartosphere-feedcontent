---
title: 'SVG Assets in Polymer'
layout: post
published: '2014-06-06T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/Wi8rOeCbHYU/svg-assets-in-polymer.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - javascript
    - polymer
    - polymer-elements
    - svg

---

<div class=top-chain-links></div><br />Tonight seems a good opportunity to verify that my recent approach to an SVG <a href="http://www.polymer-project.org/">Polymer</a> custom element will work as well in JavaScript as it has in <a href="http://dartlang.org">Dart</a>.<br /><br />I start with a <code>bower update</code> which, thanks to my non-explicit version dependency in <code>bower.json</code> installs Polymer 0.3.1:<pre class=prettyprint>➜  js git:(master) ✗ grep -C1 Polymer/polymer bower.json<br />  "dependencies": {<br />    "polymer": "Polymer/polymer"<br />  }<br />➜  js git:(master) ✗ bower update <br />...<br /><b>polymer#0.3.1 bower_components/polymer</b><br />├── core-component-page#0.3.1<br />└── platform#0.3.1<br />...<br /></pre>I fire up a Python simple server (it's in my shell history):<pre class=prettyprint>➜  js git:(master) ✗ python -m SimpleHTTPServer 8000<br />Serving HTTP on 0.0.0.0 port 8000 ...</pre>And... everything still works:<br /><br /><a href="http://2.bp.blogspot.com/-6dS791tVwAc/U5KDjlaFSfI/AAAAAAAAaYs/c1Ggxu2zbYQ/s1600/01-olde_js_pizza_builer.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-6dS791tVwAc/U5KDjlaFSfI/AAAAAAAAaYs/c1Ggxu2zbYQ/s400/01-olde_js_pizza_builer.png" /></a><br /><br />Refreshing.<br /><br />It works, but those are the in-application drawn SVG elements:<pre class=prettyprint><code>  // ...<br />  _svgSausage: function() {<br />    var el = document.createElementNS("http://www.w3.org/2000/svg", "circle");<br />    el.setAttribute('r', '3');<br />    el.setAttribute('fill', 'brown');<br />    return el;<br />  },<br />  // ...<br /></code></pre>In the Dart version, I switched to an asset loading approach that lent itself better to a designer workflow. I relied on the <code>&lt;core-ajax></code> Polymer element in Dart, so let's see how it works in JavaScript. I add core-ajax to the list of dependencies:<pre class=prettyprint>➜  js git:(master) ✗ bower install -S Polymer/core-ajax<br /></pre><br />Then, I copy the SVG assets into the JavaScript version of this <code>&lt;x-pizza></code> element:<br /><pre class=prettyprint>➜  js git:(master) ✗ mkdir assets/images     <br />➜  js git:(master) ✗ cp ../dart/lib/images/* assets/images/<br />➜  js git:(master) ✗ ls assets/images <br />green_pepper.svg  pepperoni.svg  pizza.svg  sausage.svg</pre>Next, I teach the template to use <code>&lt;core-ajax></code> to load these assets. I need the appropriate <code>&lt;core-ajax></code> tags for each asset and need to link in the <code>core-ajax.html</code> definition:<pre class=prettyprint>&lt;link rel="import"<br />      href="../bower_components/polymer/polymer.html"><br /><b>&lt;link rel="import"<br />      href="../bower_components/core-ajax/core-ajax.html"></b><br />&lt;polymer-element name="x-pizza"><br />  &lt;template><br /><b>    &lt;core-ajax<br />       auto<br />       id="pizza.svg"<br />       url="../../assets/images/pizza.svg"<br />       on-core-response="{{responseReceived}}">&lt;/core-ajax></b><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script src="x_pizza.js">&lt;/script><br />&lt;/polymer-element></pre>The rest of the effort flows fairly smoothly from here. I no longer have Futures, so I use a state variable to tell the graphics when all SVG toppings have loaded:<pre class=prettyprint><code><br />  // ...<br />  svgContent: {},<br />  <b>svgLoaded: false,</b><br /><br />  responseReceived: function(e, detail, node){<br />    this.svgContent[node.id] = detail.response;<br /><br />    var numLoaded = Object.keys(this.svgContent).length,<br />        numDefined = this.shadowRoot.querySelectorAll('core-ajax').length;<br />    if (numLoaded == numDefined) {<br /><b>      this.svgLoaded = true;</b><br />      this._updateGraphic();<br />    }<br />    if (node.id == 'pizza.svg') this._updateGraphic();<br />  },<br /><br />  /* Start SVG Code */<br />  svg: null,<br /><br />  _updateGraphic: function() {<br />    this.$['pizza'].innerHTML = this.svgContent['pizza.svg'];<br /><b>    if (!this.svgLoaded) return;</b><br /><br />    this._addWholeToppings();<br />    this._addFirstHalfToppings();<br />    this._addSecondHalfToppings();<br />  },<br />  // ...<br /></code></pre>That aside, this follows the core-ajax loading convention that I was able to use in Dart closely. Well, except that manipulating SVG in JavaScript is ugly as sin:<pre class=prettyprint><code>  _svgSausage: function() {<br />    var ns = "http://www.w3.org/2000/svg";<br />    var group = document.createElementNS(ns, "g");<br /><br />    group.innerHTML = this.svgContent['sausage.svg'];<br />    var svg = group.querySelector('svg');<br /><br />    var mouseCircle = document.createElementNS(ns, "circle");<br />    mouseCircle.setAttribute('r', '15');<br />    mouseCircle.setAttribute('cx', '15');<br />    mouseCircle.setAttribute('cy', '15');<br />    mouseCircle.setAttribute('style', 'opacity:0');<br />    group.appendChild(mouseCircle);<br />    // ...<br />  }</code></pre>Compare that to the equivalent Dart:<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(<br />          new CircleElement()<br />            ..setAttribute('r', '15')<br />            ..setAttribute('cx', '15')<br />            ..setAttribute('cy', '15')<br />            ..setAttribute('style', 'opacity:0')<br />        )<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br />    // ...<br />  }</code></pre>Method cascades and proper constructors really help. That aside, the JavaScript code flows nicely given my experience from Dart. I will likely take tomorrow to see if there are any JavaScript specific improvements that I can realize (maybe checking out <a href="http://snapsvg.io/">snap</a>) , but this seems promising.<br /><br /><br /><span style="color: #ccc">Day #86</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/06/non-worky-attempts-at-core-elements-in.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/Wi8rOeCbHYU" height="1" width="1"/>
