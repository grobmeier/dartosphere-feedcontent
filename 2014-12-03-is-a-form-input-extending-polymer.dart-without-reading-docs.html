---
title: 'Is a Form Input (Extending Polymer.dart without Reading Docs)'
layout: post
published: '2014-12-03T23:46:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/EUwP7evKg9U/is-form-input-extending-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - 'dart pub'
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />Now for the fun. Now for <a href="http://dartlang.org">Dart</a>.<br /><br />I kid (a little). One of the joys of writing <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> is slipping back and forth between JavaScript and Dart. If I am being honest, I prefer Dart, but both languages have their joys. More than experiencing those joys, I appreciate trying solutions for <a href="http://www.polymer-project.org/">Polymer</a> in one language and then another. If a solution is pleasant in both languages, then I feel like I have found a nice solution that transcends language—making it a true Polymer pattern. <br /><br />In some ways, switch back and forth between languages feels a little like <a href="http://c2.com/cgi/wiki?SpikeSolution">spiking solutions</a>, then doing it for real. In real programming that is loads of fun (not to mention is leads to better solutions). Surprisingly, I have found this to be a bad idea writing the book. It is easy to mistake tinghe post-spike flow for a transcendent pattern. Of course it works when switching languages, I already pushed through the gaps in knowledge in the other language.<br /><br />Instead, I have been making a concerted effort to push the solution forward when switching between languages. When I got my initial spike of <code>&lt;a-form-input></code> (it allows Polymer elements to work in native HTML forms) working in Dart, I did not try to get it working in JavaScript. Instead I tried building a base class / element in JavaScript. Now that I have that working in JavaScript, I try something a little different in Dart. Instead of just making <code>&lt;a-form-input></code> a base class in Dart, I am going to see if I can make it work with the <code>is="a-form-input"</code> syntax.<br /><br />I start by reproducing my latest JavaScript work in Dart. That is, I create a Dart package for <code>&lt;a-form-input></code>. In a new git repository, I add a simple <a href="http://pub.dartlang.org/">Dart Pub</a> <code>pubspec.yaml</code>:<pre class=prettyprint>name: a-form-input<br />dependencies:<br />  polymer: any</pre>Then, I copy in <code>a_form_element.dart</code> from my initial spike in some of the book's exploratory code into <code>lib/a_form_input.dart</code>. For the most part, the JavaScript version of this library looks identical to the Dart solution—aside from the code annotations:<pre class=prettyprint>@CustomTag('a-form-input')<br />class AFormInput extends PolymerElement {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br />  // ...<br />}</pre>The same class in JavaScript is the more compact:<pre class=prettyprint>Polymer('a-form-input', {<br />  publish: {<br />    name: {reflect: true},<br />    value: {reflect: true}<br />  },<br />  // ...<br />});</pre>I am going to be honest here: I love the <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> annotations. If you would have told this old dynamic language aficionado a year ago that I'd love annotations, I'd have thought you were crazy. But now I really appreciate how they distinguish meta-information in the class from actual code. These published properties are core to the functionality of <code>&lt;a-form-input></code>, but in JavaScript that information gets lost in the rest of the code:<pre class=prettyprint>Polymer('a-form-input', {<br />  publish: {<br />    name: {value: 0, reflect: true},<br />    value: {value: 0, reflect: true}<br />  },<br /><br />  attached: function(){<br />    this.lightInput = document.createElement('input');<br />    this.lightInput.type = 'hidden';<br />    this.lightInput.name = this.getAttribute('name');<br /><br />    this.parentElement.appendChild(this.lightInput);<br />  },<br /><br />  nameChanged: function(){<br />    this.lightInput.name = this.name;<br />  },<br /><br />  valueChanged: function(){<br />    this.lightInput.value = this.value;<br />  }<br />});</pre>Still, the task at hand tonight is not language comparing. Instead, I want to change the test element in Dart from extending the base. So. in the smoke test page for the book example, I add the <code>is</code> attribute:<pre class=prettyprint>&lt;!DOCTYPE html><br />&lt;html lang="en"><br />  &lt;head><br />    &lt;link rel="import" href="packages/form_example/elements/x-pizza.html"><br /><b>    &lt;link rel="import" href="packages/a-form-input/a-form-input.html"></b><br />    &lt;script type="application/dart">export 'package:polymer/init.dart';&lt;/script><br />  &lt;/head><br />  &lt;body><br />    &lt;form action="test" method="post"><br />      &lt;h1>Plain-old Form&lt;/h1><br />      &lt;input type=text<br />             name="plain_old_param"<br />             placeholder="Plain-old form field"><br /><b>      &lt;x-pizza name="pizza_toppings" is="a-form-input">&lt;/x-pizza></b><br />      &lt;button>Order my pizza!&lt;/button><br />    &lt;/form><br />  &lt;/body><br />&lt;/html><br /></pre>Which almost works… except not at all (some of the functionality works, but ultimately crashes ugly). <br /><br />I finally read the actual documentation to find that this is not how "is" works at all! It is meant to extends native DOM elements, not arbitrary elements like I am trying to do here. Sometimes there is nothing for it, but to admit that I am an idiot. OK, much times.<br /><br />But while working this, I ran into an interesting problem. My <code>AFormInput</code> class does not seem to see attributes changing when moved into a package. That is, the same exact <code>a_form_input.dart</code> when used locally or used via a package… behaves differently. And it is an important difference. The <code>attributeChanged()</code> callback is never invoked in the super class via a package:<pre class=prettyprint>library a_form_input;<br /><br />import 'package:polymer/polymer.dart';<br />import 'dart:html';<br /><br />@CustomTag('a-form-input')<br />class AFormInput extends PolymerElement {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br />  // ...<br /><br />  AFormInput.created(): super.created();<br />  void attached() {<br />    print('attached!');<br />    super.attached();<br />  }<br /><b>  void attributeChanged(String name, String oldValue, String newValue) {<br />    print('$name: $oldValue → $newValue');<br />    if (name == 'name') lightInput.name = newValue;<br />    if (name == 'value') lightInput.value = newValue;<br />  }</b><br />}</pre>If my test element (the old <code>&lt;x-pizza></code> standby) uses a local copy of this same file, then it can update <code>value</code>:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><b>import 'a_form_input.dart';</b><br />// import 'package:a-form-input/a_form_input.dart';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends AFormInput {<br />  // ...<br />  _updateText() {<br /><b>    value = 'First Half: ${model.firstHalfToppings}\n'<br />      'Second Half: ${model.secondHalfToppings}\n'<br />      'Whole: ${model.wholeToppings}';</b><br />  }<br />  // ...<br />}</pre>But if I swap the <code>a_form_input.dart</code> lines, then changes to the value attribute (or the name attribute) never trigger the <code>attributeChanged()</code> callback. I play with this for some time, but I cannot solve this. Everything else works—a hidden input is generated by <code>&lt;a-form-input></code> in either case. The <code>attached()</code> lifecycle method is called in either case. But I am clearly missing something in the packaged version. Something to solve tomorrow.<br /><br /><span style="color: #ccc">Day #13</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/prepping-polymer-element-for-release.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/12/one-weird-trick-to-getting-polymerdart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/EUwP7evKg9U" height="1" width="1" alt=""/>
