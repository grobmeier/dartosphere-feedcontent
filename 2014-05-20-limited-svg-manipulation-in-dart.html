---
title: 'Limited SVG Manipulation in Dart'
layout: post
published: '2014-05-20T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/P42bNx8iWtw/limited-svg-manipulation-in-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg

---

<div class=top-chain-links></div><br />Tonight I hope to make use of <a href="http://dartlang.org">Dart</a>'s built-in <code>dart:svg</code> library to clean up the code in my <a href="http://www.polymer-project.org/">Polymer</a> custom element.<br /><br />The custom element in question, <code>&lt;x-pizza></code>, facilitates pizza buying by drawing (with SVG) the current state of to-be-purchased pizza:<br /><br /><a href="http://3.bp.blogspot.com/-zSr6hHIk9Fc/U3wKMIUXhhI/AAAAAAAAZj8/fLSmiNBvT54/s1600/03-x_pizza_with_svg_images.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-zSr6hHIk9Fc/U3wKMIUXhhI/AAAAAAAAZj8/fLSmiNBvT54/s320/03-x_pizza_with_svg_images.png" /></a><br /><br />Nearly every aspect of SVG has been a struggle for me, so I did not concern myself much with prettiness of code, although one cannot help oneself sometimes with Dart. Still, there are aspects that can be made better if I dig a little deeper into <code>dart:svg</code><br /><br />I notice that the graphical elements in <code>dart:svg</code> all have <code>width</code>, <code>height</code>, and <code>href</code> properties. So it sure would be nice to rewrite <code>_svgImage()</code> with that in mind. That is, this:<pre class=prettyprint><code>  _svgPepperoni()   => _svgImage('pepperoni');<br />  _svgSausage()     => _svgImage('sausage');<br />  _svgGreenPepper() => _svgImage('green_pepper');<br /><br /><b>  _svgImage(basename) {<br />    var svgImage = new ImageElement()<br />      ..setAttributeNS(<br />          'http://www.w3.org/1999/xlink',<br />          'href',<br />          '/packages/svg_example/images/$basename.svg'<br />        )<br />      ..setAttribute('width', '16')<br />      ..setAttribute('height', '16');</b><br /><br />    return new GElement()<br />      ..append(svgImage);<br />  }</code></pre>Would look better with <code>svgImage</code> being assigned as:<pre class=prettyprint><code>    var svgImage = new ImageElement()<br />      ..href = '/packages/svg_example/images/$basename.svg'<br />      ..width = '16'<br />      ..height = '16';</code></pre>Sadly, that does not work. Upon closer examination, each of those properties is <code>final</code> in Dart. Huge bummer. <br /><br />At least Dart makes it possible to set those properties with <code>setAttribute()</code> and <code>setAttributeNS()</code>, but it sure would be cleaner to be able to do so with proper setters. This does not bode well for <code>dart:svg</code> making SVG life easier. In fact most properties turn out to be final (e.g. <code>translate</code>, which sure should have helped).<br /><br />If manipulating SVG is not going to be pretty in Dart, then perhaps loading it can be? I am currently starting a clean pizza via a combination of static <code>&lt;svg></code> tags in the Polymer template:<pre class=prettyprint><code>      &lt;svg version="1.1"<br />        baseProfile="full"<br />        id="pizza-graphic"<br />        style="display: block; margin: 10px auto"<br />        width="300" height="300"<br />        xmlns="http://www.w3.org/2000/svg"><br />      &lt;/svg></code></pre>And a fresh slate that is drawn dynamically each time a topping is added to the pizza:<pre class=prettyprint><code>  _updateGraphic() {<br />    $['pizza-graphic'].innerHtml = '''<br />      &lt;circle cx="150" cy="150" r="150" fill="tan" /><br />      &lt;circle cx="150" cy="150" r="140" fill="darkred" /><br />      &lt;circle cx="150" cy="150" r="135" fill="lightyellow" /><br />    ''';<br /><br />    _addWholeToppings();<br />    _addFirstHalfToppings();<br />    _addSecondHalfToppings();<br />  }</code></pre>If I save an SVG blank pizza image from Inkscape, I can load it with an <code>HttpRequest</code>:<pre class=prettyprint><code>  _updateGraphic() {<br /><b>    HttpRequest.<br />      getString('/packages/svg_example/images/pizza.svg').<br />      then((svgContent){<br />        $['pizza'].innerHtml = '';<br />        svg = new SvgElement.svg(svgContent);<br />        $['pizza'].append(svg);<br />      });</b><br /><br />    _addWholeToppings();<br />    _addFirstHalfToppings();<br />    _addSecondHalfToppings();<br />  }</code></pre>That works just fine, but I am unsure that it improves things significantly in this case. Regardless, that seems like a useful trick to keep in my SVG toolbox (thanks to Emanuele Sabetta for the approach). If nothing else, it cuts down on static SVG coding, moving the definition into static files where it belongs. In more complex base SVG images, this approach would likely be a much more significant win.<br /><br /><br /><span style="color: #ccc">Day #69</span>  <br /><br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/packaging-inkscape-svg-for-polymer.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/P42bNx8iWtw" height="1" width="1"/>
