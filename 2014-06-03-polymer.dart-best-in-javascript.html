---
title: 'Polymer.dart: Best in JavaScript?'
layout: post
published: '2014-06-03T23:34:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/kXKmXMZC-aU/polymerdart-best-in-javascript.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - polymer-elements

---

<div class=top-chain-links></div><br />Bleh. That seems to sum up the current state of <code>&lt;core-*></code> elements in  <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>.<br /><br />In addition to maintaining the usual <code>pubspec.yaml</code> dependency file for the <a href="http://pub.dartlang.org/">Dart Pub</a> packager, I also have to pull down the JavaScript version of the <code>&lt;core-*></code> custom element (like <code>&lt;core-ajax></code>). I also have to manually edit the <code>core-*></code> elements to use the same <code>polymer.html</code> source file as the <a href="http://dartlang.org">Dart</a> custom element. And it <i>still</i> doesn't work.<br /><br />The problem that I currently face is getting callback events to pass useful data into my Dart code. The Polymer definition includes a series of <code>&lt;core-ajax></code> elements that each invoke the element's <code>responseReceived()</code> method when the Ajax request finishes successfully:<pre class=prettyprint>&lt;link rel="import"<br />      href="bower_components/core-ajax/core-ajax.html"><br />&lt;polymer-element name="x-pizza"><br />  &lt;template><br />    &lt;core-ajax<br />       auto<br />       id="pizza.svg"<br />       url="/packages/svg_example/images/pizza.svg"<br /><b>       on-core-response="{{responseReceived}}"</b>>&lt;/core-ajax><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script type="application/dart" src="x_pizza.dart">&lt;/script><br />&lt;/polymer-element></pre>The idea here is simple enough: I want my custom element to load several SVG assets to be used when building pizzas in the custom <code>&lt;x-pizza></code> element:<br /><br /><a href="http://2.bp.blogspot.com/-4pI9GUxwYcA/U45Np7MRuEI/AAAAAAAAaMI/EOuY74B_ByE/s1600/01-setting_polymer_attributes.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-4pI9GUxwYcA/U45Np7MRuEI/AAAAAAAAaMI/EOuY74B_ByE/s400/01-setting_polymer_attributes.png" /></a><br /><br />There might be better ways to accomplish this, but this seemed the best option given the vagaries of SVG. Regardless of the best option, using <code>&lt;core-ajax></code> like this should work. That is the entire point of having a set of <code>core-*</code> elements. But it does not work. The <code>responseReceived()</code> <i>is</i> invoked, but the event details and the details parameters supplied are always <code>null</code>:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  responseReceived(e, detail, node){<br />    svgContent[node.id] = detail['response'];<br />    if (svgContent.length == shadowRoot.queryAll('core-ajax').length) {<br />      svgLoaded.complete();<br />    }<br />    if (node.id == 'pizza.svg') _updateGraphic();<br />  }<br />  // ...<br />}<br /></pre>That is where I left off yesterday because nothing I could do would convince <code>&lt;core-ajax></code> to send useful information into the callback method in Dart. In the fresh light of day, however, I have the sneaking suspicion that this is going to work when compiled into JavaScript—I had tested only in <a href="http://www.dartlang.org/dartium/">Dartium</a>, not a standard browser.<br /><br />So I load the element up in Chrome, for which the <code>pub serve</code> testing web server is happy to compile, and find:<br /><br /><a href="http://1.bp.blogspot.com/-me8vtiK-z9c/U45QPfr7qNI/AAAAAAAAaMQ/kPJczhWsv5A/s1600/01-working_when_compiled_to_js.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-me8vtiK-z9c/U45QPfr7qNI/AAAAAAAAaMQ/kPJczhWsv5A/s400/01-working_when_compiled_to_js.png" /></a><br /><br />It works perfectly. And this makes me so mad.<br /><br />I suspected this “fix” would work because <a href="https://code.google.com/p/dart/issues/detail?id=15512">I have seen this before</a> in Polymer.dart. Strange things fail in the Dart VM, but work just fine when compiled to JavaScript. This is more than a bit of an annoyance. I would much rather smoke test in Dart than compiled JavaScript—it is faster in Dart and the error messages are more useful. For now, I will trust in the Polymer.dart folks to fix this when they get the <code>core-*</code> elements into a Dart package.<br /><br />For what it's worth, I was able to get this working in the Dart VM by reading the <code>response</code> property directly from the <code>&lt;core-ajax></code> element, BUT I had to wait roughly 100 milliseconds before trying to do so:<pre class=prettyprint><code>  responseReceived(e, detail, node){<br /><b>    new Timer(new Duration(milliseconds: 100), (){<br />      svgContent[node.id] = node.attributes['response'];</b><br />      if (svgContent.length == shadowRoot.queryAll('core-ajax').length) {<br />        svgLoaded.complete();<br />      }<br />      if (node.id == 'pizza.svg') _updateGraphic();<br />    });<br />  }</code></pre>Obviously that is nowhere near an ideal solution. But it's something—at least until the Polymer.dart team does ship a package of the core- elements for Dart developers.<br /><br /><br /><span style="color: #ccc">Day #83</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/06/polymer-elements-in-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/kXKmXMZC-aU" height="1" width="1"/>
