---
title: 'From GWT to AngularDart: a case study with source code'
layout: post
published: '2017-03-13T16:21:00-07:00'
feed: 'Dart News & Updates'
link: 'http://news.dartlang.org/2017/03/from-gwt-to-angulardart-case-study-with.html'
author:
    name: 'Filip Hráček'
    email: noreply@blogger.com
    url: ''
tags:
    - angular

---

<em>Lots of interesting articles about Dart have been cropping up on Medium.com lately. We've decided to cross post them here so that followers of this blog won't miss out on them. We'll start by <a href="https://medium.com/@isoos/from-gwt-to-angulardart-a-case-study-with-source-code-a049ba8b6df3">Istvan Soos's GWT-to-Dart case study</a>, published on Friday. &mdash; Filip Hracek</em><br /><br /><hr/><br />Earlier this year I was asked if there’s a good way to compare developing web UIs in <a href="http://www.gwtproject.org/">Google Web Toolkit</a>&nbsp;(GWT) vs. <a href="https://www.dartlang.org/">Dart</a>, specifically <a href="https://webdev.dartlang.org/angular">AngularDart</a>. Having worked with both GWT and Dart, I had a good idea of the differences, but as I thought more, I started to wonder how hard it would be to migrate a GWT application to AngularDart. This article describes what I’ve found while doing just that.<br /><br />The GWT <a href="http://samples.gwtproject.org/samples/Mail/Mail.html">Mail Sample</a>&nbsp;was an ideal place to start: it’s much more than a trivial example, with diverse features and complex UI interactions, yet it’s still manageable in size.<br /><br />If you’re in a hurry, take a look at the <a href="https://isoos.github.io/gwt_mail_sample/">working demo</a>&nbsp;and the <a href="https://github.com/isoos/gwt_mail_sample">source code</a>, or scroll to the bottom for the conclusions.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-2Jw1GTlSqlI/WMclJ8iVCII/AAAAAAAAOxg/ZcAdfffMzhQ_FdOfCL8jVddsnC2Kz4pFQCPcB/s1600/image01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-2Jw1GTlSqlI/WMclJ8iVCII/AAAAAAAAOxg/ZcAdfffMzhQ_FdOfCL8jVddsnC2Kz4pFQCPcB/s640/image01.png" width="640" height="406" /></a></div><div style="text-align: center; font-style: italic; padding: 0 4em;">Screenshot of the <a href="https://isoos.github.io/gwt_mail_sample/">demo</a>.</div><br /><h2>The method of migration</h2>I’ve done the migration without any automated compiler. While it may be possible to write a tool to automatically convert the GWT templates to Angular, or the backing Java code to Dart, I wouldn’t suggest doing it that way. Chances are that the template, the styling, or the Java code uses patterns that are better served with new approaches. I’ll list a couple of these new approaches in the next section.<br /><br />My process was very simple. I put the GWT and the AngularDart code in the same git repository and did the following cycle:<br /><br /><ol start="1"><li>Select a small or medium-sized chunk of the GWT codebase. Usually this was a single widget, or a smaller part of a complex widget.</li><li>Carefully explore the features and edge cases that are in the code. Most of a proprietary codebase will be some kind of edge case that somebody stuffed in it. If there are more than 5 edge cases, it is a good indication that the task is too large and needs to be split into multiple chunks.</li><li>Implement the selected part in AngularDart. This sounds simple, because it is simple. :-)</li><li>Delete the selected part from the GWT codebase. The GWT application will no longer build, but you can easily track the parts that you haven’t migrated yet.</li></ol><br />You can check my progress and individual steps either by observing the <a href="https://github.com/isoos/gwt_mail_sample/commits/master">commit history</a>, or by looking at the <a href="https://github.com/isoos/gwt_mail_sample/blob/master/log.md">log.md</a>&nbsp;file that I was writing along as I was doing the changes. One interesting observation: <strong>writing down the changes took much more time than implementing the code in AngularDart.</strong><br /><br /><h2>Old solutions vs. new ones</h2>The bulk of the migration is straightforward: simple templates and styles can be mapped to their Angular counterparts easily. I won’t waste your time with minute details; instead I’ll just talk about the parts that differ.<br /><br />The first and most obvious difference is the design: the Angular version uses material widgets from the <a href="https://pub.dartlang.org/packages/angular2_components">angular2_components</a>&nbsp;package. The package has a lot of useful components, if you are starting with AngularDart, you should try to go with that. While both stacks have a great selection of ready-to-use components, and most of them have 1:1 mappings with regard to features and settings, sometimes you need to use your judgement on which to use or select.<br /><br /><div class="separator" style="clear: both; text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/05pj1Hx_ucI?rel=0" frameborder="0" allowfullscreen></iframe></div><div style="text-align: center; font-style: italic; padding: 0 4em;">Watch the new version alongside the old one. AngularDart Components make it easy to have nice animations and consistent component views.</div><br />I missed a few things that aren’t available yet in AngularDart Components, like a table and tree component. However, as you can see in the log, it was really easy to implement them with Angular’s *ngFor&nbsp;templates. For example, the list of mail items is handled by the following template, which is much simpler than GWT’s table initialization in <a href="https://github.com/isoos/gwt_mail_sample/blob/master/gwt/original/src/com/google/gwt/sample/mail/client/MailList.java">MailList.java</a>:<br /><br /><pre><code>&lt;div *ngFor=&quot;let item of items&quot;<br /> &nbsp; &nbsp; class=&quot;row&quot;<br /> &nbsp; &nbsp; (click)=&quot;selectRow(item)&quot;<br /> &nbsp; &nbsp; [class.selected]=&quot;isSelectedRow(item)&quot;&gt;<br /> &nbsp;&lt;div class=&quot;col sender&quot;&gt;{{item.sender}}&lt;/div&gt;<br /> &nbsp;&lt;div class=&quot;col email&quot;&gt;{{item.email}}&lt;/div&gt;<br /> &nbsp;&lt;div class=&quot;col subject&quot;&gt;{{item.subject}}&lt;/div&gt;<br /> &nbsp;&lt;material-ripple&gt;&lt;/material-ripple&gt;<br />&lt;/div&gt;<br /></code></pre><br />I was told that team is working on open sourcing more components; fingers crossed that a more complex table will be included soon.<br /><br />Less intriguing, but an important difference is the lack of static variables and the handling of singleton instances. In the GWT version, the list of email messages is stored in a static field in <a href="https://github.com/isoos/gwt_mail_sample/blob/master/gwt/original/src/com/google/gwt/sample/mail/client/MailItems.java">MailItems.java</a>. In the Dart version, the same (and much more) functionality is handled by <a href="https://github.com/isoos/gwt_mail_sample/blob/master/lib/mail/mail_service.dart">MailService</a>, which is injected and better for unit testing.<br /><br />I’ve started with a <a href="https://github.com/isoos/gwt_mail_sample/blob/master/lib/mail/mock_mail_service.dart">mock</a>&nbsp;implementation for easier development (also to match the GWT version), while later on it is easy to plug in a real API behind the web client. For example, configuring the injection is as simple as the following code. Switching to a real implementation would be just changing the useValue:&nbsp;part of it.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-ZB-PI3gM9nA/WMclJ6nZcBI/AAAAAAAAOxo/m_QRuF5LXFoyBtEaHeOazh2VmbmPjakqgCPcB/s1600/image02.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-ZB-PI3gM9nA/WMclJ6nZcBI/AAAAAAAAOxo/m_QRuF5LXFoyBtEaHeOazh2VmbmPjakqgCPcB/s640/image02.jpg" width="640" height="134" /></a></div><div style="text-align: center; font-style: italic; padding: 0 4em;">Change to real implementation when ready.</div><br />On a more subjective note, I find the separation of code, HTML template, and CSS styles much better in AngularDart than in GWT. The GWT codebase allowed sprinkling the Java code with both styling details and template construction, and those parts were the hardest to migrate to a cleaner version.<br /><br /><h2>End result by the numbers</h2>While the AngularDart version has more features, and I’ve implemented custom components like the tree, overall it has less code than the GWT original. Depending on how you count, <strong>code size is down by 30%.</strong><br /><br />I was developing the application using Dartium, so I didn’t need to compile the Dart code to JavaScript; everything was done with a low-latency type-save-refresh cycle. However, the end result needed to be compiled to JS, and it may provide value to compare the numbers. On my Macbook Pro, the GWT applications’ compile times were:<br /><br /><ul><li>26 seconds for 1 permutations,</li><li>11 seconds if the Java source code was already compiled, and</li><li>40 seconds for all 5 permutations.</li></ul><br />The Dart version took about 15&ndash;20 seconds to compile to cross-browser ES5. That is not blazing-fast, but it is <strong>faster than the GWT compiler.</strong><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-dp_vosdRv0Y/WMclKIl_KGI/AAAAAAAAOxw/wF6O_2mx_SY9AJTorWhdSw7yhgOhwKw_gCPcB/s1600/image00.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-dp_vosdRv0Y/WMclKIl_KGI/AAAAAAAAOxw/wF6O_2mx_SY9AJTorWhdSw7yhgOhwKw_gCPcB/s640/image00.png" width="640" height="386" /></a></div><div style="text-align: center; font-style: italic; padding: 0 4em;">Compile times (in seconds)</div><br />Last, a few notes about the output JavaScript’s size. The GWT compiler produces different JS version for each permutation (target browser), while the Dart compiler emits only a single compiled version. GWT’s output was roughly 207 KB / permutation (1M total for all 5, 84 KB/permutation when compressed), while the AngularDart version resulted in 689 KB (178 KB compressed).<br /><br />Considering that the application logic is more complex (for example: diverse widgets, ripples, more detailed mail item handling), the larger JS size is not a surprise, although I hoped it would be smaller. Fortunately for us, a huge part of it is “fixed cost”, and additional components increase the size only a little (proportional to their complexity).<br /><br /><h2>Conclusions</h2>Both technologies originate from Google and both are capable of supporting larger team sizes, but they represent two very different eras. I have found the GWT code harder to read and reason about; the AngularDart version is more compact and easier for me. But don’t trust my point of view blindly. I strongly suggest that you <a href="https://isoos.github.io/gwt_mail_sample/">try out</a>&nbsp;the application and check the <a href="https://github.com/isoos/gwt_mail_sample">source code</a>for yourself.<br /><br />I have also found the material components refreshing, and most of the time they were out of my way. Compared to that, styling and customizing GWT components is harder, requiring time that would be better spent on the application itself.<br /><br />If you are looking to migrate your GWT app to a newer technology, AngularDart is a viable option. After all, Google is doing the same thing: they are migrating their critical apps from GWT to Dart (see their <a href="http://news.dartlang.org/2016/10/google-adsense-angular-dart.html">AdSense</a>and <a href="http://news.dartlang.org/2016/03/the-new-adwords-ui-uses-dart-we-asked.html">AdWords</a>&nbsp;interviews).<br /><br />&mdash; István Soós, March 10, 2017, <a href="https://medium.com/@isoos/from-gwt-to-angulardart-a-case-study-with-source-code-a049ba8b6df3">canonical link</a><br />
