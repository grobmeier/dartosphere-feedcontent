---
title: 'One Yak Too Many?'
layout: post
published: '2014-09-09T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/1KbT4APdEi4/one-yak-too-many.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - javascript
    - jenkins
    - karma
    - linode
    - 'regression testing'
    - testing
    - xvfb

---

<div class=top-chain-links></div><br />Yesterday I was able to get a <a href="http://jenkins-ci.org/">Jenkins</a> server up and running on a <a href="http://linode.com">Linode</a>, properly secured, and checking out <a href="http://dartlang.org">Dart</a> and JavaScript code for testing. Although the test script ran, I do not yet have a successful test—mostly due to lack of additional dependencies.<br /><br />I am still building this on a Debian 6 LTS Linode host. I continue working through the error messages as they occur on the server. First up: <br /><pre class=prettyprint>scripts/test.sh: line 14: xvfb-run: command not found</pre>That is easy enough:<pre class=prettyprint>$ sudo apt-get install xvfb</pre>I was happy to discover <code>xvfb-run</code> the other day as it makes testing life easier. Since I had never used it, I thought it might be an new addition to the <code>xvfb</code> package, but it is even present on this old LTS system.<br /><br />Next, I install Bower and Karma globally:<pre class=prettyprint>$ npm install -g bower karma-cli</pre>I <i>might</i> be able to do away with the global bower install, but really there is no harm in having it globally. It seems like a reasonable system-wide dependency to have available on a test box.<br /><br />Now if I run the Jenkins build, I get:<br /><pre class=prettyprint>...<br />[TEST] book/code-js/angular (Bower updated).<br />/home/cstrom/local/node-v0.10.31/lib/node_modules/karma/node_modules/di/lib/injector.js:9<br />      throw error('No provider for "' + name + '"!');<br />            ^<br />Error: No provider for "framework:jasmine"! (Resolving: framework:jasmine)<br />...</pre>This one is a little tricky. The solution is obvious enough—I need to install the karma-jasmine NPM package. But how should this get installed? <br /><br />I think the answer is that my test script should be responsible for this. It is already working through each directory in my book code, installing bower components and running Karma:<pre class=prettyprint>for X in book/code-js/*<br />do<br />    # Change the current working directory to a chapter's code directory:<br />    cd $X<br /><br />    # Update bower<br />    bower update --quiet<br />    echo "(Bower updated)."<br /><br />    # Run the Karma tests<br />    xvfb-run karma start --single-run --log-level warn<br />    # ...<br />done</pre>On my dev box, I manually ensure that the NPM dependencies (like karma plugins) are installed with a command line <code>npm install</code>. I need some way to automate this on my test server. Since I am already bower installing, I might as well npm install first.<br /><br />I think.<br /><br />I am honestly unsure about that so, for now, I add a <code>sed</code> script before the test runner in Jenkins' Execute Shell entry:<pre class=prettyprint>#!/bin/bash -l<br /><br />export PATH=/home/cstrom/local/node-v0.10.31/bin:$PATH<br /><br /><b>sed -i 's/bower update --quiet/npm install; bower update --quiet/' scripts/test.sh</b><br /><br />scripts/test.sh</pre>If this works, I will ruminate on it and possibly edit the <code>test.sh</code> global test runner. Of course, that does not work...<br /><br />After all that, I finally reach:<pre class=prettyprint>ERROR [launcher]:  Cannot start Chrome<br /> Can not find the binary google-chrome<br /> Please set env variable CHROME_BIN</pre>This seems easy enough. I grab the latest stable Chrome:<pre class=prettyprint>$ wget https://dl.google.com/linux/direct/google-chrome-stable_current_i386.deb</pre>And install it:<pre class=prettyprint>sudo dpkg -i google-chrome-stable_current_i386.deb                                                                   ~/Downloads<br />Selecting previously deselected package google-chrome-stable.<br />(Reading database ... 40540 files and directories currently installed.)<br />Unpacking google-chrome-stable (from google-chrome-stable_current_i386.deb) ...<br />dpkg: dependency problems prevent configuration of google-chrome-stable:<br /> google-chrome-stable depends on gconf-service; however:<br />  Package gconf-service is not installed.<br /> google-chrome-stable depends on libgconf-2-4 (>= 2.31.1); however:<br />  Package libgconf-2-4 is not installed.<br /> google-chrome-stable depends on libgdk-pixbuf2.0-0 (>= 2.22.0); however:<br />  Package libgdk-pixbuf2.0-0 is not installed.<br /> google-chrome-stable depends on libglib2.0-0 (>= 2.28.0); however:<br />  Version of libglib2.0-0 on system is 2.24.2-1.<br />...</pre>And here, I may be stuck. <br /><br />I do not know if it is going to be possible to install Chrome on Debian 6 because of these errors. I suppose I might try Firefox instead, but that seems more like a nice-to-have whereas Chrome is a requirement to fully test Polymer. It looks like I may need to upgrade to Debian 7. Which may be one yak too many.<br /><br /><br /><span style="color: #ccc">Day #178</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/09/jenkins-for-testing-dart-and-javascript.html#ssh_config">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/1KbT4APdEi4" height="1" width="1"/>
