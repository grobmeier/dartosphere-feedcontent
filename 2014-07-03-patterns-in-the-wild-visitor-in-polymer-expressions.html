---
title: 'Patterns in the Wild: Visitor in Polymer Expressions'
layout: post
published: '2014-07-03T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/688ZVITrTCY/patterns-in-wild-visitor-in-polymer.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - 'patterns in the wild'
    - 'visitor pattern'

---

<div class=top-chain-links></div><br />I expect lack of pattern experience will prove problematic while writing <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>. Of course, that is a big part of why I am writing the book—to earn a better understanding of patterns I do know and to finally understand those with which I have less experience.<br /><br />Some patterns I don't know because most of my career has been spent in dynamic languages where certain <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four</a> patterns are not really necessary. Other patterns I do not know because I have rarely worked on code that warranted them. Still other patterns I don't know because I hate them. <br /><br />Tonight's patterns falls into the latter two categories: enter the <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a>. Why do I hate it if I have not had much call to use it? In my 10+ year of programming, I can count the number of times that I have seen it in clients' codebases. Each of the handful of times that I have seen the Visitor Pattern it was somebody writing a pattern for the sake of writing a pattern rather than actual need. That happens a lot, of course, with Design Patterns, but for whatever reason the Visitor Pattern implementations that I have stuck in my mind more than others.<br /><br />Since I hate it so, it is the perfect behavioral design pattern for me to start investigation. I need to put silly biases behind (and I admit that this bias is very silly) in order to do a proper job in this book. In fact, I need to learn to love each of the patterns for their intrinsic good qualities. <br /><br />I also need to decide how to approach patterns that are foreign to me. Do I re-implement the examples from the source material (the equipment composite example in GoF is quite approachable) or do I start with an example in the wild? Basing new code from the source material sounds more comfortable and approachable, so I chose the other option tonight. Let's see how I might start by reviewing code in the wild. <br /><br />And what better project to investigate than <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>? Specifically, the <a href="https://pub.dartlang.org/packages/polymer_expressions">polymer_expressions</a> package makes good use of Visitor to work with the abstract syntax tree that it builds to process expressions in Polymer code.<br /><br />The intent of the Visitor patterns is to keep individual elements free of operations that can be better grouped in a single location—concrete implementations of the visitor.  A nice example of this is the <code>Literal</code> expression class:<pre class=prettyprint>class Literal&lt;T> extends Expression {<br />  final T value;<br /><br />  Literal(this.value);<br /><br />  accept(Visitor v) => v.visitLiteral(this);<br /><br />  String toString() => (value is String) ? '"$value"' : '$value';<br /><br />  bool operator ==(o) => o is Literal&lt;T> && o.value == value;<br /><br />  int get hashCode => value.hashCode;<br />}</pre>There is not too much to this node in the syntax tree. It might be a string in the Polymer syntax. For example, the empty string in the sample expression from the <a href="https://pub.dartlang.org/packages/polymer_expressions">package page</a>:<pre class=prettyprint>{{ person.title + " " + person.getFullName() | upppercase }}</pre>This node would be instantiated with <code>this.value</code> set to <code>" "</code>. The result of the <code>toString()</code> method would return <code>'" "'</code>. There is even a simple equality check. Nice and simple.<br /><br />There are two visitor in polymer_expressions. Polymer passes each of these visitor to the syntax tree to apply whatever each of these grouped bits of functionality need. The first evals the tree and the second established any observers that are necessary:<pre class=prettyprint>Object eval(Expression expr, Scope scope) => new EvalVisitor(scope).visit(expr);<br />ExpressionObserver observe(Expression expr, Scope scope) {<br />  var observer = new ObserverBuilder().visit(expr);<br />  return observer;<br />}<br /></pre>The nice thing here is that<br /><br /><span style="color: #ccc">Day #111</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/07/mirrorsused-meta-targets.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/688ZVITrTCY" height="1" width="1"/>
