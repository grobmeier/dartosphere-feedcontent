---
title: 'Chain of Responsibility, but with noSuchMethod'
layout: post
published: '2016-02-12T23:03:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/w1-ZfdxU-K0/chain-of-responsibility-but-with.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'chain of responsibility pattern'
    - dart
    - dartlang
    - 'design patterns'

---

<div class=top-chain-links></div><br />Most of the fun of the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility pattern</a> is building the chain. One of the implementations suggested in the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four book</a> involves Smalltalk's <code>doesNotUnderstand</code>. In <a href="http://dartlang.org">Dart</a>, that means it is time for some <code>noSuchMethod()</code> fun.<br /><br />In the purchasing power example that I adapted from Wikipedia, the handler currently supports the chain with:<pre class=prettyprint>abstract class PurchasePower {<br />  PurchasePower _successor;<br />  void set successor(PurchasePower successor) {<br />    _successor = successor;<br />  }<br /><br />  void processRequest(PurchaseRequest request) {<br />    if (_successor != null) {<br />      _successor.processRequest(request);<br />    }<br />  }<br />}</pre>If a concrete handler sets the successor, then the <code>processRequest()</code> method in this handler base class will forward the request on to the next handler in the chain. <br /><br />For example, the manager-level purchasing power handler will handle requests for less than $10k:<pre class=prettyprint>class ManagerPurchasePower extends PurchasePower {<br />  final double _allowable = 10 * 1000.0;<br /><br />  void processRequest(PurchaseRequest request) {<br />    if (request.amount < _allowable) {<br />      print("Manager will approve $request.");<br />      return;<br />    }<br />    super.processRequest(request);<br />  }<br />}</pre><p>If the request is for more, then the superclass implementation of <code>processRequest()</code> is invoked, passing the request along to the next object in the chain. The nice thing about this approach is that a subclass that does not want to handle a request can simply omit a declaration of <code>processRequest()</code>, allowing the superclass to forward the request on to the chain successor.</p><p>So what does <code>noSuchMethod()</code> buy me in this scenario? Not a ton, but it does yield a more generalized approach to handling requests. In the baseclass, I replace the previous <code>processRequest()</code> with:</p><pre class=prettyprint>import 'dart:mirrors' show reflect;<br />abstract class PurchasePower {<br />  // ...<br />  noSuchMethod(args) {<br />    if (_successor == null) return;<br />    reflect(_successor).delegate(args);<br />  }<br />}</pre><p>If a concrete class does not define a method like <code>processRequest()</code> (or invokes it directly in the superclass), then the invocation winds up in <code>noSuchMethod()</code>. If there is no successor in the chain, then nothing is returned, terminating the chain. Otherwise, thanks to the magic of <code>delegate()</code>, the successor is reflected so that the method being invoked can be sent to the successor along with any arguments. </p><p>With that, when <code>processRequest()</code> in concrete handlers invokes the method of the same name in the superclass, <code>noSuchMethod()</code> kicks in, forwarding the request along to the successor. The behavior is exactly the same as with an explicit <code>processRequest()</code> in the superclass, only <code>noSuchMethod()</code> will work with any method, instead of a single method. </p><p>So, in the end, I don't know that this buys me much, except when multiple handlers are involved. Or when one simply wants to have fun with mirrors.</p><p><i>Play with the code on DartPad: <a href="https://dartpad.dartlang.org/894142038ed1185e8d4a">https://dartpad.dartlang.org/894142038ed1185e8d4a</a>.</i></p><br><span style="color: #ccc">Day #93</span>    <p class=bottom-chain-links><a href="http://japhr.blogspot.com/2016/02/the-chain-of-responsibility-pattern-in.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/w1-ZfdxU-K0" height="1" width="1" alt=""/>
