---
title: 'Testing Polymer.dart Synchronization with Form Input Fields'
layout: post
published: '2014-11-24T23:59:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/-ql9VLopSQw/testing-polymerdart-synchronization.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />Surprisingly, none of my <a href="http://dartlang.org">Dart</a> are failing. Or have failed. It's not that I expect Dart tests to fail with any regularityâ€”far from it. It is just that the test for the JavaScript version of <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> seem to fail every other week or so. <br /><br />It probably helps that <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> has remained at 0.15 for a while now. I could also use some better tests. And since I went to all that trouble last night to write a test for the plain-old forms <code>&lt;input></code> value synchronizing with Polymer chapter in JavaScript, it seems that I ought to write the same thing for Dart.<br /><br />The test last wound up looking like:<pre class=prettyprint><code>  describe('syncing &lt;input> values', function(){<br />    var input;<br /><br />    beforeEach(function(done){<br />      input = document.createElement('input');<br />      container.appendChild(input);<br /><br /><b>      syncInputFromAttr(input, el, 'state');</b><br /><br />      el.model.firstHalfToppings.push('pepperoni');<br />      el.async(done);<br />    });<br /><br />    it('updates the input', function(){<br />      expect(input.value).toEqual('pepperoni');<br />    });<br />  });</code></pre>Cerate an <code>&lt;input></code>, sync it with the <code>&lt;x-pizza></code> Polymer element, add a pepperoni to the Polymer element and expect that the <code>&lt;input></code> now contains pepperoni as well.<br /><br />As with last night's JavaScript solution, I am using <code>MutationObserver</code> objects to synchronize my elements:<pre class=prettyprint>syncInputFromAttr(input, el, attr) {<br />   var observer = new MutationObserver((changes, _) {<br />    changes.forEach((change) {<br />      if (change.attributeName == attr) {<br />        input.value = change.target.attributes[change.attributeName];<br />      }<br />    });<br />  });<br />  observer.observe(el, attributes: true);<br />}</pre><br />The  test is then:<pre class=prettyprint><code>  group('syncing &lt;input> values', (){<br />    var input;<br /><br />    setUp((){<br />      input = createElement('<input>');<br />      _container.append(input);<br /><br />      syncInputFromAttr(input, _el, 'state');<br /><br />      _el.model.firstHalfToppings.add('pepperoni');<br />    });<br /><br />    test('updates the input', (){<br />      _el.async(expectAsync((_){<br />      expect(<br />        input.value,<br />        startsWith('First Half: [pepperoni]')<br />      );<br /><br />        }));<br /><br /><br />    });<br />  });</code></pre>And that actually works.<br /><br /><br /><br /><span style="color: #ccc">Day #4</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/11/replacing-mutationobserver-with.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/-ql9VLopSQw" height="1" width="1"/>
