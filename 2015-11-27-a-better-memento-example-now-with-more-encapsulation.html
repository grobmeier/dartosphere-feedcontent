---
title: 'A Better Memento Example: Now with More Encapsulation!'
layout: post
published: '2015-11-27T23:32:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/DBGSFmZy_-A/a-better-memento-example-now-with-more.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - memento

---

<div class=top-chain-links></div><br />Up tonight, I take a closer look at encapsulation in the <a href="https://en.wikipedia.org/wiki/Memento_pattern">memento pattern</a>. I have a decent start on the pattern from last night, but I glossed over one of the important reasons behind the memento pattern. Per the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four book</a>, the pattern is applicable when obtaining state would break encapsulation.<br /><br />Currently, the caretaker of the pattern plays a song, remembers the state on occasion, and replays particularly good Mel Tormé songs:<pre class=prettyprint><code>  List&lt;String> replayer = [];<br />  var scatMan = new VelvetFogMachine();<br />  // ...<br />  scatMan.play(<br />      'New York, New York Medley',<br />      'A Vintage Year'<br />  );<br />  replayer.add(scatMan.nowPlaying);<br />  // ...<br /><br />  // The New York, New York Medley with George Shearing really is wonderful<br />  scatMan.backTo(replayer[1]);</code></pre>The encapsulation in this case is in the <code>nowPlaying</code> getter of the <code>VelvetFogMachine</code>. The <code>nowPlaying</code> property in the Melvie-tastic <code>VelvetFogMachine</code> is a list of strings (the title and album of the song):<pre class=prettyprint>class VelvetFogMachine {<br />  List&lt;String> _nowPlaying;<br />  // ...<br />}</pre>There is not much to the state being exposed and what state is exposed comes directly from the caretaker (i.e. the title and album). So this may not be the ideal example. In addition to the song playing, I will try storing the current time within the song as well:<pre class=prettyprint>// The Memento<br />class Playing {<br />  String title, album;<br />  double time;<br />  Playing(this.title, this.album, this.time);<br />}</pre>If I tried to store this in the caretaker context, then I would certainly be breaking encapsulation. I would have to note the title, album and time at which the playing moved to the next song. Those aren't exactly related values, so this seems a better example.<br /><br />Since I do not wish to expose the underlying implementation, the <code>replayer</code> can no longer be a list of strings. Instead, it needs to be a list of <code>Playing</code> objects (i.e. a list of mementos):<pre class=prettyprint><code>  List&lt;Playing> replayer = [];</code></pre>Nothing else needs to change in the caretaker code. The <code>scatMan</code> still plays songs by title and album. The <code>nowPlaying</code> property still returns a memento—albeit a more complex one. The <code>backTo()</code> method still takes the memento and uses it to restore state. Nothing really changed, but the more complex example better justifies the application of the pattern.<br /><br />The code in <code>VeletFogMachine</code> does not change much—it just needs to accommodate time now. The <code>play()</code> method optionally accepts it:<pre class=prettyprint><code>  void play(String title, String album, [double time = 0.0]) {<br />    print("Playing $title // $album @ ${time.toStringAsFixed(2)}");<br />    _nowPlaying = new Playing(title, album, time);<br />  }</code></pre>And the <code>backTo()</code> method needs to use the stored value to resume playing where it left off:<pre class=prettyprint><code>  // Restore from memento<br />  void backTo(Playing memento) {<br />    print("  *** Whoa! This was a good one, let's hear it again :) ***");<br />    play(memento.title, memento.album, memento.time);<br />  }</code></pre>After adding a random number for the saved time, I have everything working—including restoring from the slightly more complex state:<pre class=prettyprint>$ ./bin/play_melvie.dart                                       <br />...<br />Playing The Lady is a Tramp // The Velvet Frog: The Very Best of Mel Tormé @ 0.00<br />  *** Whoa! This was a good one, let's hear it again :) ***<br />Playing New York, New York Medley // A Vintage Year @ 1.28</pre>That seems a good place to stop for tonight. The memento seems a relatively simple pattern, which is making me feel the urge to move on to other patterns. But it is probably worth exploring a few more facets of the pattern in the next day or so. First up, I plan to see if there is a more "Darty" solution. Tomorrow.<br /><br /><i>Play with this code on DartPad: <a href="https://dartpad.dartlang.org/bf9c7454247a122030f9">https://dartpad.dartlang.org/bf9c7454247a122030f9</a></i><br /><br /><br /><span style="color: #ccc">Day #16</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/11/the-velvet-fog-memento.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/11/memento-not-as-state.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/DBGSFmZy_-A" height="1" width="1" alt=""/>
