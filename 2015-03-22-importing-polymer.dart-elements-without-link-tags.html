---
title: 'Importing Polymer.dart Elements without <link> Tags'
layout: post
published: '2015-03-22T21:10:00-07:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/K4URFPF0KiI/importing-polymerdart-elements-without.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />Doing away with <code>&lt;link></code> imports in <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> 0.16 is <a href="https://www.dartlang.org/polymer/reference/release-notes/#polymer-0160">pretty darn cool</a>. It could also present me with a challenge in <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>. Hopefully I can make it work without too much effort, especially with the 1.2 edition right around the corner. There is only one way to find out!<br /><br />My main concern is that, wherever possible in the book, I use the same text for both the JavaScript and <a href="http://dartlang.org">Dart</a> versions. This cuts down on copy edits and keeps me focused on concepts rather than nuances between the two implementations. This change would seem to necessitate more nuances—even if mostly confined to the setup sections of each chapter.<br /><br />Much of the initialization in the Dart version of the book pulls in the <code>&lt;x-pizza></code> definition and initializes Polymer like this:<pre class=prettyprint><code>    &lt;!-- Load component(s) --><br />    &lt;link rel="import"<br />          href="packages/page_objects/elements/x-pizza.html"><br /><br />    &lt;!-- Start Polymer --><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>The new alternative available in 0.16 is to start Polymer and load the definition at the same time:<pre class=prettyprint><code>    &lt;!-- Load the component and start Polymer --><br />    &lt;script type="application/dart"><br /><b>      import 'packages/page_objects/elements/x_pizza.dart';</b><br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>I can't just make that change. In the previous version of Polymer.dart, the link-tag-imported HTML template definition pulled in the code definition. This new approach is importing the code definition, so now it needs a way to pull in the template definition.<br /><br />Without updating my element definition, I get a warning that <code>&lt;x-pizza></code> is no longer defined:<pre class=prettyprint>[Warning from polymer (Linter) on page_objects|web/index.html]:<br />line 14, column 7 of web/index.html: custom element with name "x-pizza" not found. See http://goo.gl/5HPeuP#polymer_11 for details.<br />&lt;x-pizza><br />^^^^^^^^^<br />Build completed successfully</pre>Why that counts as a successful build, I could not say, but it definitely needs a little something extra. My <code>x_pizza.dart</code> backing code had been:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'dart:convert';<br />import 'dart:async';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // Super cool pizza stuff here...<br />}</pre>To make this work with no-link-tag importing, I have to annotate the code as a library using <code>@HtmlImport</code>—the <code>@HtmlImport</code> annotation effectively taking the place of the old link-tag importing:<pre class=prettyprint><b>@HtmlImport('x-pizza.html')<br />library x_pizza;</b><br /><br />import 'package:polymer/polymer.dart';<br />import 'dart:convert';<br />import 'dart:async';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />}</pre>The old link-tag importing still works if one prefers that, but this definitely cuts down on the number of lines required in the containing web page.<br /><br />For this particular code, I am not quite done. Everything compiles and runs without error, but the <code>&lt;x-pizza></code> element no longer displays any UI. There are no warnings in the browser console, but I do see this message:<pre class=prettyprint>No elements registered in a while, but still waiting on 1 elements to be registered. Check that you have a class with an @CustomTag annotation for each of the following tags: 'x-pizza-toppings'</pre>The problem here is that my <code>&lt;x-pizza></code> uses the <code>&lt;x-pizza-toppings></code> Polymer element for adding toppings (first half, second half, and whole) to the pizza. This error is telling me that I must also adapt it to the new approach.<br /><br />I find this a strange error because I am still link-tag importing this child element from the <code>&lt;x-pizza></code> template:<pre class=prettyprint><b>&lt;link rel="import" href="x-pizza-toppings.html"></b><br />&lt;polymer-element name="x-pizza"><br />  &lt;!-- Pizza html template stuff here.. --><br />&lt;/polymer-element></pre>This template definition for <code>&lt;x-pizza-toppings></code> pulls in the backing class via the usual script tag:<pre class=prettyprint>&lt;link rel="import" href="../../../packages/polymer/polymer.html"><br />&lt;polymer-element name="x-pizza-toppings"><br />  &lt;!-- Pizza topping html template stuff here.. --><br /><b>  &lt;script type="application/dart" src="x_pizza_toppings.dart">&lt;/script></b><br />&lt;/polymer-element></pre>And in that backing class is the <code>@CustomTag</code> that Polymer is complaining about:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><br /><b>@CustomTag('x-pizza-toppings')</b><br />class XPizzaToppings extends PolymerElement {<br />  // Pizza topping code...<br />}</pre>I am able to get this working, but then things get really strange... <br /><br />To get it working, I convert <code>&lt;x-pizza-toppings></code> to the new no-link-tag style class definition:<pre class=prettyprint><b>@HtmlImport('x-pizza-toppings.html')<br />library x_pizza_toppings;</b><br /><br />import 'package:polymer/polymer.dart';<br /><br />@CustomTag('x-pizza-toppings')<br />  // Pizza topping code here...<br />}</pre>In the code for the <code>XPizza</code> backing class, I now have to <code>import</code> (the Dart kind, not the link-tag kind) the <code>x_pizza_toppings.dart</code> code:<pre class=prettyprint>@HtmlImport('x-pizza.html')<br />library x_pizza;<br /><br />import 'package:polymer/polymer.dart';<br />import 'dart:convert';<br />import 'dart:async';<br /><b>import 'x_pizza_toppings.dart';</b><br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  //  Pizza stuff here...<br />}</pre>I also have to work back through the HTML template definitions in both <code>x-pizza.html</code> and <code>x-pizza-toppings.html</code> to remove the old link imports <i>and</i> the <code>&lt;script></code> tags that reference the backing class. Removing the <code>&lt;script></code> tags makes sense—the backing class is now responsible for pulling the template, not the other way around. So that is not too strange.<br /><br />What is strange here is that I can no longer reproduce the original “waiting on 1 elements to be registered” error condition. If it revert my changes completely and retrace my steps, things either work or fail in different (more easily understood) ways. It feels like some bad code got cached somewhere (in the <code>.pub</code> directory?) during my initial pass at this, but can no longer be produced. That or I did something crazy the first pass through. <br /><br />I am uncomfortable with this—it feels like I need to be quicker to  manually delete <code>.pub</code> when I start doing this kind of thing. At the same time, I shouldn't have to do anything of the sort. For now, I chalk it up to pre-release glitches and (more likely) a dumb mistake that I can no longer remember. <br /><br />In the end, I like the new approach. The waiting-for-registration problem leaves me a little unsettled, so I am not quite ready to adopt it as <i>the</i> approach in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>. But it is probably worth a mention somewhere.<br /><br /><br /><span style="color: #ccc">Day #6</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/scheduled-polymer-and-angular-dart-tests.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/new-and-old-style-polymerdart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/K4URFPF0KiI" height="1" width="1" alt=""/>
