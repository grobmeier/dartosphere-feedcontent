---
title: 'New and Old Style Polymer.dart'
layout: post
published: '2015-03-24T00:16:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/uwZm56GJmUE/new-and-old-style-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />Don't you hate it when code doesn't break? <br /><br />Now, don't get me wrong, I like working code as much as the next programmer. Working code is smashing. But when you expect code to break and it doesn't, what's left? Well, a blog post I suppose…<br /><br />I am not completely sold on the new code import alternative available in <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> 0.16. It certainly has its appeal. Instead of using old link-tag imports to pull in Polymer element definitions:<pre class=prettyprint><code>    &lt;!-- Load component(s) --><br /><b>    &lt;link rel="import"<br />          href="packages/page_objects/elements/x-pizza.html"></b><br /><br />    &lt;!-- Start Polymer --><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>Now we can import the same element, <code>&lt;x-pizza></code> in this case, with normal <a href="http://dartlang.org">Dart</a>  <code>import</code> statements:<pre class=prettyprint><code>    &lt;!-- Load the component and start Polymer --><br />    &lt;script type="application/dart"><br /><b>      import 'packages/page_objects/elements/x_pizza.dart';</b><br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>My only real concern about the new approach is that there is no JavaScript equivalent (perhaps a use for an ES6 module polyfill?). That aside, importing code with Dart's <code>import</code> seems preferable to a link-tag import, which takes some getting used to.<br /><br />Of course, now that I am used to link-tag importing, the new code importing takes some getting used to. Last night, I was able to adapt existing code to the new style relatively easily. Polymer code, of course, has both template and backing code parts. With the link-tag approach, everything ran through the HTML template definition, which then had to <code>&lt;script></code> source the backing class definition. The new code import approach starts with the code, which then has to import the template definition. <br /><br />That all worked fine last night (aside from a minor, unexplained glitch). Except nothing broke.<br /><br />I suppose I should be grateful, but I expected my tests to break. And darn it all, they still work (both in the browser and headless with <code>content_shell</code>):<pre class=prettyprint>PASS<br />1       PASS<br />Expectation: [defaults] it has no toppings .<br /><br />2       PASS<br />Expectation: [adding toppings] updates the pizza state accordingly .<br /><br />All 2 tests passed</pre>I did not necessarily expect either of the two tests to fail, but the <a href="https://www.dartlang.org/polymer/reference/release-notes/#polymer-0160">0.16 release notes</a> mention that link-importing a Polymer element converted to the new style should generate <a href="https://code.google.com/p/dart/issues/detail?id=22712">a warning</a>. I see no such warning even though my tests are using the link-import approach with my code-import Polymer element:<pre class=prettyprint>&lt;!doctype html><br />&lt;html><br />&lt;head><br />  &lt;!-- Load component(s) --><br /><b>  &lt;link rel="import" href="packages/page_objects/elements/x-pizza.html"></b><br /><br />  &lt;!-- The actual tests --><br />  &lt;script type="application/dart" src="test.dart">&lt;/script><br />  &lt;script src="packages/unittest/test_controller.js">&lt;/script><br />&lt;/head><br />&lt;body>&lt;/body></pre>So why am I not seeing an error? <br /><br />The answer turns out to be simple enough—and it also explains my “glitch” from yesterday. As expected, it was <a href="http://en.wikipedia.org/wiki/User_error">PEBKAC</a>. During my various refactorings and unfactorings (undoing the refactoring to reproduce the original state), I neglected to move the old-style link-tag imports from the <code>&lt;x-pizza></code> template definition:<pre class=prettyprint><b>&lt;link rel="import" href="x-pizza-toppings.html"></b><br />&lt;polymer-element name="x-pizza"><br />  &lt;template><br />    &lt;h2>Build Your Pizza&lt;/h2><br />    &lt;x-pizza-toppings id="firstHalfToppings"<br />                      name="First Half Toppings"<br />                      ingredients="{{ingredients}}">&lt;/x-pizza-toppings><br />    &lt;!-- Second and whole toppings defined here... --><br />  &lt;/template><br /><b>  &lt;script type="application/dart" src="x_pizza.dart">&lt;/script></b><br />&lt;/polymer-element></pre>If I remove the link-import of the <code>&lt;x-pizza-toppings></code> child element and the <code>&lt;script></code> sourcing of the <code>x_pizza.dart</code> backing class, then my tests fail. Yay!<br /><br />The tests fail, but the sample page using the new code-import still works. I can get the test to pass by converting it to the code-import approach as well. The test container page becomes trivial, loading only the test file and the usual JavaScript test harness:<pre class=prettyprint>&lt;!doctype html><br />&lt;html><br />&lt;head><br /><b>  &lt;script type="application/dart" src="test.dart">&lt;/script></b><br />  &lt;script src="packages/unittest/test_controller.js">&lt;/script><br />&lt;/head><br />&lt;body>&lt;/body><br />&lt;/html></pre>The test is then responsible for code-importing the element (and initializing Polymer in the usual test manner):<pre class=prettyprint>library x_pizza_test;<br /><br />import 'package:scheduled_test/scheduled_test.dart';<br />import 'package:unittest/html_config.dart';<br />import 'package:polymer/polymer.dart';<br /><b>import 'packages/page_objects/elements/x_pizza.dart';</b><br /><br />main() {<br />  useHtmlConfiguration();<br /><b>  initPolymer();</b><br />  // Tests here...<br />}<br /></pre>With that, my tests all pass and my sample page still works.<br /><br />As for the warning message indicated in the release notes, I am unable to reproduce it. The code-import Polymer element still works from the same page when link-tag imported:<pre class=prettyprint><code>    &lt;link rel="import"<br />          href="packages/page_objects/elements/x-pizza.html"><br />    &lt;script type="application/dart"><br />      import 'package:polymer/polymer.dart';<br />      import 'packages/page_objects/elements/x_pizza.dart';<br /><br />      main() {<br />        initPolymer();<br />      }<br />    &lt;/script></code></pre>Of course, that is silly—it link-tag imports the template and code imports the backing class. If I want both the code-import and link-tag import to work with my Polymer element, I have to use the <a href="https://gist.github.com/jakemac53/6db65176335242581b4e">“nodart” intermediate template approach</a> linked in the release notes. <br /><br />That is, the template-only HTML file (i.e. without link-imports and <code>&lt;script></code> sourcing) moves to <code>x-pizza-nodart.html</code>:<pre class=prettyprint>&lt;polymer-element name="x-pizza"><br />  &lt;template><br />    &lt;-- Template HTML here... --><br />  &lt;/template><br />&lt;/polymer-element></pre>The Dart class that now does the code import needs to refer to this “nodart” template:<pre class=prettyprint><b>@HtmlImport('x-pizza-nodart.html')</b><br />library x_pizza;<br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // Code definition here...<br />}</pre>Lastly, a link-tag importable <code>x-pizza.html</code> definition link-imports the template and <code>&lt;script></code> sources the backing class:<pre class=prettyprint>&lt;link rel="import" href="x-pizza-nodart.html"><br />&lt;script type="application/dart" src="x_pizza.dart">&lt;/script></pre>With that, I can go back to the main page to link-import the element:<pre class=prettyprint><code>    &lt;link rel="import"<br />          href="packages/page_objects/elements/x-pizza.html"><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>Or, without making any changes to the Polymer code or template HTML, I can code-import:<pre class=prettyprint><code>    &lt;script type="application/dart"><br />      import 'packages/page_objects/elements/x_pizza.dart';<br />      export 'package:polymer/init.dart';<br />    &lt;/script></code></pre>In the first case, the <code>x-pizza.html</code> template finds both the backing class and the template. In the second case, the <code>x_pizza.dart</code> code imports the template. In both cases, there is a minimum of fuss and no errors. I do wonder why I am unable to generate the warning described in the release notes, but I doubt I will lose too much sleep over it.<br /><br /><br /><span style="color: #ccc">Day #7</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/importing-polymerdart-elements-without.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/uwZm56GJmUE" height="1" width="1" alt=""/>
