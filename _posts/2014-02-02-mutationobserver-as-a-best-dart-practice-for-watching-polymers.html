---
title: 'MutationObserver as a Best (Dart) Practice for Watching Polymers'
layout: post
published: '2014-02-02T16:31:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/UomVoLhasAg/mutationobserver-as-best-dart-practice.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - ie
    - 'mutation observer'
    - polymer

---

<div class=top-chain-links></div><br />It's always something. At least that's how it feels sometime when coding <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>. Working with observable attributes <a href="http://code.google.com/p/dart/issues/detail?id=15512">does not always work</a> with raw <a href="http://dartlang.org">Dart</a>. If you run the code through the Polymer asset transform for <a href="http://pub.dartlang.org/">Dart Pub</a>, then observables work fine in <a href="http://www.dartlang.org/dartium/">Dartium</a>. But then, of course, things need to be compiled to JavaScript to work across the modern web (except for <a href="http://code.google.com/p/dart/issues/detail?id=16194">unstable Chrome</a>). That <i>usually</i> works…<br /><br />But it did not work for last night's code that tried to listen to the changes stream for a Polymer:<pre class=prettyprint><code>    // DOESN"T WORK IN IE!!!!!!!!!!!!!!!!!<br />    el.changes.listen((changes) {<br />      changes.forEach((change) {<br />        print(<br />          '[changes] '<br />          '${change.name} changed '<br />          'from: ${change.oldValue} '<br />          'to: ${change.newValue}.'<br />        );<br />      });<br />    });</code></pre>Well, it works in Firefox, but when I try to load this in Internet Explorer, I get <code>Object doesn't support property or method get$changes</code>:<br /><br /><a href="http://1.bp.blogspot.com/-ZkSI7ok_aJU/Uu6zdlYPXrI/AAAAAAAAVCU/j3OSm-YHxE0/s1600/01-ie_object_not_supported_changes.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-ZkSI7ok_aJU/Uu6zdlYPXrI/AAAAAAAAVCU/j3OSm-YHxE0/s640/01-ie_object_not_supported_changes.png" /></a><br /><br />At this point, there is precious little that I can do about that specific error. Between the observable woes, the compile time, things not working in the dev channel version of Chrome, I feel as if I am working too much with the proverbial spit and duct tape already. So I abandon listening to the <code>changes</code> property, at least for the purposes of using it in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>. Instead, I fallback to the JavaScript solution, which is to use <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">mutation observers</a>.<br /><br />Mutation observers are a new browser standard that watch for changes (change watcher just doesn't sound as cool as mutation observer). Since they are new, they are not supported by Internet Explorer 10. But, unlike the <code>changes</code> property which does not seem to get translated by <code>dart2js</code>, mutation observers do compile—even down to Internet Explorer 10.<br /><br />So the above <code>changes</code> based code becomes:<pre class=prettyprint><code>    var observer = new MutationObserver((mutations, _) {<br />      mutations.forEach((mutation) {<br />        print(<br />          '[mutation] ' +<br />          mutation.attributeName +<br />          ' is now: ' +<br />          mutation.target.attributes[mutation.attributeName]<br />        );<br />      });<br />    });<br />    observer.observe(el, attributes: true);</code></pre>Just as <a href="http://japhr.blogspot.com/2014/01/watching-polymer-attributes.html">I found with the JavaScript</a> <code>MutationObserver</code>, the constructor for a Dart <code>MutationObserver</code> takes a callback function that will be invoked whenever observed changes are seen. For some reason the Dart callback requires two parameters, the second is the observer instance that was just created. Since I need that in scope for the call to <code>observer.observe()</code> anyway, I just stick with a placeholder variable for the second parameter. <br /><br />With that, I have a Dart solution for observing Polymers that works. Even in IE:<br /><br /><a href="http://4.bp.blogspot.com/-VxSJDOFlDEA/Uu63a5M4x5I/AAAAAAAAVCg/DQ_RkwKcHT8/s1600/02-mutations_in_ie.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-VxSJDOFlDEA/Uu63a5M4x5I/AAAAAAAAVCg/DQ_RkwKcHT8/s640/02-mutations_in_ie.png" /></a><br /><br />Bother. I suppose I cannot complain too much. Living life on the bleeding edge for books like <a href="http://patternsinpolymer.com">Patterns in Polymer</a> fairly well invites struggles like this. Still, it forces me to keep a delicate balance between understanding what really works today and what is likely to work as readers are trying to use the book. In this case, I will likely stick with <code>MutationObserver</code>, if only because it fits the existing narrative a little better. Still, I would venture to guess that this will work in all supported IEs once IE 12 comes along and everyone can abandon IE 10. For me, that day can't come soon enough.<br /><br /><span style="color: #ccc">Day #1,015</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/02/pure-polymer-changes-from-outside-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/02/submitting-forms-containing-polymers.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/UomVoLhasAg" height="1" width="1"/>
