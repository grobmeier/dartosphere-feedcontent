---
title: 'Pure Polymer Changes from the Outside (Dart) World'
layout: post
published: '2014-02-01T23:59:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/A23Mm-ph9Jo/pure-polymer-changes-from-outside-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'mutation observer'
    - polymer

---

<div class=top-chain-links></div><br />The question that I need to answer today is, how do I observe <a href="http://www.polymer-project.org/">Polymer</a> attribute changes in <a href="http://dartlang.org">Dart</a>?<br /><br />For the past week or so I needed to learn how to do just that in the JavaScript version of the project. Since the ultimate goal was to use it inside an <a href="http://angularjs.org/">Angular</a> application, I skipped over this investigation in Dart at first—Dart sports that <a href="http://pub.dartlang.org/packages/angular_node_bind">angular_node_bind</a> to make this nearly trivial. Still, I would like to include a chapter on this in both the Dart and JavaScript version of <a href="http://patternsinpolymer.com">Patterns in Polymer</a>, so…<br /><br />I have a very simple <code>&lt;hello-you></code> Polymer in Dart form:<pre class=prettyprint>@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  @published String your_name;<br />  @published String color;<br />  // ...<br />}</pre>I would like for external code to be able to listen to changes for either of those attributes from outside of the Polymer. Inside the Polymer is easy—I can just listen to the <code>changes</code> property that Polymer uses to expose a stream of… changes. As I found <a href="http://japhr.blogspot.com/2014/01/watching-polymer-attributes.html">a couple of days ago</a>, this can be problematic in JavaScript between the <code>observe</code> block and changed watchers. But, in Dart, this is just a stream. So maybe it is a simple as adding another listener?<br /><br />Since this is Dart and this code will be external to Polymer, I cannot use the simple Polymer initialization script:<pre class=prettyprint><code><br /><b>    &lt;!-- THIS WON'T WORK --></b><br />    &lt;link rel="import" href="packages/changes_from_outside/elements/x-pizza.html"><br /><b>    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></b></code></pre>Instead I load the <code>main()</code> entry point in the the form of <code>main.dart</code>:<pre class=prettyprint><code>    &lt;link rel="import" href="packages/changes_from_outside/elements/hello-you.html"><br />    &lt;script type="application/dart" src="main.dart">&lt;/script></code></pre>And inside there, I manually initialized Polymer:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />main() {<br />  initPolymer().run((){<br />    // Actual code goes here...<br />  });<br />}</pre>That <code>run()</code> is interesting. It looks like a Future, but is, in fact, a Zone in which logically connected code can be run.  Really, I think the overall effect is the same in this case—there is a bunch of Polymer initialization performed by <code>initPolymer()</code> and, when complete, the zone is exposed for further action. In other words, all of my Polymer elements should be proper elements within that Zone.<br /><br />And that seems to be the case. Inside the zone, I can run a simple query for the <code>&lt;hello-you></code> element and start listening for changes right away:<pre class=prettyprint>import 'dart:html';<br />import 'package:polymer/polymer.dart';<br />main() {<br />  initPolymer().run((){<br />    query('hello-you').<br />      changes.listen((change_list) {<br />        change_list.forEach((change) {<br />          print(<br />            '[changes] '<br />            '${change.name} changed '<br />            'from: ${change.oldValue} '<br />            'to: ${change.newValue}.'<br />          );<br />        });<br />      });<br />    });<br />}</pre>In the JavaScript equivalent, that broke because the <code>changes</code> property (or the equivalent in JS) was not yet present. Instead, I had to introduce polling for Polymer properties before I could get to work listening for changes. The way the Dart equivalent of Polymer is written, I do not have to worry about Angular code being executed before Polymer or any other libraries getting in the way. I suppose that is the point of zones.<br /><br />Anyway, that code just works™. When I make changes inside my <code>&lt;hello-you></code> Polymer, they are logged in the console:<br /><br /><a href="http://4.bp.blogspot.com/-JYYkrFljwaI/Uu26koSDMDI/AAAAAAAAVBs/w8k-tdxOQWw/s1600/01-hello_bob.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-JYYkrFljwaI/Uu26koSDMDI/AAAAAAAAVBs/w8k-tdxOQWw/s640/01-hello_bob.png" /></a><br /><br />Just for completeness sake, I investigate the manner in which <a href="">angular_node_bind</a> goes about doing this. It has a bit more generalized approach that relies on the Observable package along with some template binding:<pre class=prettyprint>import 'dart:html';<br /><br /><b>import 'package:observe/observe.dart';<br />import 'package:template_binding/template_binding.dart';</b><br /><br />import 'package:polymer/polymer.dart';<br />main() {<br />  initPolymer().run((){<br />    var el = query('hello-you');<br /><br /><b>    var box = new ObservableBox();<br />    var binding = nodeBind(el).bind('color', box, 'value');<br />    box.changes.listen((changes) {<br />      print('[box] ${changes}');<br />    });</b><br />    // Regular, changes solution here...<br />  });<br />}<br /></pre>That works and does not interfere with the solution based on the Polymer <code>changes</code> property:<br /><br /><a href="http://1.bp.blogspot.com/-dzqit3kGA3o/Uu27pEq-0AI/AAAAAAAAVB0/H-lJPMu-Vdo/s1600/02-hello_bob_from_a_box.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-dzqit3kGA3o/Uu27pEq-0AI/AAAAAAAAVB0/H-lJPMu-Vdo/s640/02-hello_bob_from_a_box.png" /></a><br /><br />But I find that a bit less intuitive that the pure Polymer solution. Still, I think I have what I need for the latest chapter in the book and it seems like it won't interfere with, or be interfered by, angular_node_bind, so… win! And by win, I mean yay zones and streams!<br /><br /><br /><span style="color: #ccc">Day #1,014</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/01/publishing-to-bower-workflow.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/02/mutationobserver-as-best-dart-practice.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/A23Mm-ph9Jo" height="1" width="1"/>
