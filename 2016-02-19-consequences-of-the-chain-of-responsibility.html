---
title: 'Consequences of the Chain of Responsibility'
layout: post
published: '2016-02-19T21:42:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/Ts7Ut2O_GH4/consequences-of-chain-of-responsibility.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'chain of responsibility pattern'
    - dart
    - dartlang
    - 'design patterns'

---

<div class=top-chain-links></div><br />Before wrapping up my initial research on the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility pattern</a>, I take one last look at the consequences of code that follows it. In particular, I would like to touch on configuration and maintainability tonight.<br /><br />The example that I currently favor for illustrating the pattern is a set of cell formatting objects for a spreadsheet application:<br /><br /><a href="https://4.bp.blogspot.com/-pJ0Kypmm46k/VsfdogzP_JI/AAAAAAABELA/WWJfE14Bb8k/s1600/01-format_chain.png" imageanchor="1" ><img border="0" src="https://4.bp.blogspot.com/-pJ0Kypmm46k/VsfdogzP_JI/AAAAAAABELA/WWJfE14Bb8k/s640/01-format_chain.png" width=570 /></a><br /><br />To auto-format the cells, each formatting object in the chain is given an opportunity to claim responsibility for the content. In this example, a cell with all numbers is converted to a double with two digits after the decimal, a date is converted to ISO 8601 format, and everything else defaults to text.<br /><br />To test configuration, I add some checkboxes to disable some of the formatters:<br /><br /><a href="https://4.bp.blogspot.com/-M1D45wuuJe4/Vsf0YTEuPII/AAAAAAABELQ/T-t9raeLGFA/s1600/02-no_text_formatter_before.png" imageanchor="1" ><img border="0" src="https://4.bp.blogspot.com/-M1D45wuuJe4/Vsf0YTEuPII/AAAAAAABELQ/T-t9raeLGFA/s640/02-no_text_formatter_before.png" width=570 /></a><br /><br />The main takeaway from this is that it is possible to easily change the chain of responsibility at runtime. The <a href="http://dartlang.org">Dart</a> listener for the no-text formatting checkbox might look like:<pre class=prettyprint><code>  query('#no-text').onChange.listen((e){<br />    var el = e.target;<br />    if (el.checked) {<br />      date.nextHandler = null;<br />    }<br />    else {<br />      date.nextHandler = text;<br />    }<br />  });</code></pre>The <code>date</code> formatter normally points to the text handler. That is, if the date formatter thinks the current input field is <i>not</i> a date, then it forwards the request onto the text formatter. By ticking this checkbox, the date formatter now thinks that there is no next handler.<br /><br />Thanks to last night's <code>CellFormatter</code> base class, this just works:<pre class=prettyprint>abstract class CellFormatter {<br />  CellFormatter nextHandler;<br /><br />  void processRequest(Event e) {<br />    if (!isCell(e)) return;<br />    if (handleRequest(e)) return;<br />    if (nextHandler == null) return;<br /><br />    nextHandler.processRequest(e);<br />  }<br />  // ...<br />}</pre>With the checkbox ticked, the date formatter no longer has a <code>nextHandler</code> so the date formatter simply does nothing. The result in the UI is that a cell that was previously a numeric and was right-aligned retains the alignment because there is no longer a text formatter to reset it:<br /><br /><a href="https://4.bp.blogspot.com/-GnnTkggYmL4/Vsf0YeiCtuI/AAAAAAABELU/jMdJ4jRXA-s/s1600/03-no_text_formatter_after.png" imageanchor="1" ><img border="0" src="https://4.bp.blogspot.com/-GnnTkggYmL4/Vsf0YeiCtuI/AAAAAAABELU/jMdJ4jRXA-s/s640/03-no_text_formatter_after.png" width=570 /></a><br /><br />This illustrates another important aspect of the chain of responsibility. It is best to ensure that requests do not just "fall off" the end of the chain like this. Ideally, I ought to have a default handler at the end then resets all styles.<br /><br />One last thing that I would like to touch on before calling it a day is how robust the pattern is in the face of change. Currently, the first formatter in the chain processes event requests when changes are seen in cells:<pre class=prettyprint><code>  container.onChange.listen(number.processRequest);</code></pre>What if I also wanted to apply changes when clicks are seen inside cells? Well, aside from Dart's lack of an easy means to merge event streams, this is fairly easy to support.<br /><br />I create a <code>StreamController</code> object and add events to it whenever there are clicks or changes:<pre class=prettyprint><code>  var c = new StreamController();<br />  container.onChange.listen(c.add);<br />  container.onClick.listen(c.add);</code></pre>Then, I hand the first formatter in the chain to this combo-stream:<pre class=prettyprint><code>  c.stream.listen(number.processRequest);</code></pre>And that's all there is to it. Now I can force formatting by tabbing to another cell or, if I am feeling impatient, I can click on a cell to format its contents.<br /><br />Nice! That may finish my exploration of the chain of responsibility pattern in Dart (though there could be one more Darty trick to try). I do think this spreadsheet cell example will serve nicely in <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>. The code is fairly simple, yet still feels like a real example, which is pretty close to ideal. Plus, it serves well when discussing some of the consequences of the pattern!<br /><br /><i>Play with the code on DartPad: <a href="https://dartpad.dartlang.org/08105c648b253f64a47d">https://dartpad.dartlang.org/08105c648b253f64a47d</a>.</i><br /><br /><br /><span style="color: #ccc">Day #100</span>  <br /><br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2016/02/delegated-events-chain-of-responsibility.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/Ts7Ut2O_GH4" height="1" width="1" alt=""/>
