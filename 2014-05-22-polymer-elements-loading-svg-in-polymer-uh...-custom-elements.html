---
title: 'Polymer Elements Loading SVG in Polymer, uh… Custom Elements?'
layout: post
published: '2014-05-22T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/eRTjPEteLDw/polymer-elements-loading-svg-in-polymer.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg

---

<div class=top-chain-links></div><br />It occurs to me that, if I have a bunch of static files to load in a custom <a href="http://www.polymer-project.org/">Polymer</a> element, then perhaps some of the extended Polymer family may be of some use.<br /><br />I am continuing my efforts to understand how best to build and package a Polymer custom element that includes SVG components. Specifically, the <code>&lt;x-pizza></code> pizza building element:<br /><br /><a href="http://4.bp.blogspot.com/-x1KNt4mCNaw/U362Vaet_6I/AAAAAAAAZrA/YrDT-3x5Vz0/s1600/03-x_pizza_with_svg_images.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-x1KNt4mCNaw/U362Vaet_6I/AAAAAAAAZrA/YrDT-3x5Vz0/s400/03-x_pizza_with_svg_images.png" /></a><br /><br />My initial attempts at loading SVG files with mundane things like <code>&lt;image></code> tags went well <a href="http://japhr.blogspot.com/2014/05/simple-mouse-animations-in-svg.html">until I needed to animate</a> those files. I already have a handle on <a href="http://japhr.blogspot.com/2014/05/limited-svg-manipulation-in-dart.html">loading a single SVG file with HttpRequest</a>. I think I can probably do the same for the remaining assets, but it occurs to me that I need to do this in JavaScript <i>and</i> Dart, which complicates things.<br /><br />The driving force behind this is producing screencasts for the “Extras” version of <a href="http://patternsinpolymer.com">Patterns in Polymer</a>. I plan on producing short screencasts in both JavaScript and Dart (since the book comes in both flavors). Herein lies the complication. XHR coding in JavaScript is pretty awful without a separate library. And if I'm pulling in libraries, why not just stick with Polymer? Or, in this case the <code>&lt;polymer-ajax></code> custom element that comes in Polymer Elements.<br /><br />To explore this idea, I stick with Dart for now and start by updating my application's <code>pubspec.yaml</code> to depend on Polymer Elements:<pre class=prettyprint>name: svg_example<br />dependencies:<br />  polymer: any<br /><b>  polymer_elements: any</b><br />dev_dependencies:<br />  unittest: any<br />transformers:<br />- polymer:<br />    entry_points: web/index.html</pre>A quick <code>pub update</code> and I am ready to rock.<br /><br />And rock I do. Starting with the <code>&lt;x-pizza.html></code> template, in which I import the Polymer Elements' <code>&lt;polymer-ajax></code> tag and put it to use loading the various SVG files:<pre class=prettyprint><b>&lt;link rel="import" <br />      href="../../../packages/polymer_elements/polymer_ajax/polymer_ajax.html"></b><br />&lt;polymer-element name="x-pizza"><br />  &lt;template><br /><b>    &lt;polymer-ajax<br />       id="pizza.svg"<br />       url="/packages/svg_example/images/pizza.svg"<br />       on-polymer-response="{{responseReceived}}">&lt;/polymer-ajax><br />    &lt;polymer-ajax<br />       id="pepperoni.svg"<br />       url="/packages/svg_example/images/pepperoni.svg"<br />       on-polymer-response="{{responseReceived}}">&lt;/polymer-ajax></b><br />    &lt;!-- ... --><br />  &lt;/template><br />  &lt;script type="application/dart" src="x_pizza.dart">&lt;/script><br />&lt;/polymer-element></pre>Inside my own custom element, I follow the convention of using the SVG filename for the tag ID. This should make it easy to decipher which element has loaded when the <code>responseReceived()</code> method is invoked as each of those SVG files is loaded in turn. Speaking of <code>responseReceived()</code>, I define that as:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br /><b>  Map svgContent = {};<br />  responseReceived(e, detail, node){<br />    svgContent[node.id] = detail['response'];<br />    if (node.id == 'pizza.svg') _updateGraphic();<br />  }</b><br />  // ...<br />}<br /></pre>With each of the SVG file contents now available in the <code>svgContent</code> map, I can use them in places like <code>_updateGraphic()</code>:<pre class=prettyprint><code>  _updateGraphic() {<br /><b>    svg = new SvgElement.svg(svgContent['pizza.svg']);</b><br />    $['pizza']<br />      ..children.clear()<br />      ..append(svg);<br /><br />    _addWholeToppings();<br />    _addFirstHalfToppings();<br />    _addSecondHalfToppings();<br />  }</code></pre>That works quite nicely. It would be nice if the Dart version of <code>&lt;polymer-ajax></code> exposed a Future instead of relying on the <code>responseReceived()</code> bound methods. Even so, this is a relatively clean solution for SVG file loading in my custom Polymer element. Up tomorrow: I see if I can exploit this approach to animate some of the individual SVG files.<br /><br /><br /><br /><span style="color: #ccc">Day #71</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/simple-mouse-animations-in-svg.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/dom-animation-of-svg.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/eRTjPEteLDw" height="1" width="1"/>
