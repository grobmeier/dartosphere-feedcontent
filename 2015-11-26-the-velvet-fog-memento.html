---
title: 'The Velvet Fog Memento'
layout: post
published: '2015-11-26T23:13:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/ZumTW7FzRfA/the-velvet-fog-memento.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - memento

---

<div class=top-chain-links></div><br />I'm picking patterns to explore for <a href="http://designpatternsindart.com/">Design Patterns in Dart</a> by throwing proverbial darts at whatever <a href="http://en.wikipedia.org/wiki/Design_Patterns">design pattern</a> book happens to be closest at hand. Up tonight is the <a href="https://en.wikipedia.org/wiki/Memento_pattern">memento</a>.<br /><br />I don't much care for the abstract nature of the examples in the <a href="https://en.wikipedia.org/wiki/Memento_pattern">Wikipedia article</a> on memento. The constraint solver example in the GoF book always seemed too academic to me (though I recognize the importance of constraint solvers). I would prefer an example to which everyone can relate. Maybe something like a machine dedicated to building the ultimate Mel Tormé playlist. Everybody can relate to Melvie.<br /><br />The "originator" in this scenario will be the <code>VelvetFogMachine</code>. It will be responsible for playing the best of the most gifted scatman of the 20th century. For this first pass, I will forgo the usual method names in the memento pattern (e.g. `CreateMemento`, `restoreFromMemento`). Instead, I would like to explore with more natural names like <code>play()</code>, <code>backTo()</code>, and <code>nowPlaying</code>:<pre class=prettyprint>// The "Originator"<br />class VelvetFogMachine {<br />  // Set the state<br />  void play(String title, String album);<br /><br />  // Return a memento for possible later restoration<br />  Memento get nowPlaying;<br /><br />  // Restore from memento<br />  void backTo(Memento memento);<br />}</pre>The <code>nowPlaying</code> method will return a memento object that can be used to restore the currently playing song (i.e. the state) at a later time with <code>backTo()</code>.<br /><br />I will worry about proper serialization another day. For now, I make the <code>Memento</code> object as simple as possible. It encapsulates a string representation of the state:<pre class=prettyprint>class Memento {<br />  String state;<br />  Memento(this.state);<br />}</pre>Back in the <code>VelvetFogMachine</code> originator, the <code>play()</code> method prints the currently playing song and stores the internal state:<pre class=prettyprint>class VelvetFogMachine {<br />  List&lt;String> _nowPlaying;<br /><br />  void play(String title, String album) {<br />    print("Playing $title // $album");<br />    _nowPlaying = [title, album];<br />  }<br />  // ...<br />}</pre>As for generating a memento, I join the song and album with triple-colons in a string:<pre class=prettyprint><code>Memento get nowPlaying => new Memento(_nowPlaying.join(':::'));</code></pre>Similarly, going back to a previous state needs to split the triple-colons and change the <code>VelvetFogMachine</code> with its own call to <code>play()</code>:<pre class=prettyprint><code>  void backTo(Memento memento) {<br />    print("  *** Whoa! This was a good one, let's hear it again :) ***");<br />    var previous = memento.state.split(':::');<br />    play(previous[0], previous[1]);<br />  }</code></pre>That more-or-less covers the functionality of the originator (<code>VelvetFogMachine</code>) and memento (<code>Memento</code>) in the pattern. All that is left is the caretakers. For this first pass, I put the caretaker back in the <code>main()</code> entry point.<br /><br />Here, I need a list of possible replay targets and an instance of the <code>VelvetFogMachine</code> to play that scat music, save my place on occasion, and replay the very best moments:<pre class=prettyprint>main() {<br />  List<Memento> replayer = [];<br /><br />  var scatter = new VelvetFogMachine();<br />  scatter.play(<br />      'Blue Moon',<br />      'The Velvet Frog: The Very Best of Mel Tormé'<br />  );<br />  scatter.play(<br />      '\'Round Midnight',<br />      'Tormé'<br />  );<br />  replayer.add(scatter.nowPlaying);<br /><br />  scatter.play(<br />      'It Don\'t Mean A Thing (If It Ain\'t Got That Swing)',<br />      'Best Of/ 20th Century'<br />  );<br />  scatter.play(<br />      'New York, New York Medley',<br />      'A Vintage Year'<br />  );<br />  replayer.add(scatter.nowPlaying);<br /><br />  scatter.play(<br />      'The Lady is a Tramp',<br />      'The Velvet Frog: The Very Best of Mel Tormé'<br />  );<br /><br />  // The New York, New York Medley with George Shearing really is wonderful<br />  scatter.backTo(replayer[1]);<br />}</pre>And that does it. I can play some wonderful tunes and, when one really strikes me, I can replay it later thanks to a memento:<pre class=prettyprint>$ ./bin/play_melvie.dart<br />Playing Blue Moon // The Velvet Frog: The Very Best of Mel Tormé<br />Playing 'Round Midnight // Tormé<br />Playing It Don't Mean A Thing (If It Ain't Got That Swing) // Best Of/ 20th Century<br />Playing New York, New York Medley // A Vintage Year<br />Playing The Lady is a Tramp //  The Velvet Frog: The Very Best of Mel Tormé<br />  *** Whoa! This was a good one, let's hear it again :) ***<br />Playing New York, New York Medley // A Vintage Year<br /></pre>I do not know that there is much more to explore in this pattern. Where to serialize should be addressed (maybe in the <code>Memento</code>?). I have more general questions about how to present this—I am not fond of UML and prefer real-world examples over abstract ones. Still, I ought to be able to present how this generalizes for usage elsewhere—it is a pattern after all. Last, I need to see if I can find ways in which the pattern can be "Dartier." But for now, this is  a fine stopping place.<br /><br /><i>Play with this code on DartPad: <a href="https://dartpad.dartlang.org/5ea65d5b9e6791462547">https://dartpad.dartlang.org/5ea65d5b9e6791462547</a></i><br /><br /><br /><span style="color: #ccc">Day #15</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/11/testing-patterns.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/ZumTW7FzRfA" height="1" width="1" alt=""/>
