---
title: 'Custom_element_apigen and Using JavaScript Polymer Elements in Dart'
layout: post
published: '2014-10-02T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: //feedproxy.google.com/~r/JaphrByChrisStrom/~3/zh8JGxRxyNY/customelementapigen-and-using.html
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - javascript
    - polymer

---

<div class=top-chain-links></div><br />I had little luck using my <a href="https://github.com/eee-c/apply-author-styles/">apply-author-styles</a> JavaScript <a href="http://www.polymer-project.org/">Polymer</a> element in <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> last night. Well, I had great luck if you count hand-editing <a href="http://www.polymer-project.org/docs/elements/core-elements.html">Core Elements</a> in order to get it to work. Personally, I do not count that as good luck.<br /><br />What I do count as good luck is readers like <a href="https://plus.google.com/+JamesHurford">James Hurford</a> writing to tell me about potential solutions that I may have overlooked. In this case, I have not tried the <a href="https://pub.dartlang.org/packages/custom_element_apigen">custom_element_apigen</a> <a href="http://pub.dartlang.org/">Dart Pub</a> package, which “lets you wrap custom elements written with polymer.js and provide a Dart API for them.” I do not necessarily need a Dart API, but only the ability to use <code>&lt;apply-author-styles></code>. Still, it seems worth a try.<br /><br />To install the JavaScript <code>&lt;apply-author-styles></code> last night, I had introduced a project-level <code>.bowerrc</code> file to install it in <code>lib/bower_components</code>:<pre class=prettyprint>{<br />  "directory": "lib/bower_components"<br />}</pre>The  custom_element_apigen package would rather this go into <code>lib/src</code>:<pre class=prettyprint>{<br />  "directory": "lib/src"<br />}</pre>I already have a <code>bower.json</code> that includes apply-author-styles as a dependency:<pre class=prettyprint>{<br />  "name": "bootstrap_example",<br />  // ...<br />  "dependencies": {<br />    "bootstrap": "~3.1.0",<br /><b>    "apply-author-styles": "eee-c/apply-author-styles"</b><br />  }<br />}</pre>So I remove last night's install (hand edits and all):<pre class=prettyprint>$ rm -rf lib/bower_components</pre>And reinstall into custom_element_apigen's preferred location:<pre class=prettyprint>$ bower install<br />...<br />bootstrap#3.1.1 lib/src/bootstrap<br />└── jquery#2.1.1<br /><br />apply-author-styles#434679b8da lib/src/apply-author-styles<br />├── core-ajax#0.3.6<br />└── polymer#0.3.6</pre>It was ultimately the core-ajax and polymer dependencies that did me in last night. Core-ajax depends on core-xhr, which requires the JavaScript version of Polymer instead of the Dart version. Hopefully custom_element_apigen can work around this.<br /><br />I add custom_element_apigen to the list of Dart dependencies in my <code>pubspec.yaml</code>:<pre class=prettyprint>name: bootstrap_example<br />dependencies:<br />  polymer: any<br /><b>  custom_element_apigen: any</b><br />dev_dependencies:<br />  unittest: any<br />transformers:<br />- polymer:<br />    entry_points:<br />      - web/index.html<br />      - test/index.html<br /></pre>Then I get the new dependencies:<pre class=prettyprint>$ pub get<br />Resolving dependencies...<br />+ custom_element_apigen 0.0.3<br />Downloading custom_element_apigen 0.0.3...<br />Changed 1 dependency!</pre>The documentation is upfront about not including much information. It does not even say if the configuration file is generated or created by hand. I try the former:<pre class=prettyprint>$ pub run custom_element_apigen:update configfile.yaml<br />Parsing configuration ... <b>error: file configfile.yaml doesn't exist</b></pre>OK. I need to build this by hand. Per what documentation there is, I copy the <a href="https://github.com/dart-lang/core-elements/blob/master/core_elements_config.yaml">configuration file from core-elements</a>. I start with this:<pre class=prettyprint>files_to_generate:<br />  - apply-author-styles/apply-author-styles.html</pre>Which seems to be what custom_element_apigen wants:<pre class=prettyprint>$ pub run custom_element_apigen:update apply_author_styles_gen.yaml<br />&lt;link rel="import"<br />^^^^^^^^^^^^^^^^^^<br />1 of 1: lib/src/apply-author-styles/apply-author-styles.html[Warning from polymer (Linter) on bootstrap_example|lib/src/core-ajax/core-xhr.html]:<br />line 25, column 1 of lib/src/core-ajax/core-xhr.html: Missing definition for &lt;polymer-element>, please add the following HTML import at the top of this file: &lt;link rel="import" href="../../../../packages/polymer/polymer.html">. See http://goo.gl/5HPeuP#polymer_3 for details.<br />&lt;polymer-element name="core-xhr" hidden><br />^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br />Done<br /></pre>I am unsure of those warnings, but I give it a try anyway. In my Polymer.dart element, I replace last night's bower_components attempt:<pre class=prettyprint>&lt;link rel="import" href="../../../packages/polymer/polymer.html"><br /><b>&lt;link rel="import"<br />      href="../bower_components/apply-author-styles/apply-author-styles.html"></b><br />&lt;polymer-element name="pricing-plan"><br />  &lt;template>&lt;-- ... -->&lt;/template><br />  &lt;script type="application/dart" src="pricing_plan.dart">&lt;/script><br />&lt;/polymer-element></pre>Using instead the custom_element_apigen element:<pre class=prettyprint>&lt;link rel="import" href="../../../packages/polymer/polymer.html"><br /><b>&lt;link rel="import"<br />      href="../apply_author_styles.html"></b><br />&lt;polymer-element name="pricing-plan"><br />  &lt;template>&lt;!-- ... -->&lt;/template><br />  &lt;script type="application/dart" src="pricing_plan.dart">&lt;/script><br />&lt;/polymer-element><br /></pre>But, when I fire this up in Dartium, I still get:<pre class=prettyprint>GET http://localhost:8080/packages/bootstrap_example/core_ajax.html 404 (Not Found) </pre>It seems that I need to include core-ajax (and core-xhr) in the list of generated files:<pre class=prettyprint>files_to_generate:<br />  - apply-author-styles/apply-author-styles.html<br /><b>  - core-ajax/core-ajax.html<br />  - core-ajax/core-xhr.html</b></pre>After re-running <code>pub run custom_element_apigen:update apply_author_styles_gen.yaml</code>, I again try this in Dartium. Unfortunately, I have no more success this time:<pre class=prettyprint>Internal error: 'package:bootstrap_example/core_xhr.dart': error: line 33 pos 29: duplicate formal parameter 'inOptions'<br />  request(inOptions, String inOptions.url, String inOptions.method, bool inOptions.sync, inOptions.params, inOptions.body, inOptions.headers, String inOptions.responseType, bool inOptions.withCredentials, inOptions.callback) =><br />                            ^ </pre>Bleh. I think it safe to say that I understand why core-xhr in Dart is still hand-written in Dart instead of wrapped by custom_element_apigen. I will call it a night here. <br /><br />Although unsuccessful in getting apply-author-styles to work, it was nice to get a feel for what custom_element_apigen does. Hopefully in the near future it can also generate a Dart API for core-xhr.<br /><br /><br /><span style="color: #ccc">Day #201</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/10/bootstrap-css-with-polymer.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/10/testing-css-colors-in-polymer.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/zh8JGxRxyNY" height="1" width="1" alt=""/>
