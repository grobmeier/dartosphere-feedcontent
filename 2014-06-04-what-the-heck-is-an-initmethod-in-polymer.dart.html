---
title: 'What the Heck is an @initMethod (in Polymer.dart)?'
layout: post
published: '2014-06-04T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/rdx8thctDkA/what-heck-is-initmethod-in-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />While mucking around in 0.9 <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>, I was surprised that the <code>@initMethod</code> annotation seemed to have some effect on the code. I had thought it was a 0.10 pre-release annotation that helped Polymer.dart determine code isolates in which to run Polymer-related codeâ€”in particular which methods were main entry points. <br /><br />I never did figure out what <code>@initMethod</code> did in 0.9 and I am unsure what it does now that 0.10 is here and has dropped some of the isolate-related features. So tonight I set out to figure out what <code>@initMethod</code> does and if I need to be aware of it in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>.<br /><br />Digging through the source code in the book repository, I find that I did use the <code>@initPolymer</code> annotation on some Polymer code that needed a <code>main()</code> entry point in addition to Polymer initialization. This was 0.10 pre-release code, so it loaded the Polymer library differently and initialized Polymer differently. I had to place the <code>@initMethod</code> annotation on the <code>main()</code> entry point to get Polymer to invoke it during the initialization process:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><b>@initMethod</b><br />main() {<br />  // Code here...<br />}</pre>In this pre-release, I did not have to invoke <code>initPolymer()</code> but that is back now that official Polymer.dart 0.10 is here. So what does the <code>@initMethod</code> annotation do in official 0.10? Throw an exception apparently.<br /><br />If I add <code>initPolymer()</code> to the <code>main()</code> entry point:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />@initMethod<br />main() {<br /><b>  initPolymer();</b><br />  // ...<br />}</pre>Then reload in Dartium, I get an exception:<pre class=prettyprint>Exception: Initialization was already done.</pre>I am not certain where that exception is actually thrown (the debug version of Dartium <a href="https://code.google.com/p/dart/issues/detail?id=18977">has gone missing</a>), but removing the <code>@initMethod</code> annotation eliminates the exception and, if I have setup my page correctly:<pre class=prettyprint>&lt;!DOCTYPE html><br />&lt;html lang="en"><br />  &lt;head><br /><b>    &lt;link rel="import" href="packages/polymer/polymer.html"><br />    &lt;link rel="import" href="packages/changes_from_outside/elements/hello-you.html"><br />    &lt;script type="application/dart" src="main.dart">&lt;/script></b><br />  &lt;/head><br />  &lt;body><br />    &lt;div class="container"><br />      &lt;hello-you>&lt;!-- ... -->&lt;/hello-you><br />    &lt;/div><br />  &lt;/body><br />&lt;/html><br /></pre>Then everything works including the code in the <code>main()</code> entry point and in the Polymer element.<br /><br />That is obviously not the right way to use <code>@initPolymer</code>, so what is? Well, I finally read the documentation, which states that <code>initPolymer()</code> will:<blockquote>...for each library included transitively from HTML and HTML imports, register custom elements declared there (labeled with <code>@CustomTag</code>) and invoke the initialization method on it (top-level functions annotated with <code>@initMethod</code>).</blockquote>That makes it seem like <code>@initMethod</code> will invoke a method defined in the actual Polymer code. So I give that a try:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><br /><b>@initMethod<br />bob() {<br />  print('Go talk to bob.');<br />}</b><br /><br />@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  // Normal Polymer code here...<br />}<br /></pre>And indeed that actually works. When I load my application, the code in the <code>main()</code> entry point continues to work as does the Polymer code. And if I check the console, I see:<br /><br /><a href="http://1.bp.blogspot.com/-ehgkZtVjy5c/U4_qJrI09lI/AAAAAAAAaPY/40TrFNH8U2o/s1600/01-go_talk_to_bob.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-ehgkZtVjy5c/U4_qJrI09lI/AAAAAAAAaPY/40TrFNH8U2o/s640/01-go_talk_to_bob.png" /></a><br /><br />So it seems that <code>@initMethod</code> can be used for some register-time code evaluation. I am unsure if this is meant for external custom element authors or just something for internal Polymer.dart authors. I am also unsure if the meaning will end up changing in the future. Still, it seems like something that might come in pretty handy. <br /><br /><br /><span style="color: #ccc">Day #84</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/06/polymerdart-best-in-javascript.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/rdx8thctDkA" height="1" width="1"/>
