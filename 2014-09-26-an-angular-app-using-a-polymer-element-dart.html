---
title: 'An Angular App Using a Polymer Element (Dart)'
layout: post
published: '2014-09-26T23:58:00-04:00'
feed: 'japh(r) by Chris Strom'
link: //feedproxy.google.com/~r/JaphrByChrisStrom/~3/YVu3N1-d6QE/an-angular-app-using-polymer-element.html
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - angular
    - chain
    - dart
    - 'dart pub'
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />Thanks to a tip from <a href="https://plus.google.com/+JamesHurford">James Hurford</a>, I have a far better approach to working with the “wildly” incompatible <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> and <a href="https://github.com/angular/angular.dart">Angular.dart</a> libraries. Instead of hacking on a forked version of Angular.dart, as I did last night, I instead use <a href="http://pub.dartlang.org/">Dart Pub</a>'s <code>dependency_overrides</code> option. <br /><br />I am simply not going to start hacking on Angular.dart to get Polymer elements working inside an Angular.dart application—especially not as a solution for <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>. Overriding the minimal dependencies found from last night gives me the best chance of working with the most recent Polymer and Angular libraries to see if it is as all possible.<br /><br />So I add those dependencies to my project's <code>pubspec.yaml</code>:<pre class=prettyprint>name: angular_example<br />dependencies:<br />  angular: any<br />  polymer: any<br />  angular_node_bind: any<br /><b>dependency_overrides:<br />  args: '>=0.10.0 &lt;0.12.0'<br />  code_transformers: '>=0.1.4+2 &lt;0.3.0'<br />  html5lib: '>=0.10.0 &lt;0.13.0'</b><br />dev_dependencies:<br />  unittest: any<br />transformers:<br />- polymer:<br />    entry_points:<br />    - web/index.html<br />    - test/index.html</pre>I delete my <code>pubspec.lock</code> to be absolutely sure that I am getting a fresh run at this (a <code>pub upgrade</code> should do the same thing). Now when I run <code>pub get</code>, I find:<pre class=prettyprint>$ pub install<br />...<br />+ angular 0.14.0<br />...<br />+ polymer 0.15.0<br />...<br />Warning: You are using these overridden dependencies:<br />! args 0.11.0+1 (0.12.0+2 available)<br />! code_transformers 0.2.3+1<br />! html5lib 0.12.0<br /></pre>For reference, Angular.dart would otherwise restrict those three overridden dependencies as:<pre class=prettyprint><code>  args: '>=0.10.0 &lt;0.11.0'<br />  code_transformers: '>=0.1.4+2 &lt;0.2.0'<br />  html5lib: '>=0.10.0 &lt;0.11.0'</code></pre>OK, I have the <a href="http://dartlang.org">Dart</a> versions of Polymer and Angular installed in the same application. Now what? <br /><br />Well, for tonight, I would be satisfied with a working version of the old Angular pizza building application that uses a custom Polymer element. This worked when it went into <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>. Hopefully it can live again.<br /><br />I modify the Polymer setup as I know that version 0.15 likes it and retain the Angular tags and attributes:<pre class=prettyprint>&lt;!doctype html><br /><b>&lt;html ng-app lang="en"></b><br />  &lt;head><br /><b>    &lt;script src="packages/web_components/platform.js">&lt;/script><br />    &lt;link rel="import" href="packages/angular_example/elements/x-pizza.html"><br />    &lt;script type="application/dart" src="main.dart">&lt;/script></b><br />  &lt;/head><br />  &lt;body><br />    &lt;div class="container"><br />      &lt;h1>Ye Olde Dart Pizza Shoppe&lt;/h1><br /><b>      &lt;ng-view>&lt;/ng-view></b><br />    &lt;/div><br />  &lt;/body><br />&lt;/html></pre>Aside from the <code>ng-app</code> Angular attribute and the <code>&lt;ng-view></code> Angular tag, there is one other difference between this and a pure Polymer application: there is no export of <code>package:polymer/init.dart</code> to initialize Polymer. Instead that is done inside <code>main.dart</code>, which also initialized Angular. <br /><br />At least it used to initialize Angular. Now it just generates errors in the <a href="http://www.dartlang.org/dartium/">Dartium</a> console:<pre class=prettyprint>Exception: No top-level method 'ngBootstrap' declared.<br /><br />NoSuchMethodError: method not found: 'ngBootstrap'<br />Receiver: top-level<br />Arguments: [...] </pre>No biggie. It seems that the Angular bootstrap process has changed. For now, I leave the initialization inside Polymer's <code>run()</code>:<pre class=prettyprint>main() {<br />  initPolymer().run((){<br /><b>    applicationFactory()<br />      .addModule(new PizzaStoreApp())<br />      .run();</b><br />  });<br />}</pre>No doubt other stuff has changed, but I start with the old constructor for <code>PizzaStoreApp</code> and will work my way from there. What I find next is:<pre class=prettyprint>Exception: Module.DEFAULT_REFLECTOR not initialized for dependency injection.http://goo.gl/XFXx9G</pre>This appears to be due to the lack of the Angular transformer in my pubspec.yaml. Despite what the documentation says, it would appear that this does more than aid building JavaScript. I add the Angular transformer:<pre class=prettyprint>name: angular_example<br />dependencies:<br />  angular: any<br />  polymer: any<br />  angular_node_bind: any<br />dependency_overrides:<br />  args: '>=0.10.0 <0.12.0'<br />  code_transformers: '>=0.1.4+2 <0.3.0'<br />  html5lib: '>=0.10.0 <0.13.0'<br />dev_dependencies:<br />  unittest: any<br />transformers:<br /><b>- angular</b><br />- polymer:<br />    entry_points:<br />    - web/index.html<br />    - test/index.html</pre>After a <code>pub serve</code> restart, there is much work to perform to update the Angular portion of my application to 0.14. But I eventually get it. <br /><br />The application is intentionally “complex-ish” to ensure that I am not just getting by with a trivial example. Mostly this involves routing. <br /><br />The <code>main.dart</code> file for my Angular &amp; Polymer application starts with the usual imports for both libraries:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'package:angular/angular.dart';<br />import 'package:angular/application_factory.dart';<br />import 'package:angular/routing/module.dart';</pre>There used to be much initialization inside the main application module. Now it is just:<pre class=prettyprint>class PizzaStoreApp extends Module {<br />  PizzaStoreApp() {<br />    // Stuff used to happen here, now routing and binding happens later...<br />  }<br />}</pre>I am unsure if I even need this anymore, but I will answer than another day.<br /><br />The routing uses two partials, defined as:<pre class=prettyprint>void storeRouteInitializer(Router router, RouteViewFactory views) {<br />  views.configure({<br />    'start': ngRoute(<br />        defaultRoute: true,<br />        view: 'partials/home.html'<br />      ),<br />    'custom-pizza': ngRoute(<br />        path: '/pizza/custom',<br />        view: 'partials/custom.html'<br />      )<br />  });<br />}</pre>That is relatively self-explanatory. I have two routes: the default route and the custom pizza route. Both use partial templates at the specified locations.<br /><br />Finally, the Polymer and Angular initialization looks like:<pre class=prettyprint>main() {<br />  initPolymer().run((){<br /><b>    var app = new PizzaStoreApp()<br />      ..bind(NgRoutingUsePushState, toValue: new NgRoutingUsePushState.value(false))<br />      ..bind(RouteInitializerFn, toValue: storeRouteInitializer);<br /><br />    applicationFactory()<br />      .addModule(app)<br />      .run();</b><br />  });<br />}</pre>It took a little time to figure out where the <code>bind()</code> calls go and what gets supplied to <code>addModule()</code>, but it mostly makes sense. What took me quite a while to figure out was how to disable push state. I really hate push state—especially for developing / reloading single page applications. But eventually I figured out how to bind the <code>false</code> value of <code>NgRouteingUsePushState</code>. There may be a cleaner way to accomplish this, but I am not going to worry about that now. <br /><br />Because I have an Angular.dart 0.14 + Polymer.dart 0.15 application working:<br /><br /><a href="http://2.bp.blogspot.com/-gz5PoxRF_4Y/VCY0-tqaGwI/AAAAAAAAfkU/7tTQFew3NG4/s1600/01-angular_polymer_dart_working_again.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-gz5PoxRF_4Y/VCY0-tqaGwI/AAAAAAAAfkU/7tTQFew3NG4/s400/01-angular_polymer_dart_working_again.png" /></a><p>Well, not <i>quite</i> working. I still need to double bind variables in Angular to Polymer attributes. But I am thrilled to have gotten this far tonight.</p><br /><span style="color: #ccc">Day #195</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/09/polymer-and-angular-dart-are-wildly.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/09/binding-variables-between-angular-and.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/YVu3N1-d6QE" height="1" width="1" alt=""/>
