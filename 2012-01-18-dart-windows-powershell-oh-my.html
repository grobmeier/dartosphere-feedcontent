---
title: 'Dart, Windows, Powershell, Oh My!'
layout: post
published: '2012-01-18T09:28:00-06:00'
feed: 'phylotic connections'
link: 'http://phylotic.blogspot.com/2012/01/dart-windows-powershell-oh-my.html'
author:
    name: 'John Evans'
    email: noreply@blogger.com
    url: 'https://plus.google.com/115427174005651655317'
tags:
    - dart
    - dartlang
    - frogc
    - powershell
    - scripting
    - windows

---

I’ve been working with the <a href="http://gsdview.appspot.com/dart-editor-archive-continuous/latest/" target="_blank">Dart SDK</a> on Windows for just over a week now and I thought I would share a couple tips for working with Dart in the Windows environment.<br /><br />I can’t guarantee any of this will work on your setup, Windows being what it is, but I hope you find it useful.<br /><br /><span style="font-size: large;">My Windows Setup</span><br />Windows 7 Ultimate 64-bit<br /><br /><span style="font-size: large;">Keeping Dart Up-To-Date</span><br />On my Ubuntu build, I was able to quickly whip up a script to download and update the Dart Editor and SDK for me.&nbsp; I wanted that same functionality on Windows, which meant a foray into new territory for me:&nbsp; Powershell.<br /><br />After much Googlery, I was able to come up with a brute-force Powershell script that:<br /><ol><li>Backs up the current SDK and Editor into corresponding “previous” directories.  </li><li>Downloads the Editor and SDK zip files from the continuous integration Dart repository.  </li><li>Unzips the Editor and SDK into the corresponding “latest” directories.</li></ol>There are some pre-requisites:<br /><br /><b>7zip must reside somewhere in your PATH and must be named ‘sz.exe’ (I had trouble with Powershell executing it when it was named ‘7z.exe’, so I just made a copy of it called 'sz.exe')</b><br /><br /><b>In your “Dart” directory, you must have the following sub-directories created:</b><br /><ul><li><b>sdk_latest  </b></li><li><b>sdk_previous  </b></li><li><b>editor_latest  </b></li><li><b>editor_previous</b></li></ul>You can change the names of these directories in the script if you like. Here is the script:<br /><div><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;"><span style="color: green;"># download and update dart environment</span><br /><br /><span style="color: green;"># vars</span><br />$dpath = <span style="color: #006080;">'d:\development\dart'</span> <span style="color: green;"># path to dart environment root</span><br />$sdk = <span style="color: #006080;">'sdk_latest'</span>            <span style="color: green;"># directory where the current dart sdk will reside</span><br />$sdkp = <span style="color: #006080;">'sdk_previous'</span>         <span style="color: green;"># directory where the previous dard sdk will reside</span><br />$editor = <span style="color: #006080;">'editor_latest'</span>      <span style="color: green;"># directory where the current dart editor will reside</span><br />$editorp = <span style="color: #006080;">'editor_previous'</span>   <span style="color: green;"># directory where the previous dart editor will reside</span><br /><br /><span style="color: green;"># Dart CI repository</span><br />$dartrepo = <span style="color: #006080;">'http://gsdview.appspot.com/dart-editor-archive-continuous/latest/'</span><br /><br /><span style="color: green;"># CI SDK and Editor file names</span><br />$sdkfile = <span style="color: #006080;">'dart-win32.zip'</span><br /><br /><span style="color: green;"># *** ALERT! *** Set for win32 editor if you aren't using 64-bit!</span><br />$editorfile = <span style="color: #006080;">'DartBuild-win32.win32.x86_64.zip'</span><br /><br /><span style="color: green;"># get a reference to a new web client</span><br />$wc = new-object System.Net.WebClient<br /><br />write-host <span style="color: #006080;">'*** Updating Dart Environment'</span> -foregroundColor Yellow<br /><br /><span style="color: blue;">function</span> dobackup ([string]$s, [string]$d){<br />    <br />    <span style="color: green;"># remove destination directory files</span><br />    rm $d\* -Recurse<br />    <br />    <span style="color: green;"># copy source files to destination</span><br />    copy $s\* $d -Recurse;<br />    <br />    <span style="color: green;"># remove source directory files</span><br />    rm $s\* -Recurse<br />}<br /><br /><span style="color: blue;">function</span> download ([string]$f, [string]$d) {<br />    $wc.DownloadFile($dartrepo+$f,$d);<br />}<br /><br />write-host <span style="color: #006080;">'... Backing up SDK'</span><br />dobackup $dpath\$sdk $dpath\$sdkp;<br /><br />write-host <span style="color: #006080;">'... Backing up Editor'</span><br />dobackup $dpath\$editor $dpath\$editorp;<br /><br />write-host <span style="color: #006080;">'... Downloading SDK'</span><br />download $sdkfile $dpath\$sdk\$sdkfile<br /><br />write-host <span style="color: #006080;">'... Downloading Editor'</span><br />download $editorfile $dpath\$editor\$editorfile<br /><br />write-host <span style="color: #006080;">'... Extracting SDK files'</span><br />set-location $dpath\$sdk | out-null<br />sz.exe x -y $sdkfile | out-null<br /><br />write-host <span style="color: #006080;">'... Extracting Dart Editor files'</span><br />set-location $dpath\$editor | out-null<br />sz.exe x -y $editorfile | out-null<br /><br />set-location $dpath | out-null<br />write-host <span style="color: #006080;">'*** Finished ***'</span> -foregroundColor Yellow</pre></div><br />(I called this one ‘updatedart.ps1’)<br /><br /><div><span style="font-size: large;">Compiling With Frog</span></div>If you’re developing a non-trivial application with Dart, chances are that you’re also compiling with frog instead of the dartc compiler that is currently used by Dart Editor.&nbsp; Now, <a href="https://groups.google.com/a/dartlang.org/forum/#!topic/misc/BHTM6xtXN2c" target="_blank">there is a way to get frog to work in the Editor via a configuration script</a>, but I’ve yet to get it working on the windows version.&nbsp; That leaves me with the requirement to compile form the command line. &nbsp;I use a powershell script to make this a bit easier.&nbsp; Again, I’m sure this script could be improved, but I’m a Powershell n00b:<br /><br /><div><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;"><span style="color: green;"># compile a dart project from anywhere</span><br /><br /><span style="color: blue;">param</span>([string]$dartfile = <span style="color: #006080;">""</span>)<br /><br /><span style="color: blue;">if</span> (!$dartfile)<br />{<br />    <span style="color: blue;">return</span> <span style="color: #006080;">"Missing dart file parameter"</span>;<br />}<br /><br />$curdir = [Environment]::CurrentDirectory=(Get-Location -PSProvider FileSystem).ProviderPath<br /><br /><span style="color: green;"># Adjust this to wherever your dart sdk installation is</span><br />$dartpath = <span style="color: #006080;">"d:\development\dart\sdk_latest\dart-sdk\bin"</span><br /><br /><span style="color: green;">#remove an existing js file</span><br />rm *.js<br /><br />write-host <span style="color: #006080;">'Compiling Dart Application'</span><br />set-location $dartpath | out-null<br /><br />$fullstring = <span style="color: #006080;">"--out="</span> + $curdir + <span style="color: #006080;">"\" + $dartfile + "</span>.app.js <span style="color: #006080;">" + $curdir + "</span>\<span style="color: #006080;">" + $dartfile<br /><br />$file = $curdir + "</span>\<span style="color: #006080;">" + $dartfile<br />$output = $dartfile + "</span>.js<span style="color: #006080;">"<br />$renamed = $dartfile + "</span>.app.js"<br /><br />.\frogc.bat $file<br />set-location $curdir | out-null<br />ren $output $renamed </pre></div><br /><div>I called this script “cdart.ps1” and made a powershell alias to it called “cdart”.&nbsp; So compiling a dart app in Powershell looks like this:</div><br /><div><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">cdart mydartapp.dart</pre><br /></div>I hope you find these two tips useful when working with Dart in the windows environment.</div>
