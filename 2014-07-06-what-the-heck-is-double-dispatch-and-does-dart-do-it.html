---
title: 'What the Heck is Double Dispatch? And Does Dart Do It?'
layout: post
published: '2014-07-06T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/UK9eSXMIGmM/what-heck-is-double-dispatch-and-does.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - 'double dispatch'
    - 'visitor pattern'

---

<div class=top-chain-links></div><br />I have crazy gaps in my knowledge.<br /><br />I have posted more than 1600 blog posts each of which answers a question that I could not answer when I started. One might think that I know a lot by know. Maybe I do, but there are still some crazy gaps in my knowledge. This is why I love programming.<br /><br />Tonight, I would like to be able to answer what double dispatch means in object oriented methods. Having read the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four book</a>, I think I might already be able to provide an acceptable answer. One of the more important lessons that I have learned 1600+ posts is that there is a world of difference between the ability to give an answer and the ability to teach an answer.<br /><br />The answer that I would give at the outset of this little exercise to what is double dispatch would be a method that gets invoked based on two objects and one method. At the risk of further illustrating exactly how weird the gaps in my knowledge are, I would clarify that with a bit of Smalltalk terminology by saying that the method to be executed is resolved based on two receivers that receive a single message—the method being called.<br /><br />Normally, a method is resolved by the type of the receiver and the message being sent to it. If I call <code>my_list.join('\n')</code>, I am sending the <code>join</code> message to an object of type <code>List</code> (the message is sent with a single argument that tells the receiver to join with newlines). In this case, I would expect to find the <code>join()</code> method defined in the <code>List</code> class.<br /><br />I know from my studying of the <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> that it relies on double dispatch in order to accomplish its purpose—an object that can operate on a data structure without changing the data structure. Let's see if I can work through my rote answer to internalize it...<br /><br />I am still working with an inventory data structure. My work stuff inventory included a mobile, tablet, and laptop:<pre class=prettyprint><code>  var work_stuff = new InventoryCollection([<br />    new Mobile()<br />      ..apps = [<br />          app('2048', price: 10.0),<br />          app('Pixel Dungeon', price: 7.0),<br />          app('Monument Valley', price: 4.0)<br />        ],<br />    new Tablet()<br />      ..apps = [<br />          app('Angry Birds Tablet Platinum Edition', price: 1000.0)<br />        ],<br />    new Laptop()<br />  ]);</code></pre>Normally if I were to call a method on <code>work_stuff</code>, I would look inside <code>InventoryCollection</code> to find the method definition. I might print the names of all of the top-level items in my collection with:<pre class=prettyprint><code>  print(work_stuff.names());</code></pre>And I could find the full definition of what occurs by looking in the <code>InventoryCollection</code> class:<pre class=prettyprint>class InventoryCollection {<br />  List&lt;Inventory> stuff = [];<br />  InventoryCollection(this.stuff);<br /><br /><b>  String names() =><br />    stuff.map((i) => i.name).join('\n');</b><br /><br />  void accept(visitor) {<br />    stuff.forEach((thing) { thing.accept(visitor); });<br />  }<br />}</pre>But, if I invoke the <code>accept()</code> method in the same class, then I cannot find the <i>ultimate</i> method definition of the method called in <code>InventoryCollection</code>. I cannot even find it on one of the components of the collection like <code>Laptop</code>:<pre class=prettyprint>class Laptop extends Equipment {<br />  Laptop(): super('Laptop');<br />  double netPrice = 1000.00;<br />  double discountPrice() => netPrice * .9;<br /><b>  void accept(visitor) { visitor.visitLaptop(this); }</b><br />}</pre>It turns around and invokes the <code>visitLaptop()</code> method in the <code>accept()</code> method call:<pre class=prettyprint><code>  var cost = new PricingVisitor();<br /><b>  work_stuff.accept(cost);</b><br />  print('Cost of work stuff: ${cost.totalPrice}.');</code></pre>There are two receivers along the way, but it starts with a single dispatch with the object structure receiving the <code>accept</code> message. That message comes along with the cost visitor as a single argument. Once inside the <code>accept()</code> method of a node, then the visitor is sent a message—in this case <code>visitLaptop</code>.<br /><br />So even though the initial method call looks like a plain-old single dispatch, it turns into a double dispatch. It does so by virtue of two different receivers being sent a message. The combination of the two receivers being sent method messages in response to one method call is the result. Taking that further, multiple dispatch would involve more objects receiving a message in response to a single initial method being sent.<br /><br />I begin to internalize this concept. I still do not quite think that I have the ability to teach it, but hopefully this exercise combined with additional work on this pattern (and other code) will help me get there. Of course, how much I need to teach this in <a href="http://designpatternsindart.com/">Design Patterns in Dart</a> is an open question. The GoF discussed it, but not in sufficient depth for me to fully understand. Maybe that is enough for most of my readers, however.  Food for future thought.<br /><br /><br /><span style="color: #ccc">Day #114</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/07/visitor-with-little-composite-in-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/UK9eSXMIGmM" height="1" width="1"/>
