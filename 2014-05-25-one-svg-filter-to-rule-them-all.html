---
title: 'One SVG Filter to Rule Them All'
layout: post
published: '2014-05-25T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/TCT_zRN3jls/one-svg-filter-to-rule-them-all.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg

---

<div class=top-chain-links></div><br />I have my SVG-based <a href="http://www.polymer-project.org/">Polymer</a> custom element in happy shape at this point. The <code>&lt;x-pizza></code> element is in nice code shape and, more importantly, building pizzas for hungry customers:<br /><br /><a href="http://2.bp.blogspot.com/-XCRjn8R2Ca0/U4KKr-z2lPI/AAAAAAAAZxU/iX6Ot-KWe2A/s1600/03-x_pizza_with_svg_images.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-XCRjn8R2Ca0/U4KKr-z2lPI/AAAAAAAAZxU/iX6Ot-KWe2A/s320/03-x_pizza_with_svg_images.png" /></a><br /><br />It is composed of several different SVG files, each loaded with <code>&lt;polymer-ajax></code> for simplicity and ease of dynamic manipulation. It took some tinkering, but I finally have the drop shadow for the individual toppings animating on mouse over:<br /><br /><a href="http://3.bp.blogspot.com/-174VgIrRZMA/U4KKdXKUxdI/AAAAAAAAZxM/Dj7XoF3a9zo/s1600/05-effect_in_action.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-174VgIrRZMA/U4KKdXKUxdI/AAAAAAAAZxM/Dj7XoF3a9zo/s400/05-effect_in_action.png" /></a><br /><br />The drop shadow pain was due to vagaries of SVG, but it proved that the <code>&lt;polymer-ajax></code> solution to loading other SVG assets (pizza toppings in this case) into a primary SVG worked and could still be effectively manipulated. I would like to build on that idea tonight by adding drop shadows to each of my toppingsâ€”not just the current pepperonis. <br /><br />I could work through each topping in turn with Inkscape, defining a second layer in each that holds the topping a little higher and with a drop shadow, but that seems like tedious work. Hopefully a little Dart can solve the problem without any Inkscape time.<br /><br />I start by pulling the drop shadow filter definition out of the only topping SVG that currently has it, <code>pepperoni.svg</code>, and placing it in the background SVG of the blank pizza:<pre class=prettyprint>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?><br />&lt;!-- Created with Inkscape (http://www.inkscape.org/) --><br />&lt;svg<br />   xmlns:svg="http://www.w3.org/2000/svg"<br />   xmlns="http://www.w3.org/2000/svg"<br />   version="1.1"<br />   width="300"<br />   height="300"><br />  &lt;defs><br />    &lt;filter<br />       color-interpolation-filters="sRGB"<br />       height="2.0"<br />       width="1.5"<br />       y="-0.2"<br /><b>       id="topping-drop-shadow"></b><br />      &lt;!-- lots and lots of filters... --> <br />    &lt;/filter><br />  &lt;/defs><br />  &lt;path<br />     d="m 300,150 a 150,150 0 1 1 -300,0 150,150 0 1 1 300,0 z"<br />     id="path3755"<br />     style="fill:#c8b7b7;fill-opacity:1;stroke:none" /><br />  &lt;path<br />     d="m 280,150 a 130,130 0 1 1 -260,0 130,130 0 1 1 260,0 z"<br />     id="path3759"<br />     style="fill:#c83737;fill-opacity:1;stroke:none" /><br />  &lt;path<br />     d="m 270,150 a 120,120 0 1 1 -240,0 120,120 0 1 1 240,0 z"<br />     id="path3761"<br />     style="fill:#ffe6d5;fill-opacity:1;stroke:none" /><br />&lt;/svg></pre>The only change that I make to the filter is the ID, which I now call <code>topping-drop-shadow</code> for code maintainability and readability. Since I append toppings to this base SVG image, the hope is that the drop shadow filter will continue to work with the topping SVG assets. Starting with <code>pepperoni.svg</code>, I give it a try:<pre class=prettyprint>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?><br />&lt;!-- Created with Inkscape (http://www.inkscape.org/) --><br />&lt;svg<br />   xmlns:svg="http://www.w3.org/2000/svg"<br />   xmlns="http://www.w3.org/2000/svg"<br />   version="1.1"<br />   width="32"<br />   height="32"><br />  &lt;g id="down" style="display: inline"><br />    &lt;path<br />       d="M 22,12 A 10,10 0 1 1 2,12 10,10 0 1 1 22,12 z"<br />       transform="translate(2.8577037,1.6074583)"<br />       style="fill:#d40000;fill-opacity:1;stroke:#000000;stroke-width:1.5;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /><br />  &lt;/g><br /><b>  &lt;g id="up" style="display: none"><br />    &lt;path<br />       d="M 22,12 A 10,10 0 1 1 2,12 10,10 0 1 1 22,12 z"<br />       style="fill:#d40000;fill-opacity:1;stroke:#000000;stroke-width:1.5;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;filter:url(#topping-drop-shadow)" /></b><br />  &lt;/g><br />&lt;/svg></pre>Happily that does still work.<br /><br />Since it works on one, the hopefully the filter can work on all of my elements. While I am at it, I would like to switch from hiding/showing layers in my SVG to translating a single layer in each topping SVG. So, I remove the group layers in <code>pepperoni.svg</code> which now becomes:<pre class=prettyprint>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?><br />&lt;!-- Created with Inkscape (http://www.inkscape.org/) --><br />&lt;svg<br />   xmlns:svg="http://www.w3.org/2000/svg"<br />   xmlns="http://www.w3.org/2000/svg"<br />   version="1.1"<br />   width="32"<br />   height="32"><br />  &lt;path<br />      d="M 22,12 A 10,10 0 1 1 2,12 10,10 0 1 1 22,12 z"<br />      style="fill:#d40000;fill-opacity:1;stroke:#000000;stroke-width:1.5;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /><br />&lt;/svg></pre>That is much, much smaller without the filter definition and the layers.<br /><br />Now I can eliminate the layer code that had supported the pepperoni SVG:<pre class=prettyprint><code>  _svgPepperoni() {<br />    var svg = _svgImage('pepperoni');<br />    return svg<br />     ..onMouseOver.listen((e){<br />          svg.query('#up').style.display = '';<br />          svg.query('#down').style.display = 'none';<br />        })<br />      ..onMouseLeave.listen((e){<br />          svg.query('#up').style.display = 'none';<br />          svg.query('#down').style.display = '';<br />      });<br />  }</code></pre>Instead, the pepperoni now uses the same function as all of the other toppings:<pre class=prettyprint><code>  _svgPepperoni()   => _svgImage('pepperoni');<br />  _svgSausage()     => _svgImage('sausage');<br />  _svgGreenPepper() => _svgImage('green_pepper');</code></pre>Finally, the <code>_svgImage()</code> function now does translation <i>and</i> filter application when mouse events occur:<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br /><br />    var path = svg.query('path');<br />    var style = path.getAttribute('style');<br /><br />    return svg<br /><b>      ..onMouseOver.listen((e){<br />          path<br />            ..setAttribute('style', '$style;filter:url(#topping-drop-shadow)')<br />            ..setAttribute('transform', 'translate(-2.8577037,-1.6074583)');<br />        })</b><br />      ..onMouseLeave.listen((e){<br />          path<br />            ..setAttribute('style', style)<br />            ..setAttribute('transform', 'translate(0,0)');<br />      });<br />  }</code></pre>And that does the trick. I now get drop shadows for all of my toppings:<br /><br /><a href="http://2.bp.blogspot.com/-SXlCBkzLC6s/U4K9zV9i-wI/AAAAAAAAZxg/K8ahgYYRZyA/s1600/01-a_new_drop_shadow.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-SXlCBkzLC6s/U4K9zV9i-wI/AAAAAAAAZxg/K8ahgYYRZyA/s640/01-a_new_drop_shadow.png" /></a><br /><br />Well, that might not be 100% working. I still need to figure out how best to handle the drawing area clipping, but this is getting very close to good enough. I will pick back up with the clipping tomorrow.<br /><br /><br /><span style="color: #ccc">Day #74</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/inkscape-vs-browser-svg-filter.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/clipping-in-svg.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/TCT_zRN3jls" height="1" width="1"/>
