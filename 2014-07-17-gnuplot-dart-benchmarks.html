---
title: 'Gnuplot Dart Benchmarks'
layout: post
published: '2014-07-17T23:58:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/CTLkAALM6GI/gnuplot-dart-benchmarks.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - benchmarking
    - chain
    - dart
    - dartlang
    - gnuplot

---

<div class=top-chain-links></div><br />I am embracing the idea of benchmarking the solutions that I add to <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>. This early in the research, I am unsure if I will have a strong need for benchmarks. What I do know is that if I cannot make benchmarking easy, then I will almost certainly not use them.<br /><br />So tonight, I take a quick look at the last piece of my puzzle: visualization. After last night, I have a solution that can store the average run time of a single benchmark run against the number of loops to gather that data. The CSV output looks something like:<pre class=prettyprint>Loop_Size, Classic_Visitor_Pattern, Nodes_iterate_w/_single_dispatch, Visitor_Traverses<br />10, 122.4, 110.6, 117.5, <br />100, 118.5, 112.4, 117.6, <br />1000, 120.4, 112.4, 116.8, <br />10000, 148.6, 148.2, 117.9, <br />100000, 148.1, 148.7, 118.5, </pre>I can paste that data in a spreasheet to produce nice looking graphs like:<br /><br /><a href="http://3.bp.blogspot.com/-GVeCJisq2cA/U8dRyOUnQPI/AAAAAAAAdO0/Fu1Re-JHyX0/s1600/image+(3).png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-GVeCJisq2cA/U8dRyOUnQPI/AAAAAAAAdO0/Fu1Re-JHyX0/s640/image+(3).png" /></a><br /><br />But let's face it, if I have to open a spreadsheet every time that I want to look at my data, I am never going to do it. So unless I can find some way to quickly visualize that data, all of this would be for naught. Enter <a href="http://www.gnuplot.info/">gnuplot</a>.<br /><br />The preferred data format for gnuplot seems to be tab separated values, so I rework the row output in my Dart benchmark reporter to output tabs instead of commas:<pre class=prettyprint><code>    // ...<br /><b>    var row = '${loopSize}\t';</b><br />    implementations.forEach((implementation){<br />      var rec = records.firstWhere((r)=> r['name'] == implementation);<br /><b>      row += '${rec["averageScore"]}\t';</b><br />    });<br />    // ...</code></pre>The graph type that I want in this case is a clustered histogram culled from data. In gnuplot parlance, that translates as:<pre class=prettyprint>set style data histogram<br />set style histogram clustered</pre>I fiddle a bit with styles (and cull a few from Google / Stack Overflow) to settle on these settings:<pre class=prettyprint>set style fill solid border<br />set xtics rotate out<br />set key tmargin</pre>The fill style makes the bars a little easier to see and the other two make the data and legends easier to see. Finally, I plot the data as:<pre class=prettyprint>plot for [COL=2:4] 'bar.tsv' using COL:xticlabels(1) title columnheader</pre>Which results in:<br /><br /><a href="http://1.bp.blogspot.com/-Q59btq_c854/U8ibLvGApNI/AAAAAAAAdQo/xGHAVG2JbOM/s1600/bar.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-Q59btq_c854/U8ibLvGApNI/AAAAAAAAdQo/xGHAVG2JbOM/s400/bar.png" /></a><br /><br />That is quite nice for just a little bit of work. I do, however, note that this graph suffers from a pretty serious flaw—the same flaw from which my spreadsheet graph suffered unnoticed by me until now. The y-axis does not start at zero, which greatly exaggerates the discrepancies between my three implementations. To start the y-axis at zero, I use:<pre class=prettyprint>set yrange [0:]</pre>Now my graph looks like:<br /><br /><a href="http://1.bp.blogspot.com/-kSbibKV_5Ng/U8icvVWAw3I/AAAAAAAAdQ0/-5_k7efe-Mc/s1600/bar.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-kSbibKV_5Ng/U8icvVWAw3I/AAAAAAAAdQ0/-5_k7efe-Mc/s400/bar.png" /></a><br /><br />Now that I see the “jump” in values at the 10k loop size in that perspective, it does not seem nearly as worrisome. <br /><br />If I put that all in a gnuplot script file:<pre class=prettyprint># set terminal png size 1024,768<br /># set output  "bar.png"<br />set style data histogram<br />set style histogram clustered<br />set style fill solid border<br />set xtics rotate out<br />set key tmargin<br />set yrange [0:]<br />plot for [COL=2:4] 'bar.tsv' using COL:xticlabels(1) title columnheader<br />pause -1 "Hit any key to continue"<br /></pre>Then I can quickly see my benchmarking results whenever I need to. No excuses.<br /><br /><br /><span style="color: #ccc">Day #125</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/07/fun-with-dart-iterable.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/07/close-but-not-quite-visualizing-dart2js.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/CTLkAALM6GI" height="1" width="1"/>
