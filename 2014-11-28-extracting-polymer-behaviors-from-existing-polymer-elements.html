---
title: 'Extracting Polymer Behaviors from Existing Polymer Elements'
layout: post
published: '2014-11-28T23:59:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/gOK1NNPnecQ/extracting-polymer-behaviors-from.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - refactoring

---

<div class=top-chain-links></div><br />My hack to get <a href="http://www.polymer-project.org/">Polymer</a> elements working with native forms (breaking encapsulation and inserting hidden <code>&lt;input></code> elements into the containing document) is growing on me. It was fairly easy to implement as a proof of concept. It was nearly as easy to write a bunch of tests verifying that the 80% use-cases work. So tonight I push ahead.<br /><br />My normal next step while writing <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> would be to reimplement in the other language in which the book is written. In this case, since I have written the initial implementation in <a href="http://dartlang.org">Dart</a>, I would normally redo the implementation in JavaScript. If a solution works similarly as well in both languages, then I have some assurance that I have a solution that transcends languages—that it is a true pattern of the library. <br /><br />But that's not what I am going to do tonight. I can't help myself—I must refactor. I wrote a handful of tests describing how I'd like Polymer elements to behave when they are used as HTML form elements. Tests are a great way to verify that things do not break over time. That is a necessary, but boring, reason to test. More fun is refactoring. I have all of these tests describing how I expect my element to behave. Unless I have poor tests (always a possibility), these tests will pass no matter how I might rework the implementation.<br /><br />And the reimplementation that I hope to realize tonight is extracting this is-a-form-input behavior into a separate Polymer class that my custom Polymer elements can extend as subclasses.<br /><br />The core <code>&lt;input></code> tests that I would like to continue to pass tonight are:<pre class=prettyprint>PASS: &lt;x-pizza> acts like &lt;input> - value property is updated when internal state changes<br />PASS: &lt;x-pizza> acts like &lt;input> - value attribute is updated when internal state changes<br />PASS: &lt;x-pizza> acts like &lt;input> - containing form includes input with supplied name attribute<br />PASS: &lt;x-pizza> acts like &lt;input> - setting the name property updates the name attribute</pre>I should be able to pull all of last night's code out of the <code>&lt;x-pizza></code> element into <code>&lt;a-form-input></code> leaving <code>&lt;x-pizza></code> unchanged from when I began save for a new superclass:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><b>import 'a_form_input.dart';</b><br /><br />@CustomTag('x-pizza')<br />class XPizza <b>extends AFormInput</b> {<br />  // Code reverted back to original implementation<br />}</pre>That turns out to be quite easy to make happen. I define the <code>AFormInput</code> class as:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'dart:html';<br /><br />@CustomTag('a-form-input')<br />class AFormInput extends PolymerElement {<br />  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;<br /><br />  Element lightInput;<br /><br />  AFormInput.created(): super.created();<br /><br />  void attached() {<br />    super.attached();<br /><br />    lightInput = new HiddenInputElement();<br />    if (name != null) lightInput.name = name;<br />    parent.append(lightInput);<br />  }<br /><br />  void attributeChanged(String name, String oldValue, String newValue) {<br />    if (name == 'name') {<br />      lightInput.name = newValue;<br />    }<br />  }<br />}</pre>All of that code is a direct copy of the code from last night except for the <code>attached()</code> lifecycle method. Polymer calls this method when the custom element is attached to a live DOM. This was more complicated last night because <code>&lt;x-pizza></code> had to do some work when attached as did this is-a-form-input code. Now that this code is properly encapsulated, I no longer need to keep these different behaviors in separate methods. Thanks to proper class encapsulation, these behaviors are pushed back up to the direct methods applying them.<br /><br />Even better, my tests continue to pass:<pre class=prettyprint>PASS: &lt;x-pizza> acts like &lt;input> - value property is updated when internal state changes<br />PASS: &lt;x-pizza> acts like &lt;input> - value attribute is updated when internal state changes<br />PASS: &lt;x-pizza> acts like &lt;input> - containing form includes input with supplied name attribute<br />PASS: &lt;x-pizza> acts like &lt;input> - setting the name property updates the name attribute<br /></pre>Better still, is that my Polymer-is-a-form-input hack still works in live code:<br /><br /><a href="http://4.bp.blogspot.com/-NUNlhI7BMbA/VHlTrI4vHBI/AAAAAAAAhfo/2dYoCbVVs00/s1600/01-smoke_test_is_a_form_input.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-NUNlhI7BMbA/VHlTrI4vHBI/AAAAAAAAhfo/2dYoCbVVs00/s400/01-smoke_test_is_a_form_input.png" /></a><br /><br />Best of all is that I was absolutely certain that it would continue to work—thanks to the tests that I wrote last night. <br /><br /><br /><span style="color: #ccc">Day #8</span> <br /><br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/11/tdd-polymer-dart-form-element.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/gOK1NNPnecQ" height="1" width="1"/>
