---
title: 'Reading Files from STDIN in Dart'
layout: post
published: '2014-07-20T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/iDlTt0W6ZHE/reading-files-from-stdin-in-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - benchmarking
    - chain
    - dart
    - dartlang

---

<div class=top-chain-links></div><br />I need to read from STDIN on the command-line. Not just a single line, which seems to well understood in <a href="http://dartlang.org">Dart</a>, but from an entire file redirected into a Dart script.<br /><br />My benchmarking work has a life of its own now with several (sometimes competing) requirements. One of those requirements is that the code that actually produces the benchmark raw data cannot use <code>dart:io</code> for writing to files (because it also compiled to JavaScript which does not support <code>dart:io</code>). Given that, my benchmark results are sent to STDOUT and redirected to artifact files:<pre class=prettyprint><code>    ./tool/benchmark.dart --loop-size=$X \<br />        | tee -a $RESULTS_FILE</code></pre>Or, the JavaScript version:<pre class=prettyprint><code>    node ./tool/benchmark.dart.js --loop-size=$X \<br />        | tee -a $RESULTS_FILE</code></pre>That works great, mostly because Dart's <code>print()</code> sends its data to STDOUT regardless of whether or not it is being run the Dart VM or in Node.js after being put through <code>dart2js</code>.<br /><br />What I need now is a quick way to summarize the raw results that can work with either the Dart or JavaScript results. Up until now, I have hard-coded the current filename inside the summary script which is then run as:<pre class=prettyprint>./tool/summarize_results.dart > $SUMMARY_FILE</pre>The problem with that is twofold: I should not hard-code a filename like that and the artifact filenames should all be managed in the same location.<br /><br />I could send the filename into the <code>./tool/summarize_results.dart</code> as an argument. That would, in fact, require a minimal amount of change. But I have a slight preference to be consistent with shell file redirection—if STDOUT output is being redirected <i>to</i> a file, then my preference is to (at least support) reading <i>from</i> a file and piping into the script via STDIN.<br /><br />Fortunately, this is fairly easy with <code>dart:io</code>'s <code>stdin</code> top-level getter. It actually turns out to be very similar to the single-line-of-keyboard-input solutions that are already out there:<pre class=prettyprint>_readTotals() {<br />  var lines = [];<br /><br />  var line;<br /><b>  while ((line = stdin.readLineSync()) != null) {</b><br />    var fields = line.split('\t');<br />    lines.add({<br />      'name': fields[0],<br />      'score': fields[1],<br />      'loopSize': fields[2],<br />      'averageScore': fields[3]<br />    });<br />  }<br /><br />  return lines;<br />}</pre>The only real “trick” here is the null check at the end of the STDIN input stream. Pleasantly, that was easy to figure out since is it similar to many other languages implementation of STDIN processing.<br /><br /><br /><br /><span style="color: #ccc">Day #128</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/07/command-line-arguments-with-nodejs-and.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/iDlTt0W6ZHE" height="1" width="1"/>
