---
title: 'Dart Annotations Are No Longer Structured'
layout: post
published: '2014-05-07T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/g4UMvwtjjWI/dart-annotations-are-no-longer.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - annotations
    - chain
    - dart
    - dartlang

---

<div class=top-chain-links></div><br />I am down to the very last unaccounted code analysis warnings in the <a href="http://dart4hipsters.com/">Dart for Hipsters</a> source.<br /><br />Similar to the problems of the past few days, these manifest as unused imports in my <a href="http://dartlang.org">Dart</a> code:<pre class=prettyprint>Analyzing test.dart...<br />[hint] Unused import (/home/chris/repos/csdart/Book/code/classes/private.dart, line 4, col 8)<br />[hint] Unused import (/home/chris/repos/csdart/Book/code/primitives/types.dart, line 5, col 8)</pre>Both of these two warnings come from custom-coded annotations:<pre class=prettyprint>library private_snippet;<br /><br />import 'package:unittest/unittest.dart';<br /><b>import '../annotations.dart';</b><br />// ...</pre>And:<pre class=prettyprint>library types_snippet;<br /><br />import 'package:unittest/unittest.dart';<br />import 'dart:collection';<br /><b>import '../annotations.dart';</b><br />// ...</pre>I have already removed some instances of importing this <code>annotations.dart</code> library where it was not being used, but in both of these last two files, the annotations are being used:<pre class=prettyprint><code>      <b>@IntentionalError('Demonstrating no compiler or run error')</b><br />      String muppet = 'Piggy';<br />      muppet = 42;</code></pre>So what's the deal Dart? I am using these annotations, darn it.<br /><br />In the <code>annotations.dart</code> file, I define the <code>@IntentionalError</code> annotation as optionally accepting a note:<pre class=prettyprint>/// Use when intentionally causing an error.<br />///<br />///     @IntentionalError('Demo when semi-colon is omitted')<br />///     var foo = "bar"<br />class IntentionalError {<br />  final String note;<br />  const IntentionalError([this.note]);<br />}<br /></pre>I <a href="http://japhr.blogspot.com/2013/01/i-love-dart-annotations.html">originally introduced annotations</a> in the book's source code because <code>dartanalyzer</code> would include them in its output:<pre class=prettyprint>➜  classes git:(master) ✗ dart_analyzer test.dart<br />file:/home/chris/repos/csdart/Book/code/classes/private.dart:26:31: Field 'collection' has no setter<br /><b>    25:         @IntentionalError('Demonstrate non-existent setter call')</b><br />    26:         var collection = view.collection = new ComicsCollection();<br />                                      ~~~~~~~~~~</pre>Unfortunately this is no longer the case—<code>dartanalyzer</code> currently includes only the line number and error generated. Still, I like the idea of including structured annotations as a means of consistently annotating my code in a way that unstructured code comments cannot. Except even that no longer seems to apply. If I intentionally use an incorrect format for my <code>@IntentionalError</code> annotation:<pre class=prettyprint><code><b>      @IntentionalError(1, 2, 3, [4, 5], 'Demonstrating no compiler or run error')</b><br />      String muppet = 'Piggy';<br />      muppet = 42;</code></pre>Then <code>dartanalyzer</code> proceeds blissfully unaware of a problem. Even if I remove the <code>import</code> of the <code>annotations.dart</code> file and include the annotations class directly in my source file it has no effect. Annotation classes now seem to serve as little more than documentation for a code documentation tool.<br /><br />I am already grep-ignoring these intentional errors in my <code>test_runner.sh</code> Bash script, so this is not a huge loss. The unused library warnings annoy me though, so I will comment out the <code>import</code> for the time being. If nothing else, the commented <code>annotations.dart</code> will serve to point me in the direction of documentation for my annotations—even if nothing is enforcing the format.<br /><br />With that, I have all of my Dart for Hipsters tests passing, am ignoring only intentional and/or expected type errors, and have everything passing:<pre class=prettyprint>➜  code git:(master) ✗ ./test_runner.sh<br />#READY<br />CONSOLE MESSAGE: unittest-suite-wait-for-done<br />CONSOLE MESSAGE: PASS: [skeleton] the skeleton app returns OK<br />CONSOLE MESSAGE: PASS: [main] the app returns OK<br />CONSOLE MESSAGE: PASS: [main] populates the list<br />CONSOLE MESSAGE: PASS: [numbers] 2 + 2 = 4<br />...<br />CONSOLE MESSAGE: PASS: [canvas] player is drawn<br />CONSOLE MESSAGE:<br />CONSOLE MESSAGE: All 163 tests passed.<br />CONSOLE MESSAGE: unittest-suite-success<br /><br />Static type analysis...<br />Analyzing test.dart... <br /><br />Looks good!</pre>Satisfied, I call it a night. I may still investigate structured annotations in Dart in the context of code reflection (they are used to great effect in Angular.dart). Tomorrow.<br /><br /><b>Update:</b> Annotation imports (and annotations parameter signatures) DO work if the annotations appear before classes or methods/functions. In the above examples, I am using annotations in variable declarations. I <i>think</i> that should still work—that is, dartanalyzer should see those as legitimate annotations and recognize that they have been imported and/or have invalid parameters.<br /><br />Actually, this may be more a question of where annotations are allowed to be in Dart code (they were definitely allowed  above variable declarations at one point) and what, if anything dartanalyzer should do when annotations are placed in invalid locations.<br /><br /><span style="color: #ccc">Day #57</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/dart-is-much-saner-than-its-pre-alpha.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/reflecting-on-annotations.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/g4UMvwtjjWI" height="1" width="1"/>
