---
title: 'Dynamically load package contents with Dart''s new Resource class'
layout: post
published: '2015-08-18T16:37:00-07:00'
feed: 'Seth Ladd''s Blog'
link: 'http://feedproxy.google.com/~r/SethLaddsBlog/~3/F6g7TMTTQGg/dynamically-load-package-contents-with.html'
author:
    name: Anonymous
    email: noreply@blogger.com
    url: 'http://www.blogger.com/profile/13906800552603557213'

---

<b>tldr:</b> In Dart 1.12, you can now dynamically load the contents of files/assets from package dependencies. The new Resource class is currently implemented in the VM, with dart2js support coming in a future release.<br /><br /><div class="separator" style="clear: both; text-align: center;"><img border="0" height="480" src="http://2.bp.blogspot.com/-V4BCahYatsU/VdPBIvrnazI/AAAAAAABxCg/PZFJc5pglDk/s640/Untitled-1.png" width="640" /></div><br /><br /><span style="font-size: large;">Motivation</span><br /><br />Dart applications are rarely just a collection of .dart files from a single developer. Real-world Dart apps often include numerous package dependencies, which contain additional Dart libraries as well as assets such as images, configuration files, template files, and more. It's always been possible to import third-party libraries with Dart's package: URI scheme, however prior to Dart 1.12 it was not possible to access non-Dart files via package: URIs.<br /><br />For example, consider a tool such as <a href="http://stagehand.pub/">stagehand</a>, which generates new Dart projects such as web apps, server apps, pub packages, and more. The source of the new projects are stored as files and templates inside the stagehand package. Somehow, the stagehand tool needs to reference and load files from its packages. The contents of packages are addressable with package: URI scheme, but the Dart platform didn't provide a way to load those resources.<br /><br /><span style="font-size: large;">Hello, Resource!</span><br /><br />Enter the new <a href="https://api.dartlang.org/apidocs/channels/dev/dartdoc-viewer/dart:core.Resource">Resource class</a>, which first appeared in Dart 1.12. The Resource class performs a very special role: allow Dart code to, at runtime, identify and load a resource identified by a package: URI.<br /><br />Consider this simple package layout:<br /><br /><span style="font-family: Courier New, Courier, monospace;">resourcetest/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; pubspec.yaml</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; .packages</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; bin/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; main.dart</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; lib/</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; myresource.txt</span><br /><br />Here are the contents of main.dart:<br /><br /><span style="font-family: Courier New, Courier, monospace;">main() async {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; var myResource = new Resource('package:resourcetest/myresource.txt');</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; var resourceContents = await myResource.readAsString();</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; print(resourceContents);</span><br /><span style="font-family: Courier New, Courier, monospace;">}</span><br /><br />First, construct a new Resource with a package: URI. Of course, the Resource will only be able to load package: URIs from your application/script and dependencies declared in your pubspec.yaml file.<br /><br />Then, call readAsString(), which returns a Future containing the contents of the resource.<br /><br />That's it!<br /><br /><span style="font-size: large;">The Resource API</span><br /><br />There are a few ways to load the contents of a Resource instance.<br /><br /><span style="font-family: Courier New, Courier, monospace;">openRead() → Stream&lt;List&lt;int&gt;&gt;</span><br /><br />Read the resource content as a stream of bytes.<br /><br /><span style="font-family: Courier New, Courier, monospace;">readAsBytes() → Future&lt;List&lt;int&gt;&gt;</span><br /><br />Read the resource content.<br /><br /><span style="font-family: Courier New, Courier, monospace;">readAsString({Encoding encoding}) → Future&lt;String&gt;</span><br /><br />Read the resource content as a string.<br /><br />Technically, the Resource class can load any URI that it already knows how to load. For example, the Dart VM can load file: , http: , and package: URIs.<br /><br /><span style="font-size: large;">Things to consider</span><br /><br />As of Dart 1.12, only the Dart VM has implemented the Resource class. Support is planned for dart2js in a near-future release.<br /><br />The Resource class only works if your application is started with a valid way to resolve package: URIs. The Dart platform supports multiple ways to tell the runtimes and compilers where and how to resolve package: URIs, and under most circumstances, you don't need to do anything special.<br /><br />One of the following must be true, in order for the Dart runtime to be able to resolve the package: URIs:<br /><br /><br /><ul><li>run your Dart app after it was installed with pub global activate</li><li>run your Dart app with a --package=path/to/.packages</li><li>run your Dart app with a --package-root=path/to/packages/dir</li><li>run your Dart app's entry point next to the .packages file</li><li>run your Dart app's entry point next to the packages/ directory</li></ul><br /><br />Normally, everything is set up for you, because pub does a great job of ensuring your app has a .packages file. This is true even with apps installed with pub global activate!<br /><br /><span style="font-size: large;">Summary</span><br /><br />The new Resource class allows you to dynamically load the contents of package: URIs. You can use the new Resource class to load text or binary assets from within your app and your third-party dependencies.<br /><br /><a href="https://www.dartlang.org/downloads/archive/">Download a Dart 1.12-dev SDK</a> and enjoy the new Resource class. We look forward to your <a href="http://dartbug.com/">feedback</a>, and we can't wait to see what you build.<br /><div><br /></div><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/F6g7TMTTQGg" height="1" width="1" alt=""/>
