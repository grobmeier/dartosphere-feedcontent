---
title: 'Testing Polymer (Dart) Mixins'
layout: post
published: '2014-12-08T23:57:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/AH65FUejEx4/testing-polymer-dart-mixins.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />I need to improve my continuous integration solutions for <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>. I do not know that I necessarily need to include a chapter on it in the book, but I ought to at least be able to point to some solutions in my research notes. Especially since I have been asked about it multiple times this week alone.<br /><br />With that in mind, I first need to test my <code>AFormInputMixin</code> class from last night, which serves as mixin or baseclass for other <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> elements so that they can behave like native HTML form input elements. This turns out to be a little trickier than I had expected, but I'll get to that in a bit.<br /><br />I start with the usual Polymer.dart <code>test/index.html</code> entry point in this package's <code>pubspec.yaml</code> file:<pre class=prettyprint>name: a-form-input<br />author: "Chris Strom &lt;github@eeecomputes.com>"<br />description: "Polymer element that mimics a native &lt;form> input."<br />dependencies:<br />  polymer: any<br />dev_dependencies:<br />  unittest: any<br /><b>transformers:<br />- polymer:<br />    entry_points:<br />      - test/index.html</b></pre><br />The <code>test/index.html</code> page:<br /><pre class=prettyprint>&lt;!doctype html><br />&lt;html><br />&lt;head><br />  &lt;!-- Load component(s) --><br />  &lt;link rel="import" href="x-double.html"><br /><br />  &lt;!-- The actual tests --><br />  &lt;script type="application/dart" src="test.dart">&lt;/script><br />  &lt;script src="packages/unittest/test_controller.js">&lt;/script><br />&lt;/head><br />&lt;body><br />&lt;/body><br />&lt;/html></pre><br /><br />The test/test.dart file:<pre class=prettyprint>pollForDone(testCases);<br />library plain_old_forms_test;<br /><br />import 'package:unittest/unittest.dart';<br />import 'dart:html';<br />import 'dart:async';<br />import 'package:polymer/polymer.dart';<br /><br />main() {<br />  initPolymer();<br /><br />  var _el, _form, _container;<br />  group("AFormInputMixin mixed into &lt;x-double>", (){<br />    setUp((){<br />      _container = createElement('&lt;div>&lt;/div>');<br />      _form = createElement('&lt;form>&lt;/form>');<br />      _el = createElement('&lt;x-double>&lt;/x-double>');<br /><br />      _form.append(_el);<br />      _container.append(_form);<br />      document.body.append(_container);<br />    });<br /><br />    tearDown((){<br />      _container.remove();<br />    });<br /><br />    group('acts like &lt;input> -', (){<br />      setUp((){<br />        _el.name = 'my_field_name';<br />        _el.start = '21';<br /><br />        var completer = new Completer();<br />        _el.async(completer.complete);<br />        return completer.future;<br />      });<br /><br />      test('value property is updated when internal state changes', (){<br />        expect(_el.value, '42'); // Doubled by &lt;x-double><br />      });<br />      // ...<br />    });<br /><br />  });<br />}<br /></pre><br />To run this, I start by running some static type analysis with test/run.sh:<pre class=prettyprint>#!/bin/bash<br /><br /># Static type analysis<br />results=$(dartanalyzer lib/a_form_input.dart 2>&1)<br />echo "$results"<br />if [[ "$results" != *"No issues found"* ]]<br />then<br />    exit 1<br />fi<br />echo "Looks good!"<br />echo</pre>And then I try to run the actual tests with the standard <code>content_shell</code>:<pre class=prettyprint>#!/bin/bash<br /><br /># Static type analysis....<br /><br /><b># Run a set of Dart Unit tests<br />results=$(content_shell --dump-render-tree test/index.html)<br />echo -e "$results"</b><br /><br /># check to see if DumpRenderTree tests<br /># fails, since it always returns 0<br />if [[ "$results" == *"Some tests failed"* ]]<br />then<br />    exit 1<br />fi<br /><br />if [[ "$results" == *"Exception: "* ]]<br />then<br />    exit 1<br />fi<br /></pre>And here is where I run into problems. All of the tests pass when run from <code>pub serve</code>, but with content_shell, I get:<pre class=prettyprint>CONSOLE MESSAGE: warning: polymer.html not found.<br />CONSOLE WARNING: line 213: Error:<br /><br />www.polymer-project.org.<br /><br />CONSOLE WARNING: line 213: FAIL<br />CONSOLE ERROR: Exception: Bad state: polymer.js must be loaded before polymer.dart, please add &lt;link rel="import" href="packages/polymer/polymer.html"> to your &lt;head> before any Dart scripts. Alternatively you can get a different version of polymer.js by following the instructions at http://www.polymer-project.org</pre><br />Since I am mixing the solution in this package into another class, I seem to be running afoul of resource loading limitations and the lack of transformers being run on local resources. So I have to borrow my solution for testing ajax resources by starting a pub server in the test:<pre class=prettyprint>#!/bin/bash<br /><br /># Static type analysis....<br /><br /><b>pub serve &<br />pub_pid=$!<br /><br /># Wait for server to build elements and spin up...<br />sleep 15</b><br /><br /># Run a set of Dart Unit tests<br />results=$(content_shell --dump-render-tree http://localhost:8080)<br />echo -e "$results"<br /><br /><b>kill $pub_pid</b><br /><br /># check to see if DumpRenderTree tests fail...<br /></pre>That is less than ideal, but it does the trick:<pre class=prettyprint>$ /test/run.sh<br />Analyzing [lib/a_form_input.dart]...<br />No issues found<br />Looks good!<br /><br />Loading source assets...<br />Loading polymer transformers...<br />Serving a-form-input test on http://localhost:8080<br />Build completed successfully<br />...<br />CONSOLE MESSAGE: unittest-suite-wait-for-done<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> has a shadowRoot<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> acts like <input> - value property is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> acts like <input> - value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> acts like <input> - form value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> acts like <input> - containing form includes input with supplied name attribute<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into <x-double> acts like <input> - setting the name property updates the name attribute<br />CONSOLE MESSAGE:<br />CONSOLE MESSAGE: All 6 tests passed.<br />CONSOLE MESSAGE: unittest-suite-success<br />CONSOLE WARNING: line 213: PASS<br />CONSOLE MESSAGE: unittest-suite-wait-for-done<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> has a shadowRoot<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - value property is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - form value attribute is updated when internal state changes<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - containing form includes input with supplied name attribute<br />CONSOLE MESSAGE: PASS: AFormInputMixin mixed into &lt;x-double> acts like &lt;input> - setting the name property updates the name attribute<br />CONSOLE MESSAGE:<br />CONSOLE MESSAGE: All 6 tests passed.<br />CONSOLE MESSAGE: unittest-suite-success<br />CONSOLE WARNING: line 213: PASS</pre>It might be nice for this to work without the server, so I may take some time tomorrow to explore that a bit. Regardless, I have a solution for testing Polymer.dart base and mixin classes.<br /><br /><br /><span style="color: #ccc">Day #</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/minimum-viable-polymer-mixi18n-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/AH65FUejEx4" height="1" width="1" alt=""/>
