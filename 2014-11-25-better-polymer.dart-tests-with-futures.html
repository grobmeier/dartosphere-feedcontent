---
title: 'Better Polymer.dart Tests with Futures'
layout: post
published: '2014-11-25T23:59:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/ETOyczPNcNg/better-polymerdart-tests-with-futures.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - futures
    - polymer
    - testing

---

<div class=top-chain-links></div><br />I lamented <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>'s JavaScript-y callback nature yesterday. But I didn't do much about it. Ultimately I cannot do much until the library matures into more of a <a href="http://dartlang.org">Dart</a> library as the <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> needs to track the library, not my weakly held strong opinions (and I do admit that it makes sense to track the JavaScript <a href="http://www.polymer-project.org/">Polymer</a> for now). <br /><br />That said, I do think it worth exploring Dart futures as a means for cleaning up my tests. <br /><br />Last night's test looks like:<pre class=prettyprint><code>    group('syncing &lt;input> values', (){<br />      var input;<br /><br />      setUp((){<br />        input = _container.append(createElement('&lt;input>'));<br />        syncInputFromAttr(input, _el, 'state');<br />        _el.model.firstHalfToppings.add('pepperoni');<br />      });<br /><br />      test('updates the input', (){<br />        _el.async(expectAsync((_){<br />          expect(<br />            input.value,<br />            startsWith('First Half: [pepperoni]')<br />          );<br />        }));<br />      });<br />    });</code></pre>For a small test, that is not too horrible. Problems would arise as the complexity of the Polymer element grows.<br /><br />The main problem with the above test is in the actual test:<pre class=prettyprint><code>      test('updates the input', (){<br />        _el.async(expectAsync((_){<br />          expect(<br />            input.value,<br />            startsWith('First Half: [pepperoni]')<br />          );<br />        }));<br />      });<br /></code></pre><br />The async nature of this particular test is not integral to the functionality. It is merely a necessary evil to ensure that the Polymer element has been updated. Instead, I would much prefer to write:<pre class=prettyprint><code>      test('updates the input', (){<br />        expect(<br />          input.value,<br />          startsWith('First Half: [pepperoni]')<br />        );<br />      });</code></pre>The intent of that test is much clearer.<br /><br />To make that work, I need a setup that blocks. I had forgotten that vanilla unittest in Dart support this by returning a Future:<br /><pre class=prettyprint><code>      setUp((){<br />        input = _container.append(createElement('&lt;input>'));<br />        syncInputFromAttr(input, _el, 'state');<br />        _el.model.firstHalfToppings.add('pepperoni');<br /><br />       var completer = new Completer();<br />       _el.async(completer.complete);<br />       return completer.future;<br />      });</code></pre><br /><br /><br /><br /><span style="color: #ccc">Day #5</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/11/testing-polymerdart-synchronization.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/ETOyczPNcNg" height="1" width="1"/>
