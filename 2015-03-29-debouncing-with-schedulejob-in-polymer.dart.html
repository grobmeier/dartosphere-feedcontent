---
title: 'Debouncing with scheduleJob in Polymer.dart'
layout: post
published: '2015-03-29T00:41:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/sxqM54Z2TTg/debouncing-with-schedulejob-in.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />I make these little notes for myself and then I have no idea what they mean. <br /><br />While awaiting the copy edits for the latest <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>, I have been reviewing research tasks that I have assigned myself. I have a pretty good handle on the challenges of the <code>&lt;google-map></code> API (especially in <a href="http://dartlang.org">Dart</a>), so I have checked that off. Next on the list is “native Polymer debounce.” Since <a href="http://www.polymer-project.org/">Polymer</a> tends to have as many polyfills as it has native components, I doubt the debounce is native, but let's see...<br /><br />Mercifully, <a href="https://twitter.com/mbleigh">Michael Bleigh</a> was king enough to use the word “debounce” on his post about <a href="https://divshot.com/blog/web-components/polymer-features-you-may-have-missed/">Polymer Features That You May Have Missed</a>. And indeed, I missed that one, which is called <code>job()</code>. <br /><br />At first blush, <code>job()</code> seems fairly straight-forward in the JavaScript sample from the article, so I'll have a go at it in  <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>. Oddly enough, I have a debounce example in <a href="http://patternsinpolymer.com/">Patterns in Polymer</a>, but it is only in the Dart version of the book. Using 3rd party libraries is so easy in Dart that I wrote that chapter about using 3rd party JavaScript libraries in Polymer.dart. The example in the book is using the <a href="http://underscorejs.org">Underscore</a> <code>debounce()</code> method:<pre class=prettyprint>class HelloYou extends PolymerElement {<br />  // ...<br />  HelloYou.created(): super.created();<br /><br />  var _debouncedLucky;<br />  feelingLucky() {<br />    if (_debouncedLucky == null) {<br />      _debouncedLucky = context['_'].<br />        callMethod('debounce', [_feelingLucky, 750, true]);<br />    }<br />    _debouncedLucky.apply([]);<br />  }<br /><br />  _feelingLucky() { /* ... */ }<br />}<br /></pre>The <code>feelingLucky()</code> method is bound to a button in the template. The private <code>_feelingLucky()</code> Dart method is debounced by Underscore thanks to js-interop.<br /><br />If I am correct, I believe that I can replace all of that with <a href="http://www.dartdocs.org/documentation/polymer/0.16.0+6/index.html#polymer/polymer.Polymer@id_scheduleJob">scheduleJob()</a>:<pre class=prettyprint>@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  HelloYou.created(): super.created();<br />  // ...<br /><b>  PolymerJob _debouncedLucky;<br />  feelingLucky() {<br />    _debouncedLucky = scheduleJob(_debouncedLucky, _feelingLucky, 750);<br />  }</b><br /><br />  _feelingLucky() { /* ... */ }<br />}</pre>Of course, I am not correct. The debounce duration needs to be supplied as a <code>Duraction</code>, not an integer number of seconds. Dart complains as much:<pre class=prettyprint>Exception: Uncaught Error: Class 'int' has no instance getter 'inMilliseconds'.</pre>To supply the required <code>Duration</code>, I declare a delay duration of 750 milliseconds and supply that to <code>scheduleJob()</code>:<pre class=prettyprint><b>final delay = const Duration(milliseconds: 750);</b><br /><br />@CustomTag('hello-you')<br />class HelloYou extends PolymerElement {<br />  HelloYou.created(): super.created();<br />  // ...<br />  PolymerJob _debouncedLucky;<br />  feelingLucky() {<br /><b>    _debouncedLucky = scheduleJob(_debouncedLucky, _feelingLucky, delay);</b><br />  }<br /><br />  _feelingLucky() { /* ... * }<br />}<br /></pre>With that, I can click the feeling lucky button as many times as I like in the UI, but, unless I wait 750 milliseconds between clicks, nothing happens. Once I wait, my simple <code>&lt;hello-you></code> element tries to guess my lucky color while saying howdy:<br /><br /><a href="http://2.bp.blogspot.com/-WPLiT6H041c/VReButcZ65I/AAAAAAAAoXI/M9gOr6CxdRY/s1600/01-after_job.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-WPLiT6H041c/VReButcZ65I/AAAAAAAAoXI/M9gOr6CxdRY/s400/01-after_job.png" /></a><br /><br />That is a handy little feature that I had overlooked. Well, not overlooked so much as deferred, but thankfully I can mention this by name in the book now.<br /><br /><br /><span style="color: #ccc">Day #12</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/adopting-children-in-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/my-first-web-component-tester-test.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/sxqM54Z2TTg" height="1" width="1" alt=""/>
