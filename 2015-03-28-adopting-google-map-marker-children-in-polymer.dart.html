---
title: 'Adopting <google-map-marker> Children in Polymer.dart'
layout: post
published: '2015-03-28T01:21:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/vDnbkoGzblM/adopting-children-in-polymerdart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - google-maps
    - google-maps-api
    - js-interop
    - polymer

---

<div class=top-chain-links></div><br />Up tonight, I would like to muck around with custom, Google Map-like, <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> elements. Thanks to the <a href="https://pub.dartlang.org/packages/custom_element_apigen">custom_element_apigen</a>, I can pull the JavaScript <code>&lt;google-map></code> element into <a href="http://dartlang.org">Dart</a> code. It also pulls in <code>&lt;google-map-marker></code> and other, related elements. I can even individually use them in custom-built Polymer elements. But what about together?<br /><br />Specifically, what if I wanted to mark up my <code>&lt;x-map></code> Polymer.dart element (powered by <code>&lt;google-map></code>) with <code>&lt;x-meetup></code> marker elements (powered by <code>&lt;google-map-marker></code>)? That is, I would the following to result in a map with the venerable <a href="http://bmoreonrails.org">B'more on Rails</a> meetup displayed:<pre class=prettyprint><code>      &lt;x-map latitude="39.283" longitude="-76.616"><br />        &lt;x-meetup<br />           name="B'more on Rails"<br />           url="http://bmoreonrails.org"<br />           latitude="39.2810662"<br />           longitude="-76.5808788">&lt;/x-meetup><br />      &lt;/x-map></code></pre>I think this is going to be tricky for two reasons. First, the <code>&lt;google-map></code> element is rendering in the shadow DOM of <code>&lt;x-map></code>:<br /><br /><a href="http://2.bp.blogspot.com/-IerMfcv3ixE/VRYwM9fCEkI/AAAAAAAAoBg/nOwXbzjtYgk/s1600/01-shadow_dom.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-IerMfcv3ixE/VRYwM9fCEkI/AAAAAAAAoBg/nOwXbzjtYgk/s400/01-shadow_dom.png" /></a><br /><br />Similarly, the <code>&lt;google-map-marker></code> element in <code>&lt;x-meetup></code> would reside in the shadow DOM of <code>&lt;x-meetup></code>. How on earth do I get the <code>&lt;google-map></code> and <code>&lt;google-map-marker></code> on the same document fragment, let alone working together? <br /><br />The second thing that makes this tricky is that <code>&lt;x-meetup></code> resides in the light DOM of the document and is projected into <code>&lt;x-map></code>. The problem there is that, to the best of my knowledge, there is no easy way to get distributed nodes in Polymer.dart.<br /><br />It turns out that I do not have to worry about distributed nodes in this case. Instead, once the container <code>&lt;x-map></code> element is attached to the document, I can iterate over the children:<pre class=prettyprint>@HtmlImport('x-map.html')<br />library x_map;<br /><br />import 'package:polymer/polymer.dart';<br />import '../google_map.dart';<br />import 'x_meetup.dart';<br /><br />@CustomTag('x-map')<br />class XMap extends PolymerElement {<br />  // ...<br />  XMap.created(): super.created();<br /><br />  attached(){<br /><b>    children.forEach((el){<br />       // Add markers from each child the map...<br />    });</b><br />  }<br />}<br /></pre>I am unsure how best to grab the <code>&lt;google-map-marker></code> from the children. It seems wrong to root through a child's shadow DOM. So instead, I assume the element has a <code>googleMapMarker</code> property that exposes this element (likely as part of a mixin):<pre class=prettyprint>@CustomTag('x-map')<br />class XMap extends PolymerElement {<br />  // ...<br />  XMap.created(): super.created();<br /><br />  Element get map => $['google-map'];<br /><br />  attached(){<br /><b>    children.forEach((el){<br />      var marker = el.googleMapMarker.clone(true);<br />      map.append(marker);<br />    });</b><br />  }<br />}<br /></pre>Once I have the marker, I clone it so that it can be added to the <code>&lt;x-map></code> shadow root.<br /><br />The <code>map</code> getter finds the <code>&lt;google-map></code> via dollar sign lookup of the <code>google-map</code> ID:<pre class=prettyprint>&lt;polymer-element name="x-map"><br />  &lt;template><br />    &lt;h1>x map&lt;/h1><br />    &lt;google-map<br /><b>       id="google-map"</b><br />       latitude="{{latitude}}"<br />       longitude="{{longitude}}">&lt;/google-map><br />  &lt;/template><br />&lt;/polymer-element></pre>As for the <code>&lt;x-meetup></code> element that has a <code>&lt;google-map-marker></code> element, I define the attributes and the <code>googleMapMarker</code> getter in <code>x_meetup.dart</code> as:<pre class=prettyprint>@HtmlImport('x-meetup.html')<br />library x_map;<br /><br />import 'package:polymer/polymer.dart';<br />import '../google_map.dart';<br /><br />@CustomTag('x-meetup')<br />class XMeetup extends PolymerElement {<br />  @published String name;<br />  @published String url;<br />  @published float latitude = 0.0;<br />  @published float longitude = 0.0;<br />  @published Element map;<br /><br />  XMeetup.created(): super.created();<br /><br /><b>  Element get googleMapMarker => $['marker'];</b><br />}</pre>Finally the <code>x-meetup.html</code> template builds the <code>&lt;google-map-marker></code> element as:<pre class=prettyprint>&lt;polymer-element name="x-meetup"><br />  &lt;template><br />    &lt;google-map-marker<br />       id="marker"<br />       map="{{map}}"<br />       latitude="{{latitude}}"<br />       longitude="{{longitude}}"<br />       title="{{name}}"<br />       labelContent="{{name}}"<br />       labelClass="labels"><br />      &lt;p>This is... &lt;a href="{{url}}">{{name}}&lt;/a>&lt;/p><br />    &lt;/google-map-marker><br />  &lt;/template><br />&lt;/polymer-element></pre>The class looks this element up via the <code>marker</code> ID, returns it back to the <code>&lt;x-map></code> class, which clones it and inserts it in the <code>&lt;x-map></code> element's <code>&lt;google-map></code>. The end result is a marker showing where B'more on Rails meets:<br /><br /><a href="http://1.bp.blogspot.com/-qcIfpj7rVSY/VRY35_IeySI/AAAAAAAAoB0/9bu3pxPIXAc/s1600/02-bmore_on_rails_location.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-qcIfpj7rVSY/VRY35_IeySI/AAAAAAAAoB0/9bu3pxPIXAc/s400/02-bmore_on_rails_location.png" /></a><br /><br />This might be somewhat contrived, but it does have the advantage of taking what could be consistent data for a bunch of meetups:<pre class=prettyprint><code>        &lt;x-meetup<br />           name="B'more on Rails"<br />           url="http://bmoreonrails.org"<br />           latitude="39.2810662"<br />           longitude="-76.5808788">&lt;/x-meetup></code></pre>And presenting it in a consistent way on the map. For instance, thanks to the <code>&lt;p></code> tag in the <code>&lt;x-meetup></code> template:<pre class=prettyprint>&lt;polymer-element name="x-meetup"><br />  &lt;template><br />    &lt;google-map-marker<br />       id="marker"<br />       map="{{map}}"<br />       latitude="{{latitude}}"<br />       longitude="{{longitude}}"<br />       title="{{name}}"<br />       labelContent="{{name}}"<br />       labelClass="labels"><br /> <b>     &lt;p>This is... &lt;a href="{{url}}">{{name}}&lt;/a>&lt;/p></b><br />    &lt;/google-map-marker><br />  &lt;/template><br />&lt;/polymer-element></pre>These meetup markers get a nifty little info window:<br /><br /><a href="http://2.bp.blogspot.com/-0FxZ2U5R__I/VRY35zoNH1I/AAAAAAAAoBw/D5f30QRFiJI/s1600/03-info_window.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-0FxZ2U5R__I/VRY35zoNH1I/AAAAAAAAoBw/D5f30QRFiJI/s400/03-info_window.png" /></a><br /><br />There may be better ways to go about accomplishing this, but in the end, a fairly minimal amount of code produced some nice markers on a custom map. That is a nice win.<br /><br /><span style="color: #ccc">Day #11</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/03/using-google-map-polymer-in-polymerdart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/03/debouncing-with-schedulejob-in.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/vDnbkoGzblM" height="1" width="1" alt=""/>
