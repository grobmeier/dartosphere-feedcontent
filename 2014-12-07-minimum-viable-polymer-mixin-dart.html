---
title: 'Minimum Viable Polymer Mixin (Dart)'
layout: post
published: '2014-12-07T23:58:00-05:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/uRCK55lD4jo/minimum-viable-polymer-mixin-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - mixins
    - polymer

---

<div class=top-chain-links></div><br />As pointed out in comments last night, there may be yet another minimum viable <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> mixin than what I identified.<br /><br />The example mixin that I have been using is <code>&lt;a-form-input></code>, which enables arbitrary Polymer elements to serve as <code>&lt;input></code> elements in native HTML forms. Yesterday's solution was for the mixin to define form-like instance variables (e.g. <code>name</code> and <code>value</code>), but not mark them as published properties:<pre class=prettyprint>abstract class AFormInputMixin {<br />  // @PublishedProperty(reflect: true)<br />  String name;<br /><br />  // @PublishedProperty(reflect: true)<br />  String value;<br /><br />  void attached() { <br />    // Use name and value in here...<br />  }<br />}</pre>It was then the responsibility of the concrete class to mark them as published after mixing the abstract class in:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br />import 'package:a-form-input/a_form_input_mixin.dart';<br /><br />@CustomTag('x-pizza')<br />class XPizza extends PolymerElement with AFormInputMixin {<br /><br /><b>  @PublishedProperty(reflect: true)<br />  String name;<br /><br />  @PublishedProperty(reflect: true)<br />  String value;</b><br />  // ...<br />}</pre>I like the expressiveness of the class declaration (this is a Polymer element with form-like traits), but needing to declare properties from the mixin in the concrete class stinks.<br /><br />James Hurford suggested that it <i>is</i> possible to push the published annotations back into the mixin if I use the readValue()/writeValue() version of properties instead of instance variables:<pre class=prettyprint>class AFormInputMixin implements Observable, Polymer {<br /><b>  @PublishedProperty(reflect: true)<br />  String get name => readValue(#name);<br />  set name(String n) => writeValue(#name, n);</b><br />  // String name;<br /><br /><b>  @PublishedProperty(reflect: true)<br />  String get value => readValue(#value);<br />  set value(String v) => writeValue(#value, v);</b><br />  // String value;<br /><br />  attached() { /* ... */ }<br />}<br /></pre>And happily, if I remove the <code>@PublishedProperty</code> calls from my concrete class... everything continues to work.<br /><br />About the only drawback to this approach is some warning about missing methods:<pre class=prettyprint>$ dartanalyzer lib/a_form_input_mixin.dart<br />Analyzing [lib/a_form_input_mixin.dart]...<br />[warning] Missing concrete implementation of getter 'Element.onStalled', 'Polymer.bindProperty', getter 'Element.clientLeft', getter 'Element.outerHtml' and 272 more (/home/chris/repos/a-form-input-dart/lib/a_form_input_mixin.dart, line 6, col 7)<br />1 warning found.</pre>Well, OK 276 missing methods.<br /><br />I can eliminate those by removing the <code>implements</code> modified on my mixin class:<pre class=prettyprint>library a_form_input;<br /><br />import 'package:polymer/polymer.dart';<br />import 'dart:html' show HiddenInputElement;<br /><br />abstract class AFormInputMixin  {<br />  @PublishedProperty(reflect: true)<br />  String get name => readValue(#name);<br />  set name(String n) => writeValue(#name, n);<br /><br />  @PublishedProperty(reflect: true)<br />  String get value => readValue(#value);<br />  set value(String v) => writeValue(#value, v);<br /><br />  void attached() { /* ... */ }<br />}<br /></pre>As long as I continue to import the polymer package—even if I do not use it—then the mixin continues to work. I still get warnings about readValue()/writeValue() not being defined:<pre class=prettyprint>$ dartanalyzer lib/a_form_input_mixin.dart<br />Analyzing [lib/a_form_input_mixin.dart]...<br />[warning] The method 'readValue' is not defined for the class 'AFormInputMixin' (/home/chris/repos/a-form-input-dart/lib/a_form_input_mixin.dart, line 8, col 22)<br />[warning] The method 'writeValue' is not defined for the class 'AFormInputMixin' (/home/chris/repos/a-form-input-dart/lib/a_form_input_mixin.dart, line 9, col 25)<br />[warning] The method 'readValue' is not defined for the class 'AFormInputMixin' (/home/chris/repos/a-form-input-dart/lib/a_form_input_mixin.dart, line 13, col 23)<br />[warning] The method 'writeValue' is not defined for the class 'AFormInputMixin' (/home/chris/repos/a-form-input-dart/lib/a_form_input_mixin.dart, line 14, col 26)<br />4 warnings found.<br /></pre>But I can eliminate those easily enough in my abstract mixin class. I need only declare the method signature and allow concrete classes to provide the definition:<pre class=prettyprint>import 'package:polymer/polymer.dart';<br /><br />abstract class AFormInputMixin  {<br />  @PublishedProperty(reflect: true)<br />  String get name => readValue(#name);<br />  set name(String n) => writeValue(#name, n);<br /><br />  @PublishedProperty(reflect: true)<br />  String get value => readValue(#value);<br />  set value(String v) => writeValue(#value, v);<br /><br /><b>  readValue(v);<br />  writeValue(n,v);</b><br /><br />  void attached() { /* ... */ }<br />}<br /></pre>With that, I have no static type warnings:<pre class=prettyprint>$ dartanalyzer lib/a_form_input_mixin.dart<br />Analyzing [lib/a_form_input_mixin.dart]...<br />No issues found</pre>I also get no compile-time or run-time warnings, and my concrete class continues to function. That is, when my concrete <code>&lt;x-pizza></code> element updates <code>name</code> and <code>value</code> (that are now completely defined and annotated in my mixin), these changes are reflected on the element attributes and on the hidden <code>&lt;input></code> injected into the DOM by <code>&lt;a-form-input></code>:<br /><br /><a href="http://4.bp.blogspot.com/-jIZhHRpNG7g/VIU3LFziPfI/AAAAAAAAh4k/l8tOCafKqb8/s1600/01-minimal_mixin.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-jIZhHRpNG7g/VIU3LFziPfI/AAAAAAAAh4k/l8tOCafKqb8/s400/01-minimal_mixin.png" /></a><br /><br />It is a little awkward to require the mixin author to use the <code>readValue()</code> / <code>writeValue()</code> syntax, but it is a heck of a lot nicer doing that than requiring concrete class authors to publish properties from the mixin. I can live with this.<br /><br /><br /><span style="color: #ccc">Day #17</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/12/i-may-have-given-up-prematurely-on-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="//feeds.feedburner.com/~r/JaphrByChrisStrom/~4/uRCK55lD4jo" height="1" width="1" alt=""/>
