---
title: 'In Which I Take Things One Step Too Far...'
layout: post
published: '2016-02-16T23:05:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/_bd0m4hjGWY/in-which-i-take-things-one-step-too-far.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - 'chain of responsibility pattern'
    - dart
    - dartlang
    - 'design patterns'
    - mixins
    - nosuchmethod

---

<div class=top-chain-links></div><br />So the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility pattern</a> in <a href="http://dartlang.org">Dart</a>… I've explored it with <code>noSuchMethod()</code>. I've explored it with mixins. But I have yet to explore it with <code>noSuchMethod()</code> in mixins.<br /><br />Things are gonna get a little crazy tonight.<br /><br />I continue to work with the <code>_PurchasePower</code> mixin for employee-like classes. It describes the ability of an employee to make purchasing decisions. It sets the successor in the responsibility chain to point to the employee next on the corporate ladder:<pre class=prettyprint>abstract class _PurchasePower {<br />  get successor => reportsTo;<br />  // ...<br />}</pre>In this case, it simply delegates to the <code>reportsTo</code> property of <code>Employee</code>—the receiver of the mixin. <br /><br />The <code>_PurchasePower</code> mixin completes the chain of responsibility pattern by declaring <code>processRequest()</code>. This method sends the request to the successor if the current class does not handle it, and <code>_processRequest()</code>, which performs the actual handling of the request:<pre class=prettyprint>abstract class _PurchasePower {<br />  // ...<br />  void processRequest(PurchaseRequest request) {<br />    if (_processRequest(request)) return;<br />    if (successor == null) return;<br /><br />    successor.processRequest(request);<br />  }<br /><br />  bool _processRequest(_) => false;<br />}</pre>That works great when there is only one request to handle, but what if there are multiple requests to be handled (e.g. <code>processorName()</code> and <code>processRequest()</code>)?<br /><br />This is where it would be handy to be able to mixin <code>noSuchMethod()</code>. Instead of declaring <code>processRequest()</code> to possibly send the request to the successor, <code>noSuchMethod()</code> can do so. Except I hit a stumbling block right away here.<br /><br />First, I need to handle requests by converting <code>processRequest()</code> to <code>_processRequest()</code> and <code>processorName()</code> to <code>_processorName()</code>. Just prepend an underscore, right? Well, no.<br /><br />When I get the arguments inside <code>noSuchMethod</code>, I can figure out the method that was being invoked by checking <code>memberName</code>. From here, it should be a simple matter of interpolating noSuchMethod's <code>memberName</code> into a string:<pre class=prettyprint><code>  noSuchMethod(args) {<br />    var handlerMethod = "_${args.memberName}";<br />    // ...<br />  }</code></pre>The problem is that <code>memberName</code> is a <code>Symbol</code>, which gets converted to strings as "<code>Symbol('symbol_name_here')</code>. So the <code>handlerMethod</code> winds up being <code>_Symbol('_processRequest')</code>. Not at all what I want. <br /><br />I have two undesirable choices here—strip <code>Symbol('</code> and <code>')</code> from the resulting string or painstakingly lookup the string value. Neither is a good option, but the latter seems to be the most official way:<pre class=prettyprint><code>  noSuchMethod(args) {<br />    var handlerMethod = "_${MirrorSystem.getName(args.memberName)}";<br />    // ...<br />  }</code></pre>Yuck. And unfortunately, I am not done with the yuck. I cannot invoke methods with strings, so I have to convert that back to a <code>Symbol</code>:<pre class=prettyprint><code>  noSuchMethod(args) {<br />    Symbol handlerMethod = new Symbol("_${MirrorSystem.getName(args.memberName)}");<br />    // ...<br />  }</code></pre>Even now, I am not done with the yuck. And this next yuckiness takes me a while to track down.<br /><br />It turns out that you cannot use the <code>Symbol</code> constructor to create a symbol that is private. Well, that is not 100% true, it lets me create a symbol, but I am not allowed to use it to invoked the private method. Making this situation even more annoying is that I can invoke <code>_processRequest()</code> with a symbol literal: <code>#_processRequest</code>. But if I dynamically try to create that symbol, it silently fails to call the right method.<br /><br />Bummer. <br /><br />Even if I choose a different naming convention, I would not want the method that actually processes the request to be public. Only the method invoking the handler or sending the request to the successor should be public. So I am left to either move handler code into <code>noSuchMethod()</code> to sit beside the successor code or I can give the handler method a weird name.<br /><br />I opt for the latter by prepending <code>xxx_</code> to the name:<pre class=prettyprint><code>  noSuchMethod(args) {<br />    Symbol handlerMethod = new Symbol("xxx_${MirrorSystem.getName(args.memberName)}");<br />    // ...<br />  }</code></pre>With this approach, I eventually get the code working, but... yuck.<br /><br />Even if this were back in the <code>Employee</code> class, I would still face the same limitation from the <code>Symbol</code> constructor. In other words, this seems like an ill-advised approach in current Dart. <br /><br /><i>Play with the code on DartPad: <a href="https://dartpad.dartlang.org/9f9ca7397d88f6cf7e54">https://dartpad.dartlang.org/9f9ca7397d88f6cf7e54</a>.</i><br /><br /><br /><br /><span style="color: #ccc">Day #97</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2016/02/how-much-mixin-chain-of-responsibility.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2016/02/a-dom-chain-of-responsibility.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/_bd0m4hjGWY" height="1" width="1" alt=""/>
