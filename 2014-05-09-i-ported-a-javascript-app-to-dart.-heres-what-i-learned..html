---
title: 'I ported a JavaScript app to Dart. Here''s what I learned.'
layout: post
published: '2014-05-09T07:27:00-07:00'
feed: 'Seth Ladd''s Blog'
link: 'http://feedproxy.google.com/~r/SethLaddsBlog/~3/XTHAsLZkAHk/i-ported-javascript-app-to-dart-heres.html'
author:
    name: 'Seth Ladd'
    email: noreply@blogger.com
    url: 'https://plus.google.com/118397406534237711570'
tags:
    - dart
    - dartlang

---

<div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I port a snazzy little JavaScript audio web app to <a href="https://www.dartlang.org/">Dart</a>, discover a bug, and high-five type annotations. Here's what I learned.</span><br /><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span><span style="background-color: transparent; color: black; font-size: 15px; font-variant: normal; font-weight: normal; text-decoration-line: none; vertical-align: baseline; white-space: pre-wrap;"><i>[As it says in the header of this blog, I'm a seasoned Dart developer. However, I certainly don't write Dart every day (I wish!). Don't interpret this post as "Hi, I'm new to Dart". Instead, interpret this post as "I'm applying what I've been documenting."]</i></span></span><br /><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">This post analyzes two versions of the same app, both the original (JavaScript) version and the Dart version. The original version is a proxy for any small JavaScript app, there's nothing particularly special about the original version, which is why it made for a good example.</span></span><br /><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><br /></span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">This post discusses the differences between the two implementations: file organization, dependencies and modules, shims, classes, type annotations, event handling, calling multiple methods, asynchronous programming, animation, and interop with JavaScript libraries. Finally, I detail the lessons learned.</span></span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Background</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Mr. Paul Lewis wrote a snazzy little web app for audio processing. His </span><a href="https://github.com/paullewis/music-dna" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">Music DNA</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> app uses JavaScript to load up an audio file, play it, and visualize the sounds in a browser. It’s a cool little demo of what’s possible on the web platform.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"><img alt="Screen Shot 2014-04-25 at 4.10.53 PM.png" height="268px;" src="https://lh6.googleusercontent.com/6MnP2DLt3dyFck972viNURWBzT8q2oJhcScJff2Dj5c2Vc5qeKLBuoZWDdTp0i7nJDda-cbGzXj0es5XJfYA2HR9VskdKX3FwWhqBwUpzw5UIrKWSKqVoLfjVgQXKm6_tw" style="-webkit-transform: rotate(0rad); border: none;" width="300px;" /></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">I’m always impressed with Paul’s designs and code, so I asked myself: Could I easily port this app to Dart? Was Dart up to the challenge of a web audio app? Is there benefit to using Dart for little apps like this?</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Spoiler: yes, yes (mostly), and yes. Read on!</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Fine print</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">I ported the original JavaScript version of Music DNA app as of </span><a href="https://github.com/paullewis/music-dna/tree/5747c31c264032c8be21cfb5173f6945740554fc" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">this revision</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. The code for the &nbsp;</span><a href="https://github.com/sethladd/music_dna_dart" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is also available. It’s possible that by the time you read this, the original JavaScript version will have changed. I also attempted to minimize the differences between the two code bases. I tried to keep the names the same (when appropriate), and the number of files the same (again, when appropriate).</span></span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Organization</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I examine file layout and navigation of both the original project and my Dart version.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The original version collected all files into a single directory.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 9.48.35 PM.png" height="420px;" src="https://lh3.googleusercontent.com/Y5dsC50DqzjNI290qGBtHqCaxfGeeHyisJci6-k-n_4Iqma4qaeWOcxATO__31RCj_e3EPKgwEZjAOO9jdhoDlW_3luZGU8RwbytpcpS3M8DZLuaYrw97HK2FJ0dvL6NSQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="224px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">To discover the “main” JavaScript file, I opened index.html and I found six script files:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 9.49.50 PM.png" height="239px;" src="https://lh6.googleusercontent.com/rAPS_T4kdYs6mPdL8wjgdBkQsG_WFhwW-ucvgeBZW3WgVUbYT2HwwQxcNgNlfVSuqa-68frtzYvcVMEmm_imnXA5L4InOc4N_qeGi9UhOl0AGqBmX-pGQQah6OuROijuCg" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Hm, where does the application start? I wasn’t sure. I opened each file, in order. It appeared that bootstrap.js contained the “entry point” of the application.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The entry point was a “immediately invoked function expression” (IIFE):</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="music-dna_bootstrap_js_at_master_·_paullewis_music-dna.png" height="477px;" src="https://lh3.googleusercontent.com/8ncuE86d-xiXqzP4aun1jLCKtxllVeGjrS8F0AxfYBuPkHFKXqNa2Rit2FTRKsulCQxkKTfiUVwDj95YxrSBUDrc0D4n7Cb2FCM-bwt1VyRIyg7hLdThLpUj_CruJvxrhw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart’s package manager, </span><a href="https://pub.dartlang.org/" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">pub</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, defines a </span><a href="https://www.dartlang.org/tools/pub/package-layout.html" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">layout convention for packages</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and apps. The Dart version has the HTML, and Dart files for the app, inside a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">web</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> directory. The library files (files that contain libraries that might be useful for any app) are inside a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">lib</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> directory. (More on this soon.)</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 10.34.11 PM.png" height="580px;" src="https://lh6.googleusercontent.com/2djzBljTncCrNw7T3zwK7Xl3Pxs3wQf2vg7Nrx3eq9YMO9aPJi6PnOiis5FkxzmjedlBNofJq5GfBISSep_Pt3xruhd4kjbm58_nbX0ZAqVtV0Y-0ICxSAPy8u4mT3s4ow" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="414px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">To find the “entry point”, I opened the main HTML file (music_dna.html). I found a single Dart file and two supporting JavaScript files.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 9.59.01 PM.png" height="113px;" src="https://lh5.googleusercontent.com/mr8lMTiKWU4AoEMvJJnP17ZozdYsZnCsIGn5LIrLXTjsFSHoP6J363_qyhxCj6cOsks6VLemmFpBYydGR1cefKdKsI3NhBY2uIlwgXXPTfYjMom-150GZEbu-2m6x3UQ3A" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">I did not port the id3.js file to Dart for two reasons: it was minified, and I wanted to test Dart-JavaScript interop. The dart.js file is boilerplate: it helps the app run in both JavaScript engines and Dart VM.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Dart_Editor.png" height="290px;" src="https://lh3.googleusercontent.com/NJ0JkPFstLP2sWVhzJ3I-jPRv84TEE_JjIy7daRYNwzAkdllRYE8RMOF4WcWbBftJIg87CXhCpxLZb2IprtfYiedIZWwZH0Hc_SALoY6Rru3kMZNaTJqPsSy8LK6MfwDqw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="550px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The application starts from the main() function in bootstrap.dart. All Dart programs start at the main() function.</span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dependencies and modules</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I examine how both versions handle linking to libraries or modules.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">JavaScript doesn’t have a native library or module system. The original version listed each “module” as a separate script tag from the main HTML file (screenshot above). The order of the scripts is important, as scripts that load later depend on scripts that were loaded earlier. The code does not explicitly declare its dependencies.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">For example, the bootstrap script creates a new instance of MusicDNA. The bootstrap.js file does not include a reference to the location of the definition of the MusicDNA function.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="music-dna_bootstrap_js_at_master_·_paullewis_music-dna.png" height="220px;" src="https://lh5.googleusercontent.com/XkhGqrQJhHuJ84wmfoLyHf5kJbl3WattEY0pd77L6c9oBkEDzrsR192SuTqVRmUXp7V2HTQ1QGwAdmYPELJqYV-3WxzATsEjhz_qv4Sq0GcJKkHXrv95Q6KsT2ysKzEfgw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The MusicDNA function comes from the music-dna.js file, which is loaded before the bootstrap.js file via script tags.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The Dart language natively supports </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">libraries</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. A library can </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">import</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> other libraries. For example, the bootstrap.dart file imports its dependencies:</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 10.31.14 PM.png" height="115px;" src="https://lh3.googleusercontent.com/9D7np9MialJdfjfrA2UHDSoaNLqvrmVhd6BySsalL0bgx30DNxHXU11YPvw0za7_onasQEDrj7pfyv5ixnasnV6i_Ma_6xcFkKtNl0UF2oNmEVeieW-sZ2C42uW5JxyxFg" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The Dart SDK has some standard libraries like </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:html</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> for DOM access, </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:js</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> for interop with JavaScript (more on this below), and more. The code also imports </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">music_dna.dart</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> which explicitly provides the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">MusicDNA</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> class. Using the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">show</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> keyword with </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">import</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> makes it easy to glance at what names are provided by what library.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The music_dna.dart file is its own library, which also declares its own dependencies:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 11.10.20 PM.png" height="230" src="https://lh6.googleusercontent.com/dA7DKi_hn1-bc51oRY2NsBrXEdC0ttHhTwszhaN78zsB8H1zT395Sae1CuIHI16fDXnrv3zmfC5KQJkN9mbDHwI36YYihNDzleGR0q524LaPGFYedGg9SD5U2j4YMw87AQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="640" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Notice the two types of URIs used in imports: </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:____</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">package:_____</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. Imports from </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> come from the Dart SDK, and imports from </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">package:</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> refer to libraries that live in </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">packages</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. A package is a bundle of Dart code, conforming to some layout conventions, and declared by a </span><a href="https://www.dartlang.org/tools/pub/pubspec.html" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">pubspec.yaml</span><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;"> file</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Both libraries and applications can live inside of a package. The music_dna application is itself a package. The music_dna library imports the audio library from its own package. This is a handy way to avoid using relative (and brittle) paths that would have to reach up and out of the file’s directory.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Back to libraries: A library can be split into multiple </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">parts</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. The audio.dart file declares the library, its imports, and the two other files that contain the library’s classes: audio_parser.dart and audio_renderer.dart.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Dart_Editor.png" height="221px;" src="https://lh5.googleusercontent.com/Yncets4H41DTyTwcDi9rwvDor_lR-MTi-qTt0HsADuePeKUrI_b8AdCAzvLxbXXV5YCc-nyitaOD-MJ8nOGQwNj1uY46c-F-oD5lp-tuXVtsxGYp8l-ejBGoq4X7Lpc_Xg" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">An abbreviated way to look at the libraries and dependencies of the Dart version:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="296px;" src="https://docs.google.com/drawings/d/s2HsePbNpyMV-Q9LYyu1f5g/image?w=624&amp;h=296&amp;rev=161&amp;ac=1" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Shims</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I explore how both versions deal will shimming browser APIs, such as Web Audio and requestAnimationFrame. A shim is a thin layer of code that compensates for browser differences in function names or APIs.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The original version shimmed the APIs using a common JavaScript language pattern. For example, here is the shim for AudioContext (from Web Audio) in audio_parser.js:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="music-dna_audio-parser_js_at_master_·_paullewis_music-dna.png" height="323px;" src="https://lh4.googleusercontent.com/fkZbNdZatfNO4oz5l8wG-4yErAwSzvTwLhHiOu5v6wUQACai2fsy-UUBpTvfh-5kwt6x9eTeGvqDVKhWrsk8SWJTGpF8PMEl8ChSuQFQXMGeeSCApn4PSeoQXKvE2qLadA" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The original code also shimmed requestAnimationFrame in bootstrap.js:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-25 at 10.44.26 PM.png" height="225px;" src="https://lh6.googleusercontent.com/lMAonOdbEaVt8BB5vm9S_BMlBo10LxOgupB1eU33vjMYbW7Bm_ygcB3gc4pzA9KoT6Iq3hZLNE2Q80ReeLRm1vYJE9rT_HESN3kpI_DMKhlQH-nsAEQuMVlcxG7hUUgENQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:html</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> library hides the shims, so I don’t need to worry about it. For example, I just needed to import the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:web_audio</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> library and then use the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">AudioContext</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> name.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Dart_Editor.png" height="103px;" src="https://lh6.googleusercontent.com/G1T0jk1e4ZvGCaNGq_KdchETrGmE-wDcMRJeDeEWZ3j1wXX14M3V_ZQdkfJi_CvmikGG76XR4S1dVrbmmPyLRf6qFqWkTfcTpWRXz_od2ZFTebOeSQMWCovW__z7tSytMw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Dart_Editor.png" height="59px;" src="https://lh5.googleusercontent.com/pvdkSVcR9h-65gsClGyDcHnK4jC1KqSBJ-5v_kQD1xktxDSdBKn2XhQLtMMzST2eplcqj94oGPU5vjmjGngtQPGjMWoRpOn3dsTuBzREsf2OqDOUZjbAWxcXSiccS_Z-mw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When I compile the Dart app to JavaScript, the shims are included in the generated JavaScript. This ensures the generated code works in all modern browsers.</span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Classes</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I examine how both versions model and construct concepts.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">JavaScript is not a class-based object oriented language. The original version used standard JavaScript patterns for “classes”.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="music-dna_audio-parser_js_at_master_·_paullewis_music-dna.png" height="401px;" src="https://lh4.googleusercontent.com/ys8KQsADL90K08GTK-VxYrWP9547ZQZgYEk2h7QQ4qgX4y1_NF6aSXM5C8uocoL4KS7dgcAJU284SDQzH33NKXykLTpoA9MK52cJ3mp4baYtYr41S_-XTIE-fqBVnc-8Ug" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The JavaScript version initializes fields by constructing new objects as well calling methods. The object isn’t initialized until the entire body of the AudioParser function is run.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart is a class-based object oriented language. I created a formal class for AudioParser.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="403px;" src="https://lh5.googleusercontent.com/nGb3sxDx5ec-rbe0j51aijvDwN5jJL_xxwGL8TSi5o3t_5loK2tWWTagyi_KMDqRulOL6ZaihA8HEQJ2YBKGOr2q3xKFT3TkaIA-4GjHOHHgYQR4bWKPIl8ouvNUabDAew" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The Dart version initializes most fields inside of the constructor body. By the time the constructor body is run, the object is initialized.</span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Type annotations (aka discovering a bug)</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I use </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">type annotations</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and discover a </span><a href="https://github.com/paullewis/music-dna/issues/7" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">bug</span></a><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> in the original code.</span></span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">JavaScript doesn’t have a way to explicitly state that a variable can hold a specific type of object. Fields are simply marked as </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">var</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, as in this example:</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-26 at 12.26.34 AM.png" height="379px;" src="https://lh3.googleusercontent.com/OGa0DkJapvDcdaS9Bkt9W1csGqPWAPXaPCD-Ph3jbG5JtZGkOK54u3HtpPAGEKYoIEjxBmGztVlTTBUIbpfwpBQrZ08QNc3sMIoOpzSrky8xIZOFRQOwh7ZofDL2QRYhIQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">It’s unclear what kind of function can be assigned to </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">audioDecodedCallback</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. I can assume what </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">sourceNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> or </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">audioRenderer</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> can be, because I know this is a Web Audio app and there’s another file called audio-renderer.js.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Method parameters also do not have a type annotation. Here is one example:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="337px;" src="https://lh4.googleusercontent.com/LEx1cVrEkg9PFi7384Cf_icTYM9SuBCY104gEzGrL9Z_2bHJ5RIjve2saKpMCFlnE1Mk1ri2X3iKN8Okijma9V6_-D9FF8vSg-iJZPIAWEoGu_SKOi9vD4kXYFgQ4EnWBw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Can you spot the bug in the above example?</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> I didn’t, until I converted the code to Dart.</span></span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Type annotations are optional in Dart, but I love ‘em. I use type annotations as inline and explicit docs for my fellow programmers and my productive tools.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">We’ve seen it before, but here’s the recap of how I use type annotations for fields in AudioParser:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-26 at 12.36.44 AM.png" height="278px;" src="https://lh4.googleusercontent.com/O1TeSY_qAqwUIb05xPHk8B75l-qBY8lA6GqF3CqSeO_8g_1WZAWsNWIDun7N5ypJaN2WZC3pxZg9XJqjvmPjGNoaJ9Rj6Fu_0mbdrK3lDSIWf9E2Nnr1npszHQ7o1kJZmw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="512px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">So, </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">gainNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is of type </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">GainNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. I could probably have guessed that, if I knew there was a Web Audio type called GainNode. Without the type annotation, editors and analyzers can’t infer that </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">gainNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">GainNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. And that’s important, because…</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="249px;" src="https://lh6.googleusercontent.com/puQTLRsQ-uAjkUur6bHipRsG-Fz_p5mJEkOYPeqKzD4g-q2WgEWC4GAAiFjLco_RfrwzyIussqtRMVBwldzqU2mLAvh5J_OTwwD6LEiE02qWTIRHsi9VMSUBynYHsVFiHA" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart Editor and the Dart analyzer knows that </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">disconnect()</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> takes an </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">int</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and not a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">GainNode</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. A warning is displayed, and bug identified!</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Turns out, the code didn’t need the call to disconnect() anyway. But, I feel more confident knowing that tools can identify potential errors.</span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Event handlers, and calling multiple methods on the same object</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I encounter a Dart-y DOM, use a Dart language feature, and reduce the amount of code I have to type.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The traditional way to listen for DOM events (like </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">drop</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> or </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dragover</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">) is to use </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">addEventListener()</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. This method takes a string as the first parameter. If you misspell the name of the event, you will not get a warning, and the program will keep on trucking. There is no code completion for the values of the strings, because the language can’t express all the valid values for the first argument.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Here is an example, from the original code, of listening to multiple events on a single </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">fileDropArea</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> object.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-26 at 12.47.25 AM.png" height="245px;" src="https://lh3.googleusercontent.com/s__jBi-oxNPniX1tWsgDx0gdXCKd7o1w4YY02vyjBlU-zxmJDhDp83WW9Npy8ExIOXslMD3rf7WliOQQTSudvaP718B_yF0lR91UhP1UzagciAugsrRWs3kfTlEWmxBa-g" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:html</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> library offers DOM APIs that are more toolable. There are specific methods for specific events, for example </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">onDrop</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. If you misspell the method name, the tools can warn you about an unknown method. Also, you can use code completion to help discover other events to listen for.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart supports </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">method cascades</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, which help reduce repetitive code. If you need to call multiple methods on a single object, cascade the calls and avoid repeating the variable.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Here is the Dart code for setting up the drag and drop area:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img alt="Screen Shot 2014-04-26 at 1.12.45 AM.png" height="178px;" src="https://lh3.googleusercontent.com/S046oG51e2MldfcQuoj3XnPBrI6sAUVTZOMrekaw_UqPa_xCsARSwgb3iXhRo_AyZ6llVQkRAJJSMnhi33Qz3O2FtTjwiI4I5eIMvUzUGbcLLIz4TozAmeUawbjULvX_8w" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="468px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Notice how </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">fileDropArea</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is stated only once. The double dot (..) syntax is the cascade. Compare this version to the original JavaScript version above.</span></span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Asynchronous callbacks</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In which I explore how both versions handle asynchronicity.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When something needs to run “later”, JavaScript calls a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">callback function</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. The MusicDNA app uses asynchronous callbacks when decoding audio data.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">MusicDNA has a </span><span style="background-color: #cfe2f3; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">onAudioDataParsed</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> function.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">MusicDNA creates a new AudioParser, and passes </span><span style="background-color: #cfe2f3; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">onAudioDataParsed</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> to it.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">MusicDNA calls </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">audioParser.parseArrayBuffer()</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, which calls an </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">asynchronous</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">decodeAudioData</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> method.</span></span></div></li></ol><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Control is returned to the browser, and events are processed as normal. The audio is decoded in the background. Sometime later...</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><ol start="4" style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">decodeAudioData</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is finished and is successful, it calls </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">audioParser.onDecodeData</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">onDecodeData</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> is finished, it calls </span><span style="background-color: #cfe2f3; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">onAudioDataParsed</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Now we’re back in MusicDNA!</span></div></li></ol><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">As you can see, a function can get passed around, with no clear line of execution.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Here’s the code, see if you can follow the callback:</span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="143px;" src="https://lh6.googleusercontent.com/KKvJnIpg1UycR_iiW5EmGNhxz7JyExyi94oypymHJ1hS-4RMmPqcaHnHnGGRcWOOcaC8x4IyAcwsXLZKYbwuKcPvr9gvehlA86x0zXdF8L-eCNgiY-nzAMY-LwmPCE-u_Q" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In AudioParser:</span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="371px;" src="https://lh6.googleusercontent.com/t4_q0NlR7igF5YersQdHzCP_JlZJHK5Kv63_jNDjKOqvx0Q_EOYkw74-7Fp0IEsGJYop9L6QguK1PEYXN8Ro1xTfkv0IHFQoLD9iaHjVZgW-b65_6OJN7JXeQAhq4tPBQw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">parseArrayBuffer() calls decodeAudioData() which asynchronously calls onDecodeData.</span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="101px;" src="https://lh6.googleusercontent.com/_cuo5I0m5qSJyKAzpVsyWV1R5pFSx2h9y5bGmWDpbCgyHuD4JG_JrhvD2CwckV8sWLi1eV0M5sM85httARIFv-z58dLQjh02RR8vPANNvWit74KYlZFvryJdjX5wYIXuxQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The onDecodeData function calls the callback given to AudioParser from the constructor:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="649px;" src="https://lh6.googleusercontent.com/672EqZyaCUb8OdV_y6xTt9t0kX9hy4_h1snQcf2g01nHMwHnjznaUjxoMCp7pDmiSDrMEKCFENc_pZSjhW8j1IWPVOv6n9wgh-rGpbjVLpoB76C-ejXKwZnWT3zFOK3ciw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart’s core SDK has a </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Future</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> class, which represents values available sometime in the future. An asynchronous function or method returns a Future instead of accepting a callback as a parameter. The Future </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">completes</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> when the asynchronous function is finished, and a value is available.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">In the Dart version, </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">parseArrayBuffer</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> returns a Future, as seen below:</span></span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="156px;" src="https://lh4.googleusercontent.com/uUHTfzJ4t2IGBeG9z5GIPywyAkOjRuzkvmmTOjHDQ2jIu0G67QGCTVSJP4JPALB3gbQbjJ5FgrxkG2yj8kEdqYmWQWvdqm1R9m0F04RxHQH4b8DKTzq5m0c3IUrsAWvZbQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Now that the async methods can return futures, the code can get simplified. For example, Futures are chainable, so music_dna.dart looks like this:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="219px;" src="https://lh5.googleusercontent.com/_5XoH3PvL2EbVGrGlWgo7x1BoZIlf_294o3Gs43uizQ5MZZM7bThuClLDf0fIcr8kQk8bXwjbUOEKVjw2VpnL8G3VjfS51JMt0fREBcjlkz-4oqgUainh_1YT7rmpkQIVA" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="589px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The above code reads:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Read the file into an array buffer.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">loadEnd</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> event is done, </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">then</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> parse the array buffer.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">When the array buffer is done, </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">then</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> read the duration.</span></span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: decimal; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Return a future to caller of </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">parse</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> knows when parsing is finished.</span></span></div></li></ol><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Animation</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Modern web apps animate with </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">requestAnimationFrame</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, which is an API that lets your app get notified when the browser is ready for your app to draw a frame.</span></span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Again, because JavaScript uses callbacks for async notifications, the requestAnimFrame (a shimmed version of requestAnimationFrame) uses callbacks.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="572px;" src="https://lh5.googleusercontent.com/XINijaB6YWDgUyprEQSiVvPdHQxbzlcvU9pmf2xdhSbm16kEa9LRI68KsJLxi1u5YekYuMiDVBJKHTVHdKRDXAORQ1UeiuOA7sfd1T6gKVUNXI-MpZCBv6QKXfa0v1zgzQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart uses Futures in many places, including in the HTML libraries. Specifically, requestAnimationFrame has been rewritten to return a Future that completes when the frame is ready.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="287px;" src="https://lh3.googleusercontent.com/XSd4FGtKRp5qKtA75VohqV135rkSYzDEDb4GMLo6bOSYNAtrXt8xhXyuZ_2UBUwmjNJscv-Yv_m39ZLQgVMZ9kXQEzbNXS0EdWMsG9TgUEaeQ4a1cSlJyTma8-akGfMbaQ" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="595px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><h1 dir="ltr" style="margin-bottom: 0pt; margin-top: 10pt;"><span style="font-family: inherit; font-size: 21px; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;">Code size</span></h1><div><span style="font-family: inherit; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;">There are two ways to look at code size: the original code that the developer works with, and the compiled, minified, gzipped code size. It's important to stress that neither the original version or the Dart version made any attempts to create the most terse code possible. Line counts include blank lines and comments. I believe this app is too small to make any reasonable claim about lines of code correlation to language.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="color: black; font-family: inherit; font-size: 17px; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><div><span style="font-family: inherit; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;">The important JavaScript files, their sizes, and number of lines:</span></div><div><ul><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">audio-parser.js: 1823 bytes, 78 lines</span></li><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">audio-renderer.js: 2751 bytes, 120 lines</span></li><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">bootstrap.js: 1803 bytes, 69 lines</span></li><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">music-dna.js: 3608 bytes, 130 lines</span></li></ul><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">Total bytes for the scripts (not counting id3.js): 9985 bytes.</span></div></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">Total lines for the scripts: 397 lines.</span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">The original app did not concat the JS files or minify them, however most developers should perform those steps with "real" apps. Most web servers will gzip on the fly, so it's worth noting that the total number of gzipped bytes from scripts (gzipping each file individually) results in 3825 bytes.</span></div><div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="color: black; font-family: inherit; font-size: 17px; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2></div><div><span style="font-family: inherit; font-weight: normal; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">The important Dart files, their sizes, and number of lines:</span></div><div><ul><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">lib/audio.dart: 427 bytes, 12 lines</span></li><li><span style="font-family: inherit;"><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">lib/src/audio_parser.dart: 1786 bytes, </span><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">68 lines</span></span></li><li><span style="font-family: inherit;"><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">lib/src/audio_renderer.dart: 2273 bytes, </span><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">99 lines</span></span></li><li><span style="font-family: inherit;"><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">web/bootstrap.dart: 1763 bytes, </span><span style="line-height: 24.149999618530273px; white-space: pre-wrap;">71 lines</span></span></li><li><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">web/music_dna.dart: 1623 bytes, 59 lines</span></li></ul><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">Total bytes for the scripts (not counting id3.js): 7872 bytes.</span></div></div></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">Total lines for the scripts: 309 lines.</span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; line-height: 24.149999618530273px; white-space: pre-wrap;">Compiling and minifying the Dart scripts to JavaScript generates 143kb bytes. Gzipping the generated JavaScript (as most web servers and browsers compress/decompress on the fly) results in 41kb bytes. (For comparison, jQuery itself is 32kb minified and gzipped. However, the original Music DNA app does not use jQuery.)</span></div><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Interop with JavaScript libraries</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The Music DNA app uses a JavaScript file called id3.js to read the ID3 tags and extract metadata like song title and artist.</span></div><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Original version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The id3.js file is included as a script tag, just like any other JavaScript file.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="118px;" src="https://lh3.googleusercontent.com/PhNiNPz5SphfTm3uA2CrywbTCQVI3gtFGxf9i_CKmvulMMwAGMO20WSHR2NE70h9PgBo9eYz2mNrM9eiYvg3wVmGtzRzVepscjYMg-O0ZRDHsqD0LzbXDtZbBdm-s1Dxng" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="450px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Using the ID3 functionality is easy, as it’s just JavaScript in JavaScript. Here is how the ID3 library is used inside of bootstrap.js:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="237px;" src="https://lh5.googleusercontent.com/8iK3p7zI85B7-CsfLH2imyoZsLVyd0fDBzFEth7v1tSzdtQzLnt01fh3Pw8cx-zhXvFdd8R4Ps1Xqn_TrSdt6xS_fvHZiu1xNhLgdrQZoCsvWLw-hlpRA_RPMgwwKg6gLg" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="460px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Original version</span></td></tr></tbody></table><h2 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 17px; font-style: normal; font-variant: normal; font-weight: bold; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart version</span></h2><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: inherit;"><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Using JavaScript files in Dart requires the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">dart:js</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> library, which provides Dart-JavaScript interop. I had to import the dart:js library, explicitly get a reference to the ID3 object (which originally came from the id3.js file), and use the </span><span style="background-color: transparent; color: black; font-size: 15px; font-style: italic; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">callMethod</span><span style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> method to call JavaScript methods.</span></span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">I was able to use id3.js in the Dart app, but the integration isn’t as trivial as it is with JavaScript-JavaScript interop.</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Here is the Dart code:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><span style="font-family: inherit;"><img height="535px;" src="https://lh6.googleusercontent.com/lkWffP1MHo3shlI84v1yLC7BpA6sb4tY5Sqj1oYZ-NnJ1namA0sDPi_PqEAxR8ipuWkq6d-TGxp1eK6JoHQ_NTaXg7nW_JbAbPwGCNogjwpg7smRUF0ZDZpph7YfwUWDTw" style="-webkit-transform: rotate(0rad); border: none; margin-left: auto; margin-right: auto;" width="624px;" /></span></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-family: inherit;">Dart version</span></td></tr></tbody></table><h1 dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 10pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 21px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Lessons learned</span></h1><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Porting the Music DNA app from JavaScript to Dart was a lot of fun. Here’s what I learned:</span></div><span style="font-family: inherit;"><b style="font-weight: normal;"><br /></b></span><br /><ul style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Futures are great! They really simplify API design.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Type annotations save the day. I found a bug in the original code after I ported it to Dart, thanks to type annotations and code analysis.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">You can interoperate with JavaScript from Dart, it’s just not a “cut and paste” job.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">It’s easy to tell where Dart programs start.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Compiled, minified, and gzipped apps about this size end up a little bigger than jQuery.</span></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart’s library mechanism makes it easy to determine where names come from.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Dart’s HTML library shims APIs like requestAnimationFrame for you.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Method cascades are sweet.</span></div></li><li dir="ltr" style="background-color: transparent; color: black; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; list-style-type: disc; text-decoration-line: none; vertical-align: baseline;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Code completion. Love it. Especially helpful when exploring new APIs.</span></div></li></ul><div><span style="font-family: inherit; font-size: 15px; white-space: pre-wrap;"><br /></span></div><div><span style="font-family: inherit; font-size: 15px; white-space: pre-wrap;">There are other language and library features of Dart that I didn't get a chance to use. If you're interested, there is a <a href="https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html">Dart language tour</a> that might be interesting to you.</span></div><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Of course, most of the techniques used by Dart in this article aren't impossible with JavaScript. In fact, future versions of JavaScript should get features like modules and promises. They just aren't built-in, obvious, or easy "out of the box" with JavaScript as we know it today. And this is where I begin to see some of the real power with Dart: the out of the box experience is really good. Shims? yup. Futures? yup. Layout convention? yup. Classes? yup. Type annotations (instead of comment)? yup. Dart seems to have a broader and more functional base on which we can build. I like it.</span><br /><span style="font-family: inherit;"><br /></span><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: inherit; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Many thanks to Paul Lewis for the inspiration and sharing his code.</span></div><img src="http://feeds.feedburner.com/~r/SethLaddsBlog/~4/XTHAsLZkAHk" height="1" width="1"/>
