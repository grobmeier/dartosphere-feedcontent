---
title: 'The PublishedProperty Polymer Dart Annotation'
layout: post
published: '2014-08-03T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/zz2GbabdO-M/the-publishedproperty-polymer-dart.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer

---

<div class=top-chain-links></div><br />There seems to be a good amount of confusion surrounding the new <code>@PublishedProperty</code> annotation in version 0.12 of <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>. Fair enough, I am always good for piling on more confusion. <br /><br />Consider my venerable <code>&lt;x-pizza></code> element. I might want to publish it with an attribute that specifies a specialty pizza name:<pre class=prettyprint><code>      &lt;h1>Ye Olde Dart Pizza Shoppe&lt;/h1><br />      <b>&lt;x-pizza special_name="Plain">&lt;/x-pizza></b></code></pre>In older version of Polymer.dart, I would have supported this with a <code>@published</code> annotation in the backing class like so:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  <b>@published special_name;</b><br />  // ...<br />}</pre>The new way of expressing this same intent is:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  @published<br />  String get special_name => readValue(#special_name);<br />  set special_name(String newValue) => writeValue(#special_name, newValue);<br />  // ...<br />}</pre>This is… pretty ugly. My understanding is that there are “timing” issues that necessitate writing it like that, but unless I experience said issues, I would likely continue using the old version.<br /><br />Anyhow, I am trying to play with the <code>@PublishedProperty</code> annotation. At first, I try using this like the regular <code>@published</code> annotation:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br /><b>  @PublishedProperty</b><br />  String get special_name => readValue(#special_name);<br />  set special_name(String newValue) => writeValue(#special_name, newValue);<br />  // ...<br />}</pre>But am greeted by a nasty error when trying to serve this element via <code>pub serve</code>:<pre class=prettyprint>Build error:<br />Transform ScriptCompactor on published_example|web/index.html threw error: The null object does not have a getter 'arguments'.<br /><br />NoSuchMethodError: method not found: 'arguments'<br />Receiver: null<br />Arguments: []<br />dart:core-patch/object_patch.dart 45                                            Object.noSuchMethod<br />http://127.0.0.1:36253/packages/smoke/codegen/recorder.dart 268:44              _convertAnnotation<br />dart:_internal/iterable.dart 393                                                MappedListIterable.elementAt<br />dart:_internal/iterable.dart 214                                                ListIterable.toList<br />...</pre>The actual error goes on for a long time. It takes me a bit of time to realize that the <code>@PublishedProperty</code> annotation has a required argument, which looks like an optional named parameter::<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br /><b>  @PublishedProperty(reflect: true)</b><br />  String get special_name => readValue(#special_name);<br />  set special_name(String newValue) => writeValue(#special_name, newValue);<br />  // ...<br />}</pre>Which re-publishes the attribute back to the element itself. To verify this, I add a conditional in the <code>updatePizza()</code> method to change the specialty name if the first half of the pizza has one topping and it is pepperoni:<pre class=prettyprint>@CustomTag('x-pizza')<br />class XPizza extends PolymerElement {<br />  // ...<br />  updatePizzaState([_]) {<br /><b>    var first = $['firstHalfToppings'].model;<br />    if (first.length == 1 && first[0] == 'pepperoni') {<br />      special_name = 'First Half Pepperoni';<br />    }</b><br />    // ...<br />  }<br />}</pre>Sure enough, if I add pepperoni to the first half, the attribute changes back in the DOM from “Plain”:<br /><br /><a href="http://3.bp.blogspot.com/-jvs5zmrdKDQ/U98HfezUHXI/AAAAAAAAdog/SiuKIM8f58s/s1600/01-not_updating_atrr.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-jvs5zmrdKDQ/U98HfezUHXI/AAAAAAAAdog/SiuKIM8f58s/s640/01-not_updating_atrr.png" /></a><br /><br />To the new “First Half Pepperoni” special name:<br /><br /><a href="http://2.bp.blogspot.com/-N_K2xae-dAU/U98HfUp2o8I/AAAAAAAAdok/_ktuRdMPcgo/s1600/02-now_updating_attr.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-N_K2xae-dAU/U98HfUp2o8I/AAAAAAAAdok/_ktuRdMPcgo/s640/02-now_updating_attr.png" /></a><br /><br />If I switch back to the <code>@published</code> annotation, then even though <code>special_name</code> is still being updated, the published attribute no longer reflects the change. The value of the <code>special_name</code> attribute in the DOM always remains “Plain.”<br /><br />Interestingly, <code>@PublishedProperty(reflect: false)</code> seems to behave the same as <code>@published</code>. I am unsure if there is a difference or if <code>reflect: false</code> is only meant as a similar looking alternative when some attributes require <code>reflect: true</code>. The <a href="http://www.dartdocs.org/documentation/polymer/0.12.0/index.html#polymer/polymer#id_published">documentation</a> mentions something about serializing, but initial attempts at converting to something that might be serialized (like a List) do not seem to work.<br /><br />I am not thrilled with the new annotation—especially the verbosity of the setter and getter. Still, the functionality is nice. I wonder if this might make it easier to synchronize changes between Polymer.dart and Angular.dart. Something to investigate another day.<br /><br /><br /><br /><span style="color: #ccc">Day #142</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/08/switching-from-jasmine-to-mocha-for.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/zz2GbabdO-M" height="1" width="1"/>
