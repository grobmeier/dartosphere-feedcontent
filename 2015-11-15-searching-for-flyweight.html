---
title: 'Searching for Flyweight'
layout: post
published: '2015-11-15T22:34:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/fB341B5zn54/searching-for-flyweight.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - 'design patterns'
    - flyweight
    - github

---

<div class=top-chain-links></div><br />As part of <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>, I would very much like to include examples of the various patterns in the wild. I have not quite figured out how to go about doing that, so if anyone knows where to find examples of the Flyweight pattern in the wild, I would appreciate it.<br /><br />I know from the very excellent <a href="http://gameprogrammingpatterns.com/flyweight.html">Game Programming Patterns</a> (seriously, it's great, I just bought another copy so I could read it in epub) that graphics programming tries to make extensive use of the Flyweight pattern. I dug around a bit today, but it does not seem that WebGL supports it yet. Even if did, the Flyweight would be in the WebGL API, not in <a href="http://dartlang.org">Dart</a>, so that seems unlikely<br /><br />Instead of playing around with forced examples in Three.dart, I change tact. I clone a bunch of Dart repositories that are <a href="https://github.com/trending?l=dart&since=monthly">trending on GitHub</a>, then grep through them in the hope of finding a mention of the word "flyweight":<pre class=prettyprint>➜  trending-dart-repos  ack -i flyweight<br />➜  trending-dart-repos  echo $?<br />1</pre>No luck there. Still, not a complete waste of time, as I expect to find other patterns in the top results:<ul><li><a href="https://github.com/flutter/flutter">flutter</a> (cross-platform mobile development)</li><li><a href="https://github.com/dart-lang/sdk">The Dart SDK</a></li><li><a href="https://github.com/dart-lang/barback">Barback</a> (asset build system)</li><li><a href="https://github.com/dart-lang/fletch">Fletch</a> (Raspberry PI)</li><li><a href="https://github.com/dart-atom/dartlang">Dart Atom</a> (a plugin for the Atom editor)</li></ul>I will add to that list over time, but that seems a good start. I have looked through code in several of those already and know that there are plenty of pattern examples.<br /><br />That does not help with my goal tonight. What does help, is the search interface on GitHub, which allows me to search all <a href="https://github.com/search?l=Dart&q=flyweight&type=Code&utf8=%E2%9C%93">Dart projects by keyword</a>:<br /><br /><a href="http://4.bp.blogspot.com/-J3J8Y4G7ch0/Vkl0coOPcvI/AAAAAAABBKU/H5zYcaVmRwU/s1600/01-flyweight_search.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-J3J8Y4G7ch0/Vkl0coOPcvI/AAAAAAABBKU/H5zYcaVmRwU/s400/01-flyweight_search.png" /></a><br /><br />Most of those results look to be from goofballs compiling examples of design patterns. One in the list, however, does include an actual Flyweight pattern.  The <a href="https://github.com/akserg/dart_web_toolkit">Dart Web Toolkit</a>, which is based on the same idea as GWT. The projects looks un/lightly maintained, so it's not a strong example, but the Flyweight pattern is definite present.<br /><br />The idea is to cache event mappings between native and DWT events. The <code>DomEvent</code> class caches these in the private <code>_registered</code> map:<pre class=prettyprint>abstract class DomEvent extends DwtEvent implements HasNativeEvent {<br />  // ...<br />  static Map&lt;String, DomEventType> _registered;<br />  // ...<br />}</pre>Whenever a new type is created by the factory class, it registers the DWT / native event pair under the string description of the event:<pre class=prettyprint>class DomEventType&lt;H> extends EventType&lt;H> {<br />  String eventName;<br />  DomEvent flyweight;<br /><br />  DomEventType(this.eventName, this.flyweight) {<br />    DomEvent.getRegistered()[eventName] = this;<br />  }<br />}</pre>Every single event in the library then registers itself at runtime when the class is evaluated:<pre class=prettyprint>class TouchMoveEvent extends TouchEvent {<br />  /**<br />   * The event type.<br />   */<br />  static DomEventType&lt;TouchMoveHandler> TYPE = new DomEventType&lt;TouchMoveHandler>(BrowserEvents.TOUCHMOVE, new TouchMoveEvent());<br />  // ...<br />}</pre>This way, whenever the framework needs a touch-move event, it can use the flyweight registered when the class assigns the <code>TYPE</code> variable. Nice!<br /><br />As I said, I am unsure if the qualifies as a strong example. I suppose if I can find that folks are still using the library, then it qualifies. Regardless, I am happy to have rediscovered the GitHub language search. I have the feeling this will come in quite handy.<br /><br /><br /><span style="color: #ccc">Day #4</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/11/flyweight-coffee-shop-in-dart.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/fB341B5zn54" height="1" width="1" alt=""/>
