---
title: 'Kicking the Tires on Polymer.dart 0.10'
layout: post
published: '2014-06-01T23:55:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/ZnvFsyamnso/kicking-tires-on-polymerdart-010.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - testing

---

<div class=top-chain-links></div><br />Well, that simplifies things.<br /><br />I spent yesterday sorting out some testing confusion between early the 0.10 and current 0.9 versions of <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>. I was able to get the 0.9 testing working to my satisfaction, but noticed that an annotation that I thought was 0.10 worked in 0.9. Or at least had an effect—it broke my tests entirely. I planned to investigate today, but then the Polymer.dart team went and released 0.10. So let's see how that works...<br /><br />First off, even though 0.10 is no longer pre-release, one of its dependencies is. When I <code>pub upgrade</code>, I still get the 0.9 version of Polymer—presumably because a dependency is blocking it:<pre class=prettyprint>➜  dart git:(master) pub upgrade<br />Resolving dependencies... (22.1s)<br />  ...<br /><b>  polymer 0.9.5+2 (1 newer version available)</b><br />  ...<br />No dependencies changed.<br /></pre>So, even though Polymer.dart 0.10 is ready, I still need to peg the version dependency in <code>pubspec.yaml</code>:<pre class=prettyprint>name: svg_example<br />dependencies:<br /><b>  polymer: ">=0.10.0 &lt;0.11.0"</b><br />  polymer_elements: any<br />dev_dependencies:<br />  scheduled_test: any<br />transformers:<br />- polymer:<br />    entry_points: web/index.html</pre>That's not a huge deal in normal code—in fact, it is a recommended practice. But in my book code, it's a minor hassle. I prefer to track the latest release so that I can see when chapters break. Pinning the code in a bunch of chapters manually with each release is going to be problematic. I will worry about that later. For now, I try my tests only to get two failures and no tests run:<pre class=prettyprint>CONSOLE MESSAGE: warning: polymer_ajax.html not found.<br />CONSOLE ERROR: Exception: Bad state: polymer.js must be loaded before polymer.dart, please add &lt;link rel="import" href="packages/polymer/polymer.html"<br />> to your &lt;head> before any Dart scripts. Alternatively you can get a different version of polymer.js by following the instructions at http://www.polymer-project.org; if you do that be sure to include the platform polyfills.</pre>I will worry about <code>&lt;polymer-ajax></code> / <code>&lt;core-ajax></code> / <code>&lt;javascript-ajax></code> another time. I <i>think</i> that I can run my tests without them. But I need to figure out that second error.<br /><br />In the 0.9 version of Polymer.dart, I had to manually invoke <code>initPolymer()</code> inside my tests to make them work. I have no idea how the console message's instructions to add a <code>&lt;link></code> tag will impact that, but there is one way to find out. In the <code>test/index.html</code> testing context page, I add the described <code>&lt;link></code> tag:<pre class=prettyprint>&lt;head><br />  &lt;!-- Load Polymer --><br /><b>  &lt;link rel="import" href="packages/polymer/polymer.html"></b><br /><br />  &lt;!-- Load component(s) --><br />  &lt;link rel="import" href="packages/svg_example/elements/x-pizza.html"><br /><br />  &lt;!-- The actual tests --><br />  &lt;script type="application/dart" src="test.dart">&lt;/script><br />  &lt;script src="packages/unittest/test_controller.js">&lt;/script><br />&lt;/head></pre>Aside from the absence of <code>;component=1</code> on the <code>type</code> attribute of the <code>test.dart</code> <code>&lt;script></code> tag, this is now identical to what I had been using in the 0.10 pre-release version of Polymer.dart. The <code>;component=1</code> was the means by which Polymer.dart kept all web components executing in the same code isolate. It was also part of the mechanism by which the Polymer platform started up, replacing the 0.9 <code>initPolymer()</code>. But, for now, I leave <code>initPolymer()</code> in the main entry point of my <code>test/test.dart</code> test script:<pre class=prettyprint>library x_pizza_test;<br /><br />import 'package:polymer/polymer.dart';<br />// Other imports...<br /><br />main() {<br /><b>  initPolymer();</b><br />  // Tests here...<br />}<br /></pre>And, when I run my tests now, I see:<pre class=prettyprint>➜  dart git:(master) ✗ content_shell --dump-render-tree test/index.html<br />#READY<br />CONSOLE MESSAGE: warning: polymer_ajax.html not found.<br />CONSOLE MESSAGE: unittest-suite-wait-for-done<br />CONSOLE MESSAGE: PASS: [defaults] it has no toppings<br />CONSOLE MESSAGE: PASS: [adding toppings] updates the pizza state accordingly<br />CONSOLE MESSAGE: <br /><b>CONSOLE MESSAGE: All 2 tests passed.</b><br />CONSOLE MESSAGE: unittest-suite-success<br />CONSOLE WARNING: line 213: PASS<br /></pre>Uh... yay? Er… I mean yay! I knew that would work.<br /><br />But that is only half of today's battle. I have the test passing, but what about the actual web application that uses this <code>&lt;x-pizza></code> custom element? In 0.9, I had been loading it by linking the definition with a <code>&lt;link></code> tag, then using Polymer.dart's init code to <code>initPolymer()</code>:<pre class=prettyprint>&lt;!DOCTYPE html><br />&lt;html lang="en"><br />  &lt;head><br />    &lt;!-- ... --><br /><b>    &lt;!-- Load component(s) --><br />    &lt;link rel="import" href="packages/svg_example/elements/x-pizza.html"><br />    &lt;!-- Load Polymer --><br />    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></b><br />  &lt;/head><br />  &lt;body><br />    &lt;div class="container"><br />      &lt;h1>Ye Olde Dart Pizza Shoppe&lt;/h1><br /><b>      &lt;x-pizza toppings="pepperoni,sausage">&lt;/x-pizza></b><br />    &lt;/div><br />  &lt;/body><br />&lt;/html></pre>That fails however on build:<pre class=prettyprint>[Warning from polymer (Linter) on svg_example|web/index.html]:<br />web/index.html:15:3: Besides the initPolymer invocation, to run a polymer application you need to include the following HTML import: &lt;link rel="import" href="packages/polymer/polymer.html">. This will include the common polymer logic needed to boostrap your application.<br />Build completed successfully<br /></pre>And it fails on loading in <a href="http://www.dartlang.org/dartium/">Dartium</a> as well:<pre class=prettyprint>ShadowDOMPolyfill polyfill was loaded in Dartium. This will not work. This indicates that Dartium's Chrome version is not compatible with this version of web_components. dart_support.js:10</pre>The pre-release 0.10 version of Polymer.dart did away with <code>init.dart</code> in favor of a linked polymer.html definition. The final release seems to retain <code>init.dart</code> <i>and</i> load <code>polymer.html</code>:<pre class=prettyprint><code>    &lt;!-- Load Polymer --><br /><b>    &lt;link rel="import" href="packages/polymer/polymer.html"></b><br />    &lt;!-- Load component(s) --><br />    &lt;link rel="import" href="packages/svg_example/elements/x-pizza.html"><br />    &lt;!-- Start Polymer --><br /><b>    &lt;script type="application/dart"><br />      export 'package:polymer/init.dart';<br />    &lt;/script></b></code></pre>In the end, the changes required to both tests and application for the 0.10 release of Polymer.dart were not nearly as encompassing as some versions of the pre-release hinted. I, for one, am not complaining (even though some minor changes will be needed to one of the chapters in <a href="http://patternsinpolymer.com">Patterns in Polymer</a>). Both the test and application only required a <code>&lt;link></code> tag for <code>packages/polymer/polymer.html</code>.<br /><br />I am not quite done with the upgrade, however. I still need <code>&lt;polymer-ajax></code> working. With all of the Dart packages seemingly deprecated, it seems like I need the JavaScript version of that element (and any other Polymer/Core elements that I might want to use). I will investigate that tomorrow. I also still need to figure out what the <code>@initMethod</code> annotation does, but that will likely wait for another day.<br /><br /><br /><span style="color: #ccc">Day #81</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/the-unforunate-case-of-annotation-and.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/06/polymer-elements-in-dart.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/ZnvFsyamnso" height="1" width="1"/>
