---
title: 'At the Bottom of the Rabbit Hole, I Find Polyfill-Next-Selector'
layout: post
published: '2014-08-25T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/nQ-6di8n_y8/at-bottom-of-rabbit-hole-i-find.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - css
    - dart
    - dartlang
    - javascript
    - polymer
    - 'shadow dom'

---

<div class=top-chain-links></div><br />The more I investigate styling and theming <a href="http://www.polymer-project.org/">Polymer</a> elements, the less a grasp I feel like I have on it. The <a href="http://www.polymer-project.org/docs/elements/core-elements.html#core-style">core-style</a> continues <a href="http://japhr.blogspot.com/2014/08/crazy-theming-polymerdart-with-core.html">to vex</a>. Beyond that, I am also having difficulty applying consistent CSS styles on my elements.<br /><br />I am unsure if my current problems are with Polymer or with the <a href="http://www.polymer-project.org/docs/elements/core-elements.html">Core Elements</a> and <a href="http://www.polymer-project.org/docs/elements/paper-elements.html">Paper Elements</a> built on top of Polymer. The most recent issue that I find is that the <code>&lt;paper-button></code> inside of a sample Polymer element that I am trying to create do not share styles. Specifically, the border is not included on all paper-buttons:<br /><br /><a href="http://1.bp.blogspot.com/-MQ8ERxInt_g/U_vn6c4LttI/AAAAAAAAeyE/3WTIPHAmq8s/s1600/01-partially_applied_core_styles.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-MQ8ERxInt_g/U_vn6c4LttI/AAAAAAAAeyE/3WTIPHAmq8s/s400/01-partially_applied_core_styles.png" /></a><br /><br />Both the top buttons and the dialog buttons are <code>&lt;paper-button></code> elements. Both should be covered by my core-style CSS:<pre class=prettyprint>&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br /><b>    &lt;paper-button label="Bottom" on-tap="{{toggleDialog}}">&lt;/paper-button><br />    &lt;paper-button label="Center" on-tap="{{toggleDialog}}">&lt;/paper-button></b><br /><br />    &lt;paper-dialog heading="Bottom Dialog" transition="paper-dialog-transition-bottom"><br />      &lt;!-- ... --><br /><b>      &lt;paper-button label="Accept" affirmative autofocus>&lt;/paper-button></b><br />    &lt;/paper-dialog><<br />    &lt;!-- ... --><br />    &lt;core-style id="theme"><br /><b>      :host /deep/ paper-button {<br />        color: {{g.primaryColor}};<br />        border: 5px solid {{g.secondaryColor}};<br />        padding: 2px 5px;<br />      }</b><br />    &lt;/core-style><br />    &lt;core-style ref="theme">&lt;/core-style><br />  &lt;/template><br />  &lt;script><br />    Polymer('lorem-dialog', {/* ... */});<br />  &lt;/script><br />&lt;/polymer-element></pre>The core-style CSS is applied with the <code>/deep/</code> CSS modifier. My understanding of <code>/ddep/</code> is that my styles should penetrate any shadow DOMs that are under the current element. And it <i>kinda/sorta</i> does what I expect. The primary color, themed from the containing page, is set to orange and it does apply to all paper-button elements. But darn it, why are the borders not in place for the paper-buttons in the dialogs?<br /><br />My first though is that perhaps this is a native shadow DOM vs. polyfill issue, so I load the demo page up in Firefox. This only makes things worse:<br /><br /><a href="http://3.bp.blogspot.com/-JE6bp6MgM4c/U_vp9r22uyI/AAAAAAAAeyM/MuuvrhqfBg4/s1600/02-no_core_styles_in_ff.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-JE6bp6MgM4c/U_vp9r22uyI/AAAAAAAAeyM/MuuvrhqfBg4/s400/02-no_core_styles_in_ff.png" /></a><br /><br />The borders are applied to all paper-buttons, but none of the core-style global settings are in place. Bleh.<br /><br />Taking a step back, I know from last night that core-style does not like the way that I am using it. I take that out of the equation by removing the id/ref core-style pair of tags, replacing them with a straight forward <code>&lt;style></code> tag:<pre class=prettyprint>&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br />    &lt;!-- ... --><br /><b>    &lt;style><br />      :host /deep/ paper-button {<br />        color: orange;<br />        border: 5px solid green;<br />        padding: 2px 5px;<br />      }<br />    &lt;/style></b><br />  &lt;/template><br />  &lt;script><br />    Polymer('lorem-dialog', {/* ... */});<br />  &lt;/script><br />&lt;/polymer-element></pre>That solve my Firefox problem. The polyfills now correctly style my paper-button elements:<br /><br /><a href="http://3.bp.blogspot.com/-4yArmlJNrXo/U_vsVJgrNDI/AAAAAAAAeyY/0Tbmmahza7Y/s1600/03-firefox_polyfills_work_with_regular_style.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-4yArmlJNrXo/U_vsVJgrNDI/AAAAAAAAeyY/0Tbmmahza7Y/s400/03-firefox_polyfills_work_with_regular_style.png" /></a><br /><br />But this remains unchanged in Chrome (stable through unstable). On the surface, it would seem that Polymer styles are just broken at this point, but I refuse to indulge in select-is-broken thoughts. At least not yet.<br /><br />If I peek at one of the paper-button elements in the Chrome inspector, I find that my border style is being overridden:<br /><br /><a href="http://3.bp.blogspot.com/-i7icTZVmDQo/U_vti3_KaDI/AAAAAAAAeyg/fMqSH8ZQUn8/s1600/04-chrome_inspector_colon_colon_content.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-i7icTZVmDQo/U_vti3_KaDI/AAAAAAAAeyg/fMqSH8ZQUn8/s400/04-chrome_inspector_colon_colon_content.png" /></a><br /><br />But what is that double-colon content thingy? I have no idea how that applies to my paper-button elements, let alone is more specific (in a CSS selector sense) than my <code>/deep/</code> paper-button selector. Furthermore, I am hindered by the odd lack of file and line number for this selector. How can I understand and work around the darn thing if I cannot even find it?<br /><br />To the <a href="http://beyondgrep.com/">ack</a> machine Robin!<br /><br />Amazingly, that actually finds something:<pre class=prettyprint>$ ack -l ::content                                                  <br />bower_components/platform/platform.js<br />bower_components/platform/platform.js.map<br /><b>bower_components/paper-dialog/paper-dialog.css</b><br />bower_components/core-style/elements.html<br />bower_components/core-component-page/core-component-page.html</pre>Only one of those is a CSS file and just so happens to be the element (paper-dialog) that is wrapping my misbehaving paper-buttons. Taking a look at the offending CSS, I find:<pre class=prettyprint>polymer-next-selector { content: ':host > *'; }<br />::content > * {<br />  font: inherit;<br />  border: 0;<br />}</pre>That is exactly the definition of the culprit that I found in the DOM inspector. A quick review of the other matching files reveals that none of them have the same style definition. So the question becomesâ€¦ what the heck is a <code>polymer-next-selector</code>? More importantly, how do I have override it?<br /><br />The answer to the first question <i>seems</i> to be that polymer-next-selector is also known as <a href="http://www.polymer-project.org/docs/polymer/styling.html#at-polyfill">polyfill-next-selector</a>. It seems to be a way to apply styles in the polyfills, but which work natively with the shadow DOM if present. Only, the precedence on these things is crazy high. <br /><br />Try as I might, I cannot target the distributed nodes of the paper-dialog from my custom element that tries to use paper-dialog. I am surprised that targeting the distributed nodes of paper-dialog has no effect:<pre class=prettyprint>&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br />    &lt;!-- ... --><br />    &lt;style><br />      :host /deep/ paper-button {<br />        color: orange;<br />        border: 5px solid green;<br />        padding: 2px 5px;<br />      }<br /><br /><b>      paper-dialog::content > * {<br />        border: 5px dashed blue;<br />      }</b><br />    &lt;/style><br />  &lt;/template><br />  &lt;script><br />    Polymer('lorem-dialog', {/* ... */});<br />  &lt;/script><br />&lt;/polymer-element></pre>In the end, I give up trying to work with ::content and simply add an <code>!important</code> to the border style:<pre class=prettyprint><b>      paper-dialog::content > * {<br />        border: 5px dashed blue;<br />      }</b><br />&lt;polymer-element name="lorem-dialog"><br />  &lt;template><br />    &lt;!-- ... --><br />    &lt;style><br />      :host /deep/ paper-button {<br />        color: orange;<br /><b>        border: 5px solid green !important;</b><br />        padding: 2px 5px;<br />      }<br />    &lt;/style><br />  &lt;/template><br />  &lt;script><br />    Polymer('lorem-dialog', {/* ... */});<br />  &lt;/script><br />&lt;/polymer-element><br /></pre>That does the trick:<br /><br /><a href="http://3.bp.blogspot.com/-gq6vHjP92hE/U_wILqazhdI/AAAAAAAAeys/7LLcjF0vg64/s1600/05-important_overrides_content.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-gq6vHjP92hE/U_wILqazhdI/AAAAAAAAeys/7LLcjF0vg64/s400/05-important_overrides_content.png" /></a><br /><br />But it feels like a cheat. <br /><br />I cannot figure out why the ::content distributed node selector has such high precedence or why my attempts to influence failed. I am probably overlooking some selector combinator that would allow me to target paper-button distributed into paper-dialog, but I wish it were easier to find that combinator. And if there is no easier way to do this, then why is paper-dialog using such a high precedence selector to ensure that none of its nodes have borders?<br /><br />I have a solution, but I have more questions than answers to go along with that solution. Which makes this feel like a cheat.<br /><br /><br /><br /><br /><span style="color: #ccc">Day #163</span>  <br /><br /><p class=bottom-chain-links><a href=""http://japhr.blogspot.com/2014/08/crazy-theming-polymerdart-with-core.html>&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <span style="color: #ccc">next&rsaquo;</span> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/nQ-6di8n_y8" height="1" width="1"/>
