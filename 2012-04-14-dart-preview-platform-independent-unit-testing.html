---
title: 'Dart Preview: Platform Independent Unit Testing'
layout: post
published: '2012-04-14T09:38:00-05:00'
feed: 'phylotic connections'
link: 'http://phylotic.blogspot.com/2012/04/dart-preview-platform-independent-unit.html'
author:
    name: Anonymous
    email: noreply@blogger.com
    url: 'http://www.blogger.com/profile/11906178872969557145'
tags:
    - browser
    - dart
    - dartlang
    - html
    - 'unit testing'
    - 'unit tests'
    - web

---

I’ve been working on a patch for Dart’s html unit testing output recently, and as a result have become quite familiar with the latest changes to unit testing in the bleeding_edge branch. &nbsp;In this post, I will demonstrate how unit test results can now be redirected to the platform of your choice, including your own customized platforms.<br /><br />The most significant change is the notion of platform independence, meaning that by default, Dart’s unit test will render output to the console, but you can redirect that output to any other presentation platform – like HTML.<br /><br /><b>NOTE: As I mentioned, this is all in the bleeding edge branch at the moment, so you won’t find this stuff in the SDK. &nbsp;Furthermore, some or all of this is subject to change at any time.</b><br /><br /><span style="font-size: large;">How It Works</span><br />If you want to use the default platform (console) then all you have to do is import unittest.dart<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">#import(<span style="color: #006080;">'my/path/to/unittest.dart'</span>);</pre><br /></div>Then write some unit tests using the API<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">group(<span style="color: #006080;">'My Test Group',</span> () {<br /><br />    test(<span style="color: #006080;">'fail test'</span>, () =&gt; Expect.fail(<span style="color: #006080;">'fail test'</span>));<br />    <br />    test(<span style="color: #006080;">'pass test'</span>, () =&gt; Expect.isTrue(<span style="color: blue;">true</span>));<br /><br />    asyncTest(<span style="color: #006080;">'async test'</span>, 1, (){<br />        Expect.isTrue(<span style="color: blue;">true</span>);<br />        <span style="color: green;">//some async code that finishes with...</span><br />        callbackDone();<br />    });<br /><br />});</pre><br /></div>Above, I am demonstrating the current API for declaring test groups (which can be nested), tests, and async tests.<br /><br />Async tests currently use a message pump to to determine completion, so you pass in how many times the pump will be, well pumped, and then you make the same number of calls to callbackDone() so that test harness knows when the async operation is complete.&nbsp; This API is likely to change a bit in the future.<br /><br />Now run the app.&nbsp; If you work within the Dart editor and have Dartium running, you will see the output rendered into the editor’s console window.<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">FAIL: My Test Group fail test<br />  Expect.fail(<span style="color: #006080;">'fail test'</span>)<br />PASS: My Test Group pass test<br />PASS: My Test Group async test<br /><br />2 PASSED, 1 FAILED, 0 ERRORS</pre><br /></div><span style="font-size: large;">Redirecting To Another Platform</span><br />Outputting to the console is nice and all, but can be a bit tedious when dealing with a large number of tests.&nbsp; Fortunately, the unit test framework supports platform redirection.<br /><br />The current browser platform output is basically a static dump of the unit test results into a HTML Table, but lets say we wanted to have something a bit more interactive, we can write this by extending a new class that comes with the framework:&nbsp; Configuration.&nbsp; Any class that extends configuration can then be passed to the test harness prior to the test run like so:<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">configure(<span style="color: blue;">new</span> MyUnitTestExtension());</pre><br /></div>As I mentioned at the beginning of this post, I’ve written a patch that provides a richer UI experience for the browser platform.&nbsp; In order to use it we need to import the library that contains the extension, assuming my patch is accepted, it would be this:<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">#import(<span style="color: #006080;">'my/path/to/html_enhanced_config.dart'</span>);</pre><br /></div>Then we can use the helper method included with that import to set the configuration. This helper essentially makes the call to configure() for us:<br /><br /><div id="codeSnippetWrapper"><pre id="codeSnippet" style="background-color: #f4f4f4; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-style: none; color: black; direction: ltr; font-family: 'Courier New', courier, monospace; font-size: 8pt; line-height: 12pt; margin: 0em; overflow: visible; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-align: left; width: 100%;">useHtmlEnhancedConfiguration();</pre><br /></div>And now the output looks like this (in Dartium):<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-zDOIm5vreKg/T4mJsklnVsI/AAAAAAAAFJI/p819AGbh3X0/s1600/dart_unit_test_output1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="197" src="http://3.bp.blogspot.com/-zDOIm5vreKg/T4mJsklnVsI/AAAAAAAAFJI/p819AGbh3X0/s400/dart_unit_test_output1.png" width="400" /></a></div><br /><br />As you can see we get an HTML output to the browser that shows our test group, along with the tests, and all kinds of bells &amp; whistles.&nbsp; Lets see how this looks with something more complex:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-yUhJZceOyXQ/T4mKEKKNj8I/AAAAAAAAFJQ/VirqD3PFpqk/s1600/dart_unit_test_output2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="226" src="http://1.bp.blogspot.com/-yUhJZceOyXQ/T4mKEKKNj8I/AAAAAAAAFJQ/VirqD3PFpqk/s320/dart_unit_test_output2.png" width="320" /></a></div><br />The test groups are collapsible, allowing for easy at-a-glance browsing of the test results. &nbsp;Don’t like this?&nbsp; Want to output your test results to your fancy new Google glasses instead of the browser?&nbsp; Cool!&nbsp; Roll your own by extending from Configuration class and you’re all set.<br /><br /><span style="font-size: large;">Summary</span><br />The revised unit test framework that is coming soon will provide an extensible, platform-independent solution for Dart programmers.<br /><br />If you’re interested in taking a look at my patch, it can be found here: <a href="https://github.com/dart-lang/dart/pull/3">https://github.com/dart-lang/dart/pull/3</a><br /><br />The source code for my enhanced html output is here:&nbsp;<a href="https://github.com/prujohn/dart/blob/bleeding_edge/lib/unittest/html_enhanced_config.dart" target="_blank">html_enhanced_config.dart</a>
