---
title: 'Generic Commands'
layout: post
published: '2015-12-19T22:48:00-08:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/dXK8G7Ec33s/generic-commands.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - command
    - dart
    - dartlang
    - 'design patterns'

---

<div class=top-chain-links></div><br />I can't figure out why the <a href="http://en.wikipedia.org/wiki/Design_Patterns">Gang of Four book</a> used <a href="https://en.wikipedia.org/wiki/Template_(C%2B%2B)#Class_templates">C++ class templates</a> for simple commands in the <a href="https://en.wikipedia.org/wiki/Command_pattern">command pattern</a>. I understand how they could be used, but the why escapes me. Maybe it's a C++ thing.<br /><br />Last night I was able to use <a href="http://dartlang.org">Dart</a> callback functions as simple commands. The GoF suggested  callbacks as an alternative for commands, so I assume that there is no way to do something similar in C++. What I do not understand is why they needed a class template to generate classes for simple commands. Why not a single, simple class instead of class templates?<br /><br />In the command pattern, the command links actions with receivers, so a very simple command might look something like:<pre class=prettyprint>class SimpleCommand implements Command {<br />  var receiver;<br />  var action;<br />  List args;<br />  SimpleCommand(this.receiver, this.action, [this.args]);<br />  void call() {<br />    // Call the action on the receiver here...<br />  }<br />}</pre>To make that work in Dart, I need to use mirrors so that I can reflect on an object and invoke arbitrary methods:<pre class=prettyprint>import 'dart:mirrors';<br />// ...<br />class SimpleCommand implements Command {<br />  var receiver;<br />  Symbol action;<br />  List args;<br />  SimpleCommand(this.receiver, this.action, [this.args]);<br />  void call() {<br />    reflect(receiver).invoke(action, this.args);<br />  }<br />}</pre>With that, I can create a simple command on the robot that I have been using as an example:<pre class=prettyprint><code>  // ...<br />  var moveNorth = new MoveNorthCommand(robot),<br />    // ...<br />    beSad = new SimpleCommand(robot, #say, ['Boo hoo.']);</code></pre>I can then assign that command to an invoker (a button in this example) and tell the invoker to... invoke:<pre class=prettyprint><code>  // ...<br />  var btnUp = new Button("Up", moveNorth);<br />  // ...<br />  var btnTease = new Button("Tease Robot", beSad);<br /><br />  btnUp.press();<br />  btnTease.press();<br />  // ...</code></pre>That results in a sad robot:<pre class=prettyprint>[pressed] Up<br />  I am moving Direction.NORTH<br />[pressed] Tease Robot<br />Boo hoo.</pre>I have to think that something similar to that is possible in C++. If type safety is the concern driving class templates, then I can get a little closer in Dart with generics. If I make my <code>SimpleCommand</code> class be for a specific type of receiver:<pre class=prettyprint>class SimpleCommand&lt;T> implements Command {<br />  T receiver;<br />  Symbol action;<br />  List args=[];<br />  SimpleCommand(this.receiver, this.action, [this.args]);<br />  void call() {<br />    reflect(receiver).invoke(action, this.args);<br />  }<br />}</pre>Then I can be assure myself that the receiver has the correct type assigned:<pre class=prettyprint>var<br />    // ...<br />    beSad = new SimpleCommand&lt;Robot>(robot, #say, ['Boo hoo.']);</pre>It is not exactly class templates, but nothing else in the pattern makes use of the command being a specific typeâ€”just that the command implement a common interface. In other words, I think this, along with last night's callbacks, is more than sufficient to serve as a simple command implementation in the command pattern.<br /><br />I <i>think</i> that just about does it for the command pattern. I may review one more time tomorrow, or it may be time to throw a dart at another pattern for <a href="http://designpatternsindart.com/">Design Patterns in Dart</a>.<br /><br /><i>Play with the code in DartPad: <a href="https://dartpad.dartlang.org/26e623a65566e561af77">https://dartpad.dartlang.org/26e623a65566e561af77</a>.</i><br /><br /><br /><span style="color: #ccc">Day #38</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2015/12/simple-commands-in-complex-command.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2015/11/design-patterns-in-dart.html">My Chain</a> | <a href="http://japhr.blogspot.com/2015/12/in-summary-command-pattern.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/dXK8G7Ec33s" height="1" width="1" alt=""/>
