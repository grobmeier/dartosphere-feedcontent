---
title: 'Jenkins for Testing Dart and JavaScript Polymer'
layout: post
published: '2014-09-08T23:59:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/eQGnjGMbhs8/jenkins-for-testing-dart-and-javascript.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - debian
    - javascript
    - jenkins
    - linode
    - 'regression testing'
    - testing

---

<div class=top-chain-links></div><br />It is entirely possible that I am too cheap. It is also possible that there is nothing out there that does exactly what I need it to do. So tonight, I set out to see how easy it is to roll my own.<br /><br />What I need is a continuous integration server for my books. I need a solution for all of my books, but if I can find something for <a href="http://patternsinpolymer.com/">Patterns in Polymer</a> which is written in both <a href="http://dartlang.org">Dart</a> and JavaScript, then I will likely have everything that I need.<br /><br />Some of the key features that I need:<br /><br /><ul><li>Needs to update Dart when new releases are available</li><li>Needs to update specific libraries (e.g. <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a> and <a href="http://www.polymer-project.org/">Polymer</a>) when new releases are available</li><li>Needs to run tests when code is updated or new code is added</li><li>Needs to run dart analyzer (ignoring code intentionally broken for demonstration purposes)</li></ul><br />I do not necessarily need to be told immediately if the code in my books has broken. I like to write as much as possible then go back and fix words and code as needed. I will typically run the tests specific to the current chapter locally, so it is not imperative that I get quick feedback (daily will be fine).<br /><br />I happen to have been messing around with <a href="http://jenkins-ci.org/">Jenkins</a> a bit recently. I also happen to have a Linode that is not doing too much. Perhaps these two can be a match made in JavaScript & Dart heaven?<br /><br />I have Debian 6 installed on my Linode, which is old, but still in LTS. Hopefully that will be sufficient. I start by following the <a href="http://pkg.jenkins-ci.org/debian/">instructions for adding Jenkins packages to a Debian system</a>. This boils down to: add the alternate package server's key to my Linode, add the package source to the list of sources, update, and <code>sudo apt-get install jenkins</code>.<br /><br />I do not care for the server being publicly available:<pre class=prettyprint>$ sudo netstat -nlp  | grep 8080<br />tcp6       0      0 :::8080                 :::*                    LISTEN      29489/java</pre>I am very happy with it binding to localhost and then using SSH port forward to access it as needed. Never expose services that you do not need, after all.<br /><br />The <code>/etc/default/jenkins</code> file configures Jenkins on Debian. It does not include the listen address by default, just the port:<pre class=prettyprint># port for HTTP connector (default 8080; disable with -1)<br />HTTP_PORT=8080<br /><br />JENKINS_ARGS="--webroot=/var/cache/jenkins/war --httpPort=$HTTP_PORT --ajp13Port=$AJP_PORT"<br /></pre>So I update the file to include that information:<pre class=prettyprint><b># address to which to bind the HTTP connector<br />HTTP_HOST=127.0.0.1</b><br /><br /># port for HTTP connector (default 8080; disable with -1)<br />HTTP_PORT=8080<br /><br />JENKINS_ARGS="--webroot=/var/cache/jenkins/war <b>--httpListenAddress=$HTTP_HOST</b> --httpPort=$HTTP_PORT --ajp13Port=$AJP_PORT"</pre>After a <code>sudo /etc/init.d/jenkins restart</code> I am happier:<pre class=prettyprint>$ sudo netstat -nlp  | grep 8080<br />tcp6       0      0 <b>127.0.0.1:8080</b>          :::*                    LISTEN      29709/java</pre>I disconnect my SSH session, and reconect, port forwarding 8080 from my local machine to 8080 on localhost of my Linode:<pre class=prettyprint>$ ssh -L 8080:localhost:8080 linode</pre>With that, I have a Jenkins server that only I can access:<br /><br /><a href="http://3.bp.blogspot.com/-K3DDVq6imkA/VA51HIRRA_I/AAAAAAAAfHk/QzVfuddIjXY/s1600/01-jenkins_localhost.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-K3DDVq6imkA/VA51HIRRA_I/AAAAAAAAfHk/QzVfuddIjXY/s320/01-jenkins_localhost.png" /></a><br /><br />I start by removing plugins that I am never going to need (mostly the myriad Java ones) from Manage Jenkins → Manage Plugins → Installed:<br /><br /><a href="http://3.bp.blogspot.com/-_yn3f-6aIbs/VA52VibIEtI/AAAAAAAAfHw/o7xgBqhzVeM/s1600/02-disable_plugins.png" imageanchor="1" ><img border="0" src="http://3.bp.blogspot.com/-_yn3f-6aIbs/VA52VibIEtI/AAAAAAAAfHw/o7xgBqhzVeM/s320/02-disable_plugins.png" /></a><br /><br />Then I install the GitHub plugin from the Available tab so that I can grab my private repositories:<br /><br /><a href="http://1.bp.blogspot.com/-uZ0Or2FSqX4/VA52-tZc73I/AAAAAAAAfH4/hMzT0sDpQ7E/s1600/03-github_plugin_jenkins.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-uZ0Or2FSqX4/VA52-tZc73I/AAAAAAAAfH4/hMzT0sDpQ7E/s320/03-github_plugin_jenkins.png" /></a><br /><br /><a name="ssh_config"></a><br /><h2>Configuring SSH Hosts for GitHub</h2>Once that is complete, I create an ssh key for Jenkins to use:<pre class=prettyprint>$ ssh-keygen<br />Generating public/private rsa key pair.<br />Enter file in which to save the key (/var/lib/jenkins/.ssh/id_rsa): /var/lib/jenkins/.ssh/patterns_in_polymer_id_rsa<br />Your identification has been saved in /var/lib/jenkins/.ssh/patterns_in_polymer_id_rsa.<br />Your public key has been saved in /var/lib/jenkins/.ssh/patterns_in_polymer_id_rsa.pub.</pre><br />Next, I create an ssh alias that will use this ssh key:<pre class=prettyprint>$ pwd<br />/var/lib/jenkins<br />$ cat .ssh/config <br />Host patterns_in_polymer_github<br />  Hostname github.com<br />  IdentityFile /var/lib/jenkins/.ssh/patterns_in_polymer_id_rsa<br />  PreferredAuthentications publickey<br /></pre>The benefit of this is that I can create as many keys as I like here without getting key-already-in-use messages from Github when I try to add another project to my Linode. I add the deploy key to my private book repo:<br /><br /><a href="http://2.bp.blogspot.com/-jLV3C0DGLhU/VA57jS9zwzI/AAAAAAAAfIA/KP-5q0adj2Y/s1600/05-create_depoly_key.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-jLV3C0DGLhU/VA57jS9zwzI/AAAAAAAAfIA/KP-5q0adj2Y/s320/05-create_depoly_key.png" /></a><br /><br />With that, I can access the repository using that SSH alias:<pre class=prettyprint>$ git ls-remote -h git@patterns_in_polymer_github:eee-c/polymer-patterns HEAD<br />The authenticity of host 'github.com (192.30.252.130)' can't be established.<br />RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.<br />Are you sure you want to continue connecting (yes/no)? yes<br />Warning: Permanently added 'github.com,192.30.252.130' (RSA) to the list of known hosts.<br /></pre>It is important to run that step from the command-line otherwise Jenkins, unable to prompt for a yes/no answer, will fail to connect.<br /><br />I am now ready to create the Jenkins project:<br /><br /><a href="http://2.bp.blogspot.com/-tC1KGhXWrv0/VA58swvI5cI/AAAAAAAAfIM/mu_qyph46Xg/s1600/04-create_freestyle_project.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-tC1KGhXWrv0/VA58swvI5cI/AAAAAAAAfIM/mu_qyph46Xg/s320/04-create_freestyle_project.png" /></a><br /><br />To that project, I add the SSH-aliased Github URL:<br /><br /><a href="http://2.bp.blogspot.com/-9_DFSVwhRPA/VA58s-kJbkI/AAAAAAAAfIY/hD91TGaE4QY/s1600/06-git_jenkins.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-9_DFSVwhRPA/VA58s-kJbkI/AAAAAAAAfIY/hD91TGaE4QY/s320/06-git_jenkins.png" /></a><br /><br />I configure the project to run daily at 0430:<br /><br /><a href="http://1.bp.blogspot.com/-GBE27NdPEU8/VA58s1bThHI/AAAAAAAAfII/NTBBU_xlQaA/s1600/07-run_daily.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-GBE27NdPEU8/VA58s1bThHI/AAAAAAAAfII/NTBBU_xlQaA/s320/07-run_daily.png" /></a><br /><br />And last, but not least, I define the tests to run:<br /><br /><a href="http://2.bp.blogspot.com/-d8b5Xxl3QqI/VA58tNj4kxI/AAAAAAAAfIQ/MguHZxR2AJ8/s1600/08-run_testing_shell_script.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-d8b5Xxl3QqI/VA58tNj4kxI/AAAAAAAAfIQ/MguHZxR2AJ8/s320/08-run_testing_shell_script.png" /></a><br /><br />And that works. Well, it checks out the code and executes the test script. I still need a bit more setup on my Linode (Xvfb-run, a recent Node.js, Dart, Chrome, etc). But hopefully the hard part is out of the way. I will find out just how hard the remaining configuration is tomorrow.<br /><br /><br /><span style="color: #ccc">Day #177</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/09/failure-expected-throw-which-threw.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/09/one-yak-too-many.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/eQGnjGMbhs8" height="1" width="1"/>
