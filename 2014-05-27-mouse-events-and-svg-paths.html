---
title: 'Mouse Events and SVG Paths'
layout: post
published: '2014-05-27T21:02:00-04:00'
feed: 'japh(r) by Chris Strom'
link: 'http://feedproxy.google.com/~r/JaphrByChrisStrom/~3/VNVafips-Y8/mouse-events-and-svg-paths.html'
author:
    name: 'Chris Strom'
    email: noreply@blogger.com
    url: 'https://plus.google.com/117928918793969810642'
tags:
    - chain
    - dart
    - dartlang
    - polymer
    - svg

---

<div class=top-chain-links></div><br />I keep promising myself that I am going to stop this, but… there's a minor SVG problem that I'd like to solve tonight.<br /><br /><i>As an aside</i>, I am likely to keep pushing through some of these smaller problems as I work through the remaining <a href="http://dart4hipsters.com/">Dart for Hipsters</a> errata. I cannot risk offending the writing gods by breaking this chain o’ learning, but I also need my primary focus to be on that book. Anyhow…<br /><br />The problem tonight is that mouse over and leave events are causing some weird behavior with the SVG toppings in my <code>&lt;x-pizza></code> pizza-building <a href="http://www.polymer-project.org/">Polymer</a> element:<br /><br /><a href="http://2.bp.blogspot.com/-l6t_Nm_4kCo/U4PfrxqmhRI/AAAAAAAAZzk/ae21cwpSYZE/s1600/03-x_pizza_with_svg_images.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-l6t_Nm_4kCo/U4PfrxqmhRI/AAAAAAAAZzk/ae21cwpSYZE/s400/03-x_pizza_with_svg_images.png" /></a><br /><br />The problem occurs with mouse-overs. When I first approach the pepperoni topping:<br /><br /><a href="http://4.bp.blogspot.com/-41LG_yjCHME/U4T-oa5Ib1I/AAAAAAAAZ14/cLbqqSj6NhM/s1600/02-svg_before_mouseover.png" imageanchor="1" ><img border="0" src="http://4.bp.blogspot.com/-41LG_yjCHME/U4T-oa5Ib1I/AAAAAAAAZ14/cLbqqSj6NhM/s400/02-svg_before_mouseover.png" /></a><br /><br />I have not yet triggered the mouse-over event at this point. When I do, the pepperoni pops up:<br /><br /><a href="http://2.bp.blogspot.com/-HXTQIlskMeY/U4T-oQKODxI/AAAAAAAAZ10/ceo0BXeaYoI/s1600/03-svg_first_mouseover.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-HXTQIlskMeY/U4T-oQKODxI/AAAAAAAAZ10/ceo0BXeaYoI/s400/03-svg_first_mouseover.png" /></a><br /><br />The problem is that the pointer is no longer over the path that draws the SVG pepperoni so that even the slightest movement at this point will trigger a mouseleave. This mouseleave triggers an event the moves the pepperoni back in its original location, which causes the pepperoni to shift back under the pointer.<br /><br /><a href="http://1.bp.blogspot.com/-A5_v8nzfyIw/U4UAPTMDiPI/AAAAAAAAZ2I/vOm8vFPsr8w/s1600/04-svg_mouseleave.png" imageanchor="1" ><img border="0" src="http://1.bp.blogspot.com/-A5_v8nzfyIw/U4UAPTMDiPI/AAAAAAAAZ2I/vOm8vFPsr8w/s400/04-svg_mouseleave.png" /></a><br /><br />In other words, the pepperoni jumps back and forth until the pointer is in a location that is over the raised and rest pepperoni. It is a very annoying effect, especially with SVG elements that are not as solid as the pepperoni:<br /><br /><a href="http://2.bp.blogspot.com/-lj4hj3QpqEc/U4UugrHIMaI/AAAAAAAAZ2Y/kW6emTXj15Q/s1600/01-a_new_drop_shadow.png" imageanchor="1" ><img border="0" src="http://2.bp.blogspot.com/-lj4hj3QpqEc/U4UugrHIMaI/AAAAAAAAZ2Y/kW6emTXj15Q/s400/01-a_new_drop_shadow.png" /></a><br /><br />So this is a problem that I would very much like to eliminate. Of course, this is SVG, so it leads me into yet another unexpected tour of things that don't quite work like you expect them to work. For example, my initial suspicion for this problem fell on the combination of path, SVG container, and group element that hold the various toppings. It seemed plausible that the path was generating the jittering mouse events, but that I could ignore them and only pay attention to mouse events on the group or SVG element. But simple debugging in the mouse handlers:<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br />    // ...<br />    return svg<br />      ..onMouseOver.listen((e){<br /><b>          print('[mouseover] ${e.target}');</b><br />          // transforms here...<br />        })<br />        // ...<br />  }</code></pre>Tells me that only <code>[mouseover] path</code> events are being generated. There are no events coming from the SVG topping asset or the group element that contains both. Only the path—the circle or spiral shape—generates events, which just ain't gonna work.<br /><br />The solution to this turns out to be a bit of obscure SVG chicanery and some CSS chicanery. The obscure SVG solution is to disable events from the path by setting the <code>pointer-events</code> attribute to <code>none</code>. The CSS part of the solution is to create an SVG circle that <i>does</i> generate events, but to make it completely transparent:<pre class=prettyprint><code>  _svgImage(basename) {<br />    var svg = new GElement()<br />      ..append(<br /><b>          new CircleElement()<br />            ..setAttribute('r', '15')<br />            ..setAttribute('cx', '15')<br />            ..setAttribute('cy', '15')<br />            ..setAttribute('style', 'opacity:0')</b><br />        )<br />      ..append(new SvgElement.svg(svgContent['$basename.svg']));<br /><br />    svg.query('svg')<br />      ..setAttribute('overflow', 'visible')<br />      ..setAttribute('clip', 'rect(-50px, 50px, 50px, -50px)')<br /><b>      ..setAttribute('pointer-events', 'none');</b><br /><br />    // Listen for events as usual, but now from the 100% transparent<br />    // circle<br />    return svg<br />      ..onMouseOver.listen((e){ /* ... */ })<br />      ..onMouseOut.listen((e){ /* ... */ });<br />  }</code></pre>That does the trick nicely. The 100% transparent circle SVG generates the same mouse-over and mouse-leave events that had been created by the path. The Dart streams still see those events and react exactly as before—only now there is no jumping since the thing that generates events does not move because of those events. And, since <code>pointer-events</code> is set to <code>none</code>, there are no events whatsoever from the SVG asset or the path that it contains.<br /><br />That seems a fine stopping point for tonight. May the writing gods look upon me with favor—especially since I may revisit SVG clipping area tomorrow.<br /><br /><br /><span style="color: #ccc">Day #76</span>  <br /><br /><p class=bottom-chain-links><a href="http://japhr.blogspot.com/2014/05/clipping-in-svg.html">&lsaquo;prev</a> | <a href="http://japhr.blogspot.com/2013/11/new-chain-patterns-in-polymer.html">My Chain</a> | <a href="http://japhr.blogspot.com/2014/05/svg-viewports-who-knew.html">next&rsaquo;</a> </p><script>var b_links = document.getElementsByClassName('bottom-chain-links'),      t_links = document.getElementsByClassName('top-chain-links');  if (b_links.length == 1 && t_links.length == 1) {   t_links[0].innerHTML = b_links[0].innerHTML; } </script><img src="http://feeds.feedburner.com/~r/JaphrByChrisStrom/~4/VNVafips-Y8" height="1" width="1"/>
